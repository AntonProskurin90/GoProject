/*
 * Copyright (C) 2014  Ilya Kirillov 
 * email: ilya_kirillov@inbox.ru
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3.0 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
*/
(function(){var n;function ca(){this.l=this.f=null;this.V=0;this.Ba=!1;this.vb=this.Ca=this.Da=this.ba=this.ca=0;this.na=null;this.b={G:0,D:0,F:0,Jb:0,Eb:2,m:null,Db:null,p:null,lb:null,rb:[],Rb:Array(361),Na:null,Ya:null,ya:null,za:null,Ob:null,Pb:null,Kb:null,Lb:null,Mb:null,Nb:null,Fb:null,Bb:null,Cb:null};this.xb=new s(231,188,95,255);this.Vb=new s(0,0,0,255);this.rc=new s(255,0,0,128);this.oa={Zb:new s(232,196,115,255),lc:new s(255,255,255,255),Yb:new s(0,0,0,255),ic:new s(141,141,141,255),cc:new s(112,95,54,255),dc:new s(112,95,54,255)};this.c={g:null,p:{g:null},m:{g:null},xa:{g:null},S:{g:null},Xa:{g:null},M:{g:null},Va:{g:null},Event:{g:null}};this.R={d:-1,e:-1};this.t={};this.yb=-1;var a=this;this.vc=function(c){la(c);c=ma(a);c=na(a,c.d,c.e);oa(a,c.d,c.e,!1)};this.wc=function(c){la(c);ra(a)};this.uc=function(c){if(c.pageX||c.pageY)t.d=c.pageX,t.e=c.pageY;else if(c.clientX||c.clientY)t.d=c.clientX,t.e=c.clientY;t.Gb=t.d;t.Hb=t.e;t.Ma=c.altKey;t.r=c.shiftKey;t.C=c.ctrlKey||c.metaKey;t.Qb=sa;t.Ab=c.button;t.w=c.srcElement?c.srcElement:c.target;var b=(new Date).getTime();0==t.sa?(t.sa=1,t.va=b):500>b-t.va?(t.va=b,t.sa++):(t.sa=1,t.va=b);window.Sb=!1;a.c.Event.g.c.focus();var d=ma(a),d=na(a,d.d,d.e),b=d.d,d=d.e,f=t;switch(a.V){case 0:if(Aa==f.Ab)1<=a.f.Ga&&(Ba(a.f,1),Ca(a,b,d));else if(f.r&&f.C)a.f.pb(y===a.f.la?B:y),Da(a);else if(!0===f.C){var e=new String;switch(b){case 1:e="A";break;case 2:e="B";break;case 3:e="C";break;case 4:e="D";break;case 5:e="E";break;case 6:e="F";break;case 7:e="G";break;case 8:e="H";break;case 9:e="J";break;case 10:e="K";break;case 11:e="L";break;case 12:e="M";break;case 13:e="N";break;case 14:e="O";break;case 15:e="P";break;case 16:e="Q";break;case 17:e="R";break;case 18:e="S";break;case 19:e="T"}a.f.La(e+d)}else if(f.r){e=a.f;e.u&&e.u.hc(!0);var g=e.h;C(e,e.Q);for(f=0;1E3>f&&D===E(e.s,b,d);)Ea(e,1),f++;D===E(e.s,b,d)&&C(e,g);e.u&&e.u.hc(!1)}else Ca(a,b,d);break;case 2:!0===a.f.h.Pa()&&(Ja(a.f),Ka(a.f));e=y;D!==E(a.l,b,d)?e=D:f.r&&(e=B);La(a,b,d,e);a.l.O(b,d,e,-1);a.f.Ka(e,[(d<<8)+b]);break;case 3:Ma(a,Na,b,d);break;case 4:Ma(a,Oa,b,d);break;case 5:Ma(a,Pa,b,d);break;case 6:Ma(a,Qa,b,d);break;case 7:a:{g=Ra(a,b,d);if(null!==g&&F===g.n)a.f.X([(d<<8)+b]),a.X(b,d);else{g="";f.r&&(g=prompt("Enter the label that you want to add to board here. For best results, keep your label to one or two letters.",""));if(void 0==g||""===g||null===g){g=[];f=-1;for(e in a.t){var h=a.t[e];if(F==h.n){var h=h.gb,l=h.charCodeAt(0);1==h.length&&65<=l&&90>=l&&(g[l]=1)}}for(e=65;90>=e;e++)if(void 0===g[e]||""==g[e]){f=e;break}g=-1==f?null:String.fromCharCode(f);if(null===g){alert("Sorry, all the standard labels are used up! To add more labels, you will have to shift click on the board and make up ur own labels to add.");break a}}e=new I(b,d,F,g);a.f.ra(g,(d<<8)+b);Sa(a,b,d,e)}Ta(a)}break;case 8:a:{e=Ra(a,b,d);if(null!==e&&F===e.n)a.f.X([(d<<8)+b]),a.X(b,d);else{e="";if(f.r){e=a.l.nb(b,d);if(-1==e){alert("Sorry, no move has been made at that location, so you can't mark it with the move number!");break a}e=""+e}if(void 0===e||""===e||null===e){e=[];f=0;for(g in a.t)h=a.t[g],F===h.n&&Ua(h.gb)&&(e[f]=parseInt(h.gb),f++);if(0>=f)e="1";else{e.sort(Va);for(var h=g=0,l=!1,m=0;m<f;m++){if(e[m]>g+1){h=g+1;l=!0;break}g=e[m]}l||(h=g+1);e=""+h}}g=new I(b,d,F,e);a.f.ra(e,(d<<8)+b);Sa(a,b,d,g)}Ta(a)}}c.preventDefault();c.stopPropagation();return!1};this.sc=function(c){Wa(c);if(16===J.Ra&&2===a.V)t.r=!0,Da(a);else{var b=J,d=b.Ra;if(8===d||46===d){if(b=a.f,d=b.h.J,null!==d)for(var f=0,e=d.o.length;f<e;f++)if(b.h===eb(d,f)){e=d;e.o.splice(f,1);e.A>=f&&e.A--; -1===e.A&&0<e.o.length&&(e.A=0);b.h=d;C(b,d);break}}else if(13===d)b=prompt("Enter here code of ur sgf file",""),a.f.Sa(b);else if(37===d)b.C&&b.r?(b=a.f,C(b,b.Q)):b.C?Ba(a.f,5):Ba(a.f,1);else if(38===d)b.C?a.f.Oa():(b=a.f,d=b.h.J,null!==d&&(f=d.A,0<d.o.length&&0<f&&C(b,eb(d,f-1))));else if(39===d)if(b.C&&b.r){for(b=a.f;fb(b););C(b,b.h)}else b.C?Ea(a.f,5):Ea(a.f,1);else 40===d?(b=a.f,d=b.h.J,null!==d&&(f=d.A,f<d.o.length-1&&C(b,eb(d,f+1)))):192===d?(b=!0===a.Ba?!1:!0,b!==a.Ba&&(a.Ba=b,gb(a),hb(a,!0))):189===d?(b=a.f.cb,b++,b>ib&&(b=jb),kb(a.f,b)):49===d&&(b=a.V+1,a.V=8<b?0:b,Da(a))}c.preventDefault()};this.tc=function(c){Wa(c);16===J.Ra&&2===a.V&&(t.r=!1,Da(a))};this.xc=function(){return setTimeout(function(){var c=a.c.p.g.c.width,b=a.c.p.g.c.height,d=a.c.p.g.c.getContext("2d");if(0!==c&&0!==b){for(var f=d.createImageData(c,b),e=.9,g=a.xb.pa,h=a.xb.ja,l=a.xb.ia,m=Array(c),p=0;p<c;p++)m[p]=(Math.tan(300*p/c)+1)/2+(Math.tan(100*p/c)+1)/10;for(var u=Array(b),k=0;k<b;k++)u[k]=.02*Math.tan(k/b);for(var r,z,pa,k=0;k<b;k++)for(p=0;p<c;p++){e=40*(m[p]+u[k])+.5;e-=Math.floor(e);e=.2>e?1-e/2:.4>e?1-(.4-e)/2:1;if(k==b-1||k==b-2&&p<c-2||p>=c-1||p==c-2&&k<b-1)e/=2;0==k||1==k&&1<p||0==p||1==p&&1<k?(r=128+g*e/2,z=128+h*e/2,pa=128+l*e/2):(r=g*e,z=h*e,pa=l*e);var Xa=4*(p+k*c);f.data[Xa+0]=r;f.data[Xa+1]=z;f.data[Xa+2]=pa;f.data[Xa+3]=255}a.b.p=f;a.b.G=c;a.b.D=b;a.na=null}var Ya=a.b.G,sb=a.b.D;if(0!==Ya&&0!==sb){for(var gc=a.ba*Ya,hc=a.ca*sb,ad=a.Ca*sb,bd=a.Da*Ya,ic=a.l.q(),jc=Array(ic.d),kc=gc,lc=hc,Fa=0;Fa<ic.d;Fa++)kc=gc+Fa*bd,lc=hc+Fa*ad,jc[Fa]={d:Math.floor(kc+.5),e:Math.floor(lc+.5)};a.b.m=jc;for(var U=Math.max(2,Math.ceil(a.vb*Ya/2)),K=2*U+1,cd=a.b,R=a.Vb,N=document.createElement("canvas").getContext("2d").createImageData(K,K),da=U,ea=-1,dd=da*da,mc=0;da>ea;){ea++;var nc=Math.sqrt(dd-ea*ea),tb=Math.ceil(nc)-nc;tb<=mc&&da--;var fa=Math.floor(255*(1-tb)),ub=U+da,vb=U+da,wb=U+ea,xb=U+ea,yb=U-da,zb=U-da,Ab=U-ea,Bb=U-ea;M(N,ub,xb,fa,K,R);M(N,wb,vb,fa,K,R);M(N,yb,xb,fa,K,R);M(N,Ab,vb,fa,K,R);M(N,ub,Bb,fa,K,R);M(N,wb,zb,fa,K,R);M(N,yb,Bb,fa,K,R);M(N,Ab,zb,fa,K,R);for(var oc=ub-1,pc=vb-1,qc=yb+1,rc=zb+1,ed=N,fd=oc,gd=xb,hd=K,id=R,Cb=qc;Cb<=fd;Cb++)M(ed,Cb,gd,255,hd,id);for(var jd=N,kd=pc,ld=wb,md=K,nd=R,Db=rc;Db<=kd;Db++)M(jd,ld,Db,255,md,nd);for(var od=N,pd=oc,qd=Bb,rd=K,sd=R,Eb=qc;Eb<=pd;Eb++)M(od,Eb,qd,255,rd,sd);for(var td=N,ud=pc,vd=Ab,wd=K,xd=R,Fb=rc;Fb<=ud;Fb++)M(td,vd,Fb,255,wd,xd);mc=tb}cd.Db=N;a.b.Eb=U}var $=a.c.p.g.c.width,ta=a.c.p.g.c.height,Ga=a.c.xa.g.c.getContext("2d"),A=2*Math.floor(Math.floor(a.Da*$)/2)+1;a.b.F=A;a.b.lb=Ga.createImageData(A,A);a.b.kc=Ga.createImageData(A,A);a.b.Na=Ga.createImageData(A,A);a.b.Ya=Ga.createImageData(A,A);for(var ga=a.b.lb.data,O=a.b.kc.data,ha=a.b.Na.data,aa=a.b.Ya.data,Gb=A/2-.5,Za=Gb-.2,yd=Math.sqrt(3),ia=0;ia<A;ia++)for(var ja=0;ja<A;ja++){var ua=ia-Gb,va=ja-Gb,Ha=Za-Math.sqrt(ua*ua+va*va),q=4*(ia*A+A-ja-1);if(0<=Ha){var wa=Za*Za-ua*ua-va*va,wa=0<wa?Math.sqrt(wa)*yd:0,Hb=ua,Ib=va,xa=Math.sqrt(6*(Hb*Hb+Ib*Ib+wa*wa)),xa=(2*wa-Hb+Ib)/xa,Jb=0;.9<xa&&(Jb=10*(xa-.9));var Ia=255;if(.8>=Ha){var Ha=(.8-Ha)/.8,sc=.7;ua-va<Za/3&&(sc=1);Ia=parseInt(255*(1-Ha*sc))}var P=parseInt(10+10*xa+140*Jb);ga[q+0]=P;ga[q+1]=P;ga[q+2]=P;ga[q+3]=Ia;ha[q+0]=P;ha[q+1]=P;ha[q+2]=P;ha[q+3]=parseInt(Ia/2);P=parseInt(200+10*xa+45*Jb);O[q+0]=P;O[q+1]=P;O[q+2]=P;O[q+3]=Ia;aa[q+0]=P;aa[q+1]=P;aa[q+2]=P;aa[q+3]=parseInt(Ia/2)}else ga[q+0]=0,ga[q+1]=0,ga[q+2]=0,ga[q+3]=0,ha[q+0]=0,ha[q+1]=0,ha[q+2]=0,ha[q+3]=0,O[q+0]=0,O[q+1]=0,O[q+2]=0,O[q+3]=0,aa[q+0]=0,aa[q+1]=0,aa[q+2]=0,aa[q+3]=0}for(var Kb=[],ba=[],q=0;28>q;q++)for(Kb[q]=Ga.createImageData(A,A),ba[q]=Kb[q].data,ia=0;ia<A;ia++)for(ja=0;ja<A;ja++){var ka=4*(ia*A+ja);ba[q][ka+0]=O[ka+0];ba[q][ka+1]=O[ka+1];ba[q][ka+2]=O[ka+2];ba[q][ka+3]=O[ka+3]}ba.push(aa);ba.push(O);for(var L=.9,tc=Array($),G=0;G<$;G++)tc[G]=(Math.sin(18*G/$)+1)/20+(Math.sin(3*G/$)+1)/10;for(var uc=Array(ta),H=0;H<ta;H++)uc[H]=.2*Math.cos(5*H/ta)+.1*Math.sin(11*H/ta);for(var vc=Array($*ta),H=0;H<ta;H++)for(G=0;G<$;G++)L=75*(tc[G]+uc[H])+.5,L-=Math.floor(L),L=.2>L?1-L/2:.4>L?1-(.4-L)/2:1,vc[G+H*$]=L;for(var wc=a.b.m,xc=(a.b.F-1)/2,zd=ba.length,$a=0;$a<zd;$a++){var ya=ba[$a],w=0,x=0;switch($a){case 0:w=0;x=3;break;case 1:w=0;x=4;break;case 2:w=0;x=5;break;case 3:w=0;x=6;break;case 4:w=1;x=3;break;case 5:w=1;x=4;break;case 6:w=1;x=5;break;case 7:w=1;x=6;break;case 8:w=2;x=3;break;case 9:w=2;x=4;break;case 10:w=2;x=5;break;case 11:w=2;x=6;break;case 12:x=w=3;break;case 13:w=3;x=4;break;case 14:w=3;x=5;break;case 15:w=3;x=6;break;case 16:w=4;x=3;break;case 17:x=w=4;break;case 18:w=4;x=5;break;case 19:w=4;x=6;break;case 20:w=5;x=3;break;case 21:w=5;x=4;break;case 22:x=w=5;break;case 23:w=5;x=6;break;case 24:w=6;x=3;break;case 25:w=6;x=4;break;case 26:w=6;x=5;break;case 27:x=w=6}for(var Ad=wc[w].d-xc,Bd=wc[x].e-xc,H=0;H<A;H++)for(G=0;G<A;G++){var L=vc[Ad+G+(Bd+H)*$],za=4*(G+H*A);ya[za+0]*=L;ya[za+1]*=L;ya[za+2]*=L}}a.b.rb=Kb;for(var Lb=0;19>Lb;Lb++)for(var Mb=0;19>Mb;Mb++)a.b.Rb[Mb+19*Lb]=Math.floor(Math.random()*(a.b.rb.length-1));var Cd=a.c.S.g.c.getContext("2d"),qa=a.b.F;a.b.S=Cd.createImageData(qa,qa);var ab=a.b.S.data;a.b.Jb=Math.max(parseInt(.15*qa),3);for(var Nb=(qa-5)/2+1,bb=0;bb<qa;bb++)for(var cb=0;cb<qa;cb++){var yc=Math.abs(bb-Nb),zc=Math.abs(cb-Nb),Ac=Math.sqrt(zc*zc+yc*yc)/Nb,Dd=1>Ac?.15+.75*(1-Ac):0,db=4*(qa*bb+cb);ab[db+0]=0;ab[db+1]=0;ab[db+2]=0;ab[db+3]=parseInt(255*Dd)}var v=a.b.F;a.b.ya=lb(a,v,v,.05*v,new s(0,0,0,255));a.b.za=lb(a,v,v,.05*v,new s(255,255,255,255));a.b.Ob=mb(a,v,v,.05*v,new s(0,0,0,255));a.b.Pb=mb(a,v,v,.05*v,new s(255,255,255,255));a.b.Kb=nb(a,v,v,.05*v,new s(0,0,0,255));a.b.Lb=nb(a,v,v,.05*v,new s(255,255,255,255));a.b.Mb=ob(a,v,v,new s(0,0,0,255));a.b.Nb=ob(a,v,v,new s(255,255,255,255));a.b.Fb=pb(a,v,v,.05*v,new s(255,0,0,255));a.b.Bb=pb(a,v,v,.05*v,new s(0,0,0,255));a.b.Cb=pb(a,v,v,.05*v,new s(255,255,255,255));hb(a)},20)}}ca.prototype.Wa=function(){var a=this.c.g.c.clientWidth,c=this.c.g.c.clientHeight;a!==c&&(c=a=Math.min(a,c));qb(this.c.g,a,c);gb(this);hb(this)};function La(a,c,b,d){var f=a.c.xa.g.c.getContext("2d"),e=a.c.S.g.c.getContext("2d"),g=a.b.F,h=(g-1)/2,l=a.b.m,m=a.b.Jb,p=l[c-1].d-h,h=l[b-1].e-h;switch(d){case y:f.putImageData(a.b.lb,p,h);e.putImageData(a.b.S,p+m,h+m);break;case B:f.putImageData(a.b.rb[a.b.Rb[c-1+19*(b-1)]],p,h);e.putImageData(a.b.S,p+m,h+m);break;default:f.clearRect(p,h,g,g),e.clearRect(p+m,h+m,g,g)}c===a.R.d&&b===a.R.e&&(y===d||B===d?ra(a):Da(a))}ca.prototype.X=function(a,c){var b=(c<<8)+a;delete this.t[""+b];b===this.yb&&(this.t[""+b]=new I(a,c,rb,""))};ca.prototype.B=function(a){Sa(this,a.ta(),a.ua(),a)};function Ob(a,c){var b=document.createElement("canvas");b.setAttribute("id",c);b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");a.appendChild(b)}function Pb(a,c,b){a.g=Qb(b);a=a.g;b=a.j;b.L=0;b.P=0;b.N=1E3;b.K=1E3;b.$a=!1;b.bb=!1;b.ab=!1;b.Za=!1;b.aa=-1;b.qa=-1;a.kb=Rb|Tb|Ub|Vb;a.Ib=c;c.ha[c.ha.length]=a}function ma(a){var c,b=t.d,d=t.e;c=a.c.p.g.c;if("undefined"!=typeof c.offsetParent){for(var f=a=0;c;c=c.offsetParent)a+=c.offsetLeft,f+=c.offsetTop;c=f}else a=c.x,c=c.y;return{d:b-a,e:d-c}}function gb(a){var c=a.l.q(),b=c.d,d=c.e;if(!0===a.Ba){var c=Wb/(2*Xb+b),b=(Wb-b*c)/2,f=Yb/(2*Zb+d),d=(Yb-d*f)/2;a.ca=(d+f/2)/Yb;a.ba=(b+c/2)/Wb}else c=Wb/(2*Xb+b-1),b=(Wb-(b-1)*c)/2,f=Yb/(2*Zb+d-1),d=(Yb-(d-1)*f)/2,a.ca=d/Yb,a.ba=b/Wb;a.Da=c/Wb;a.Ca=f/Yb;a.vb=4/Wb}function hb(a,c){var b=a.c.p.g.c.width,d=a.c.p.g.c.height;if(b!=a.b.G||d!=a.b.D||null===a.b.p||null!==a.na||!0===c){if(null!==a.na&&clearTimeout(a.na),a.na=a.xc(),0!==b&&0!==d){var f=a.c.p.g.c.getContext("2d");f.fillStyle=Q(a.oa.Zb);f.fillRect(0,0,b,d);var e=a.c.m.g.c.getContext("2d"),f=a.ba*b,g=a.ca*d,h=a.Da*b,l=a.Ca*d,m=a.l.q();e.clearRect(0,0,b,d);e.strokeStyle=Q(a.oa.dc);for(var p=b-f,u=0;u<m.e;u++){var k=g+u*l;e.beginPath();e.moveTo(f,k);e.lineTo(p,k);e.stroke()}for(var p=d-g,r=0;r<m.d;r++)k=f+r*h,e.beginPath(),e.moveTo(k,g),e.lineTo(k,p),e.stroke();if(m.d===m.e&&(9===m.d||13===m.d||19===m.d)){e.fillStyle=Q(a.oa.cc);u=Math.max(2,a.vb*b/2);r=[];switch(m.d){case 9:r=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:r=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:r=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var z=0,pa=r.length;z<pa;z++)p=f+r[z][0]*h,k=g+r[z][1]*h,e.beginPath(),e.arc(p,k,u,0,2*Math.PI,!1),e.fill()}e=a.c.xa.g.c.getContext("2d");e.clearRect(0,0,b,d);e.strokeStyle=Q(a.oa.ic);e.lineWidth=1;z=Q(a.oa.Yb);pa=Q(a.oa.lc);for(u=1;u<=m.e;u++)for(r=1;r<=m.d;r++){p=E(a.l,r,u);if(y===p)e.fillStyle=z;else if(B===p)e.fillStyle=pa;else continue;p=f+(r-1)*h;k=g+(u-1)*l;e.beginPath();e.arc(p,k,h/2,0,2*Math.PI,!1);e.fill();e.stroke()}a.c.S.g.c.getContext("2d").clearRect(0,0,b,d);a.c.Xa.g.c.getContext("2d").clearRect(0,0,b,d);a.c.M.g.c.getContext("2d").clearRect(0,0,b,d);a.c.Va.g.c.getContext("2d").clearRect(0,0,b,d)}}else{a.c.p.g.c.getContext("2d").putImageData(a.b.p,0,0);if(!0===a.Ba&&a.b.m){b=a.c.p.g.c.getContext("2d");d=a.b.G;l=a.b.D;f=a.l.q();for(m=0;m<f.d;m++){e=2*a.b.F/3;g=(e-1)/2;p=a.b.m;h=p[m].d-g;p=a.ca*l/3-g;k=new String;switch(m+1){case 1:k="A";break;case 2:k="B";break;case 3:k="C";break;case 4:k="D";break;case 5:k="E";break;case 6:k="F";break;case 7:k="G";break;case 8:k="H";break;case 9:k="J";break;case 10:k="K";break;case 11:k="L";break;case 12:k="M";break;case 13:k="N";break;case 14:k="O";break;case 15:k="P";break;case 16:k="Q";break;case 17:k="R";break;case 18:k="S";break;case 19:k="T";break;case 20:k="a";break;case 21:k="b";break;case 22:k="c";break;case 23:k="d";break;case 24:k="e";break;case 25:k="f";break;case 26:k="g";break;case 27:k="h";break;case 28:k="j";break;case 29:k="k";break;case 30:k="l";break;case 31:k="m";break;case 32:k="n";break;case 33:k="o";break;case 34:k="p";break;case 35:k="q";break;case 36:k="r";break;case 37:k="s";break;case 38:k="t"}u=2*e/3;r=Ua(k)?"Arial":"Helvetica, Arial, Verdana";r=u+"px "+r;b.fillStyle="rgb(0,0,0)";b.font=r;u=e/2+u/3;e=(e-b.measureText(k).width)/2;b.fillText(k,h+e,p+u);p=l-a.ca*l/3-g;b.fillText(k,h+e,p+u)}for(l=0;l<f.e;l++)e=2*a.b.F/3,g=(e-1)/2,p=a.b.m,h=a.ba*d/3-g,p=p[l].e-g,k=f.e-l+"",u=2*e/3,r=Ua(k)?"Arial":"Helvetica, Arial, Verdana",r=u+"px "+r,b.fillStyle="rgb(0,0,0)",b.font=r,u=e/2+u/3,e=(e-b.measureText(k).width)/2,b.fillText(k,h+e,p+u),h=d-a.ba*d/3-g,b.fillText(k,h+e,p+u)}$b(a);ac(a);Ta(a)}}function $b(a,c){if(a.b.m){var b=a.b.G,d=a.b.D,f=a.c.m.g.c.getContext("2d"),e=a.l.q(),g=a.b.m;f.clearRect(0,0,b,d);if(e.d===e.e&&(9===e.d||13===e.d||19===e.d)){var d=a.b.Db,h=a.b.Eb,l=[];switch(e.d){case 9:l=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:l=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:l=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var m=0,p=l.length;m<p;m++)f.putImageData(d,g[l[m][0]].d-h,g[l[m][1]].e-h)}for(var h=g[0].d,l=g[g.length-1].d,m=g[0].e,p=g[g.length-1].e,u=f.createImageData(1,p-m),k=f.createImageData(l-h,1),r=a.Vb,z=0;z<p-m;z++)d=4*z,u.data[d+0]=r.pa,u.data[d+1]=r.ja,u.data[d+2]=r.ia,u.data[d+3]=r.sb;for(z=0;z<l-h;z++)d=4*z,k.data[d+0]=r.pa,k.data[d+1]=r.ja,k.data[d+2]=r.ia,k.data[d+3]=r.sb;for(z=0;z<e.d;z++)f.putImageData(u,g[z].d,g[0].e),f.putImageData(k,g[0].d,g[z].e);if(void 0!==c)for(b=(2*Math.floor(parseInt(a.Ca*b)/2)+1-1)/2,e=g[1].d-g[0].d+2,h=g[1].e-g[0].e+2,d=0;d<c.length;d++)l=c[d].d,m=c[d].e,D===E(a.l,l,m)&&f.clearRect(g[l-1].d-b,g[m-1].e-b,e,h)}}function M(a,c,b,d,f,e){c=4*(c+b*f);a.data[c+0]=e.pa;a.data[c+1]=e.ja;a.data[c+2]=e.ia;a.data[c+3]=d}function ac(a,c){if(void 0===c){var b=a.b.G,d=a.b.D;a.c.xa.g.c.getContext("2d").clearRect(0,0,b,d);a.c.S.g.c.getContext("2d").clearRect(0,0,b,d);b=a.l.q();for(d=1;d<=b.e;d++)for(var f=1;f<=b.d;f++)La(a,f,d,E(a.l,f,d))}else for(b=a.l.q(),d=1;d<=b.e;d++)for(f=1;f<=b.d;f++)E(a.l,f,d)!==E(c,f,d)&&La(a,f,d,E(a.l,f,d))}function Da(a){oa(a,a.R.d,a.R.e,!0)}function oa(a,c,b,d){var f=t;if(-1!==c&&-1!==b&&null===a.na&&null!==a.b.m&&(void 0===d&&(d=!1),c!==a.R.d||b!==a.R.e||!0===d)){a.R.d=c;a.R.e=b;var e=a.b.G,g=a.b.D;d=a.c.Va.g.c.getContext("2d");d.clearRect(0,0,e,g);var g=(a.b.F-1)/2,h=a.b.m,e=h[c-1].d-g,g=h[b-1].e-g;c=E(a.l,c,b);switch(a.V){case 0:D===c&&(y===a.f.la?d.putImageData(a.b.Na,e,g):d.putImageData(a.b.Ya,e,g));break;case 1:y===c?d.putImageData(a.b.za,e,g):B===c&&d.putImageData(a.b.ya,e,g);break;case 2:y===c?d.putImageData(a.b.za,e,g):B===c?d.putImageData(a.b.ya,e,g):f.r?d.putImageData(a.b.Ya,e,g):d.putImageData(a.b.Na,e,g);break;default:y===c?d.putImageData(a.b.za,e,g):d.putImageData(a.b.ya,e,g)}}}function ra(a){var c=a.b.G,b=a.b.D;a.c.Va.g.c.getContext("2d").clearRect(0,0,c,b);a.R.d=-1;a.R.e=-1}function na(a,c,b){var d=a.b.G,f=a.b.D,e=a.ba*d,g=a.ca*f,f=a.Ca*f,d=a.Da*d,h=0;a=a.l.q();for(h=0;h<a.e-1&&b>g+f*h+f/2;h++);for(b=b=0;b<a.d-1&&c>e+d*b+d/2;b++);return{d:b+1,e:h+1}}function lb(a,c,b,d,f){a=a.c.M.g.c.getContext("2d");a.clearRect(0,0,c,b);a.strokeStyle=Q(f);a.fillStyle=Q(f);a.lineWidth=d;a.beginPath();a.moveTo(1*c/4,1*b/4);a.lineTo(3*c/4,3*b/4);a.moveTo(3*c/4,1*b/4);a.lineTo(1*c/4,3*b/4);a.stroke();return a.getImageData(0,0,c,b)}function mb(a,c,b,d,f){var e;void 0===e&&(e=1);a=a.c.M.g.c.getContext("2d");a.clearRect(0,0,c,b);a.globalAlpha=e;a.strokeStyle=Q(f);a.fillStyle=Q(f);a.lineWidth=d;var g=c/2;d=3*b/4;f=.1*c;e=Math.sqrt(g*g-(d-g)*(d-g))+g;g=-Math.sqrt(g*g-(d-g)*(d-g))+g;a.beginPath();a.moveTo(c/2,f);a.lineTo(e-f,d);a.lineTo(g+f,d);a.closePath();a.stroke();return a.getImageData(0,0,c,b)}function nb(a,c,b,d,f){a=a.c.M.g.c.getContext("2d");a.clearRect(0,0,c,b);a.strokeStyle=Q(f);a.fillStyle=Q(f);a.lineWidth=d;var e=c/2,g=-b/2*Math.sqrt(2)/2+b/2;f=Math.floor(Math.sqrt(e*e-(g-e)*(g-e))+e-d);e=Math.ceil(-Math.sqrt(e*e-(g-e)*(g-e))+e+d);g=Math.ceil(g+d);d=Math.floor(b/2*Math.sqrt(2)/2+b/2-d);a.beginPath();a.moveTo(f,g);a.lineTo(e,g);a.lineTo(e,d);a.lineTo(f,d);a.closePath();a.stroke();return a.getImageData(0,0,c,b)}function ob(a,c,b,d){a=a.c.M.g.c.getContext("2d").createImageData(c,b);for(var f=0;f<b;f++)for(var e=0;e<c;e++){var g=4*(f*c+e);f>=b/3&&f<=2*b/3&&e>=c/3&&e<=2*c/3?(a.data[g+0]=d.pa,a.data[g+1]=d.ja,a.data[g+2]=d.ia,a.data[g+3]=255):a.data[g+3]=0}return a}function pb(a,c,b,d,f){a=a.c.M.g.c.getContext("2d");a.clearRect(0,0,c,b);var e=c/2,g=4*d;a.strokeStyle=Q(f);a.fillStyle=Q(f);a.lineWidth=d;a.beginPath();a.arc(c/2,b/2,e-g,0,2*Math.PI,!1);a.stroke();return a.getImageData(0,0,c,b)}function Ra(a,c,b){a=a.t[""+((b<<8)+c)];return void 0!==a?a:null}function Sa(a,c,b,d){rb===d.n?bc(a,c,b):a.t[""+((b<<8)+c)]=d}function bc(a,c,b){var d=(b<<8)+c;void 0===a.t[""+d]&&(a.t[""+d]=new I(c,b,rb,""));a.yb=d}function Ta(a){a.c.M.g.c.getContext("2d").clearRect(0,0,a.b.G,a.b.D);var c=[],b;for(b in a.t){var d=a.t[b];cc(a,d);F===d.n&&c.push({d:d.ta(),e:d.ua()})}$b(a,c)}function cc(a,c){if(a.b.m){var b=c.ta(),d=c.ua(),f=c.n,e=a.c.M.g.c.getContext("2d"),g=a.b.F,h=(g-1)/2,l=a.b.m,m=l[b-1].d-h,h=l[d-1].e-h,b=E(a.l,b,d);switch(f){case dc:e.putImageData(a.b.Mb,m,h);break;case ec:e.putImageData(a.b.Nb,m,h);break;case rb:e.putImageData(a.b.Fb,m,h);break;case Pa:e.putImageData(b===y?a.b.Cb:a.b.Bb,m,h);break;case Oa:e.putImageData(b===y?a.b.Lb:a.b.Kb,m,h);break;case Na:e.putImageData(b===y?a.b.Pb:a.b.Ob,m,h);break;case Qa:e.putImageData(b===y?a.b.za:a.b.ya,m,h);break;case F:f=c.gb,d=2>=f.length?2*g/3:g/2,l=d+"px "+(Ua(f)?"Arial":"Helvetica, Arial, Verdana"),e.fillStyle=b===y?"rgb(255,255,255)":"rgb(0,0,0)",e.font=l,e.fillText(f,m+(g-e.measureText(f).width)/2,h+(g/2+d/3))}}}function Ma(a,c,b,d){var f=Ra(a,b,d);if(null!==f&&c===f.n){if(a.f.X([(d<<8)+b]),a.X(b,d),a.b.m){c=(a.b.F-1)/2;var e=a.b.m,f=e[b-1].d-c,e=e[d-1].e-c;a.c.M.g.c.getContext("2d").clearRect(f,e,2*c,2*c);c=S(a.yb);b===c.d&&d===c.e&&(bc(a,b,d),cc(a,Ra(a,b,d)))}}else f=new I(b,d,c,""),a.f.B(c,[(d<<8)+b]),Sa(a,b,d,f),cc(a,f)}function Ca(a,c,b){if(D===E(a.l,c,b)){var d=y===a.f.la?y:B,f=!1,e=new fc,f=a.l.fa;e.ea=f.ea;e.da=f.da;a.l.O(c,b,d,-1);f=null!==Bc(a.l,c,b,d,!0)?!0:null!==Cc(a.l,c,b,d)?!1:!0;a.l.O(c,b,D,-1);var g=a.l.fa;g.ea=e.ea;g.da=e.da;if(1==f){a:{for(var e=a.f,f=(b<<8)+c,g=0,h=e.h.o.length;g<h;g++){var l=eb(e.h,g),m=l.$,p=m.n;if(f===m.v()&&d===p&&(y===d||B===d)){Dc(e.h,g);e.h=l;e.Ga++;e.Jc&&e.Z.Fc(!0);break a}}Ja(e,!1);e.h.ga(c,b,d);e.Z&&(e.qc.yc(),e.Z.jc())}Ka(a.f)}}};function Ec(){this.K=this.N=this.P=this.L=0;this.Za=this.ab=this.bb=this.$a=!1;this.qa=this.aa=-1}var Tb=1,Rb=2,Vb=4,Ub=8;function Fc(){this.j=new Ec;this.kb=Tb|Rb;this.c=this.Ib=this.ec=null;this.W=new Ec;this.ha=[]}function qb(a,c,b){if(null==a.Ib){if(a.W.L=0,a.W.P=0,a.W.N=c,a.W.K=b,null!=a.c)for(var d=a.ha.length,f=0;f<d;f++)qb(a.ha[f],c,b)}else{var e=0,g=0,h=0,l=0,e=a.kb&5,d=a.kb&10;Tb==e?(e=a.j.$a?a.j.L:a.j.L*c/1E3,h=-1!=a.j.aa?e+a.j.aa:a.j.ab?c-a.j.N:a.j.N*c/1E3):Vb==e?(h=a.j.ab?c-a.j.N:a.j.N*c/1E3,e=-1!=a.j.aa?h-a.j.aa:a.j.$a?a.j.L:a.j.L*c/1E3):(Tb|Vb)==e?(e=a.j.$a?a.j.L:a.j.L*c/1E3,h=a.j.ab?c-a.j.N:a.j.N*c/1E3):(e=a.j.L,h=a.j.N);Rb==d?(g=a.j.bb?a.j.P:a.j.P*b/1E3,l=-1!=a.j.qa?g+a.j.qa:a.j.Za?b-a.j.K:a.j.K*b/1E3):Ub==d?(l=a.j.Za?b-a.j.K:a.j.K*b/1E3,g=-1!=a.j.qa?l-a.j.qa:a.j.bb?a.j.P:a.j.P*b/1E3):(Rb|Ub)==d?(g=a.j.bb?a.j.P:a.j.P*b/1E3,l=a.j.Za?b-a.j.K:a.j.K*b/1E3):(g=a.j.P,l=a.j.K);h<e&&(h=e);l<g&&(l=g);-2===a.j.aa?h=e+(l-g)*g_dKoef_Board_W_to_H:-3===a.j.aa&&(e=(l-g)*g_dKoef_Board_W_to_H);a.W.L=e;a.W.P=g;a.W.N=h;a.W.K=l;a.c.style.left=parseInt(e+.5)+"px";a.c.style.top=parseInt(g+.5)+"px";a.c.style.width=parseInt(h-e+.5)+"px";a.c.style.height=parseInt(l-g+.5)+"px";a.c.width=parseInt(h-e+.5);a.c.height=parseInt(l-g+.5);d=a.ha.length;for(f=0;f<d;f++)qb(a.ha[f],h-e,l-g)}}function Qb(a){var c=new Fc;c.ec=a;c.c=document.getElementById(a);return c};var sa=0,Gc=1,Aa=2,t=new function(){this.Ab=this.e=this.d=0;this.Qb=Gc;this.r=this.C=this.Ma=!1;this.w=null;this.va=-1;this.Hb=this.Gb=this.sa=0;this.ob=this.Qa=!1},J=new function(){this.r=this.C=this.Ma=!1;this.w=null;this.Ra=this.$b=0};function Wa(a){J.Ma=a.altKey;J.C=void 0!==a.metaKey?a.ctrlKey||a.metaKey:a.ctrlKey;J.r=a.shiftKey;J.w=a.srcElement?a.srcElement:a.target;J.$b=a.charCode;J.Ra=a.keyCode;J.Hc=a.which}function la(a){if(!a.Qa||a.ob){if(a.pageX||a.pageY)t.d=a.pageX,t.e=a.pageY;else if(a.clientX||a.clientY)t.d=a.clientX,t.e=a.clientY;t.Ma=a.altKey;t.r=a.shiftKey;t.C=a.ctrlKey||a.metaKey;t.Qb=Gc;t.Qa||(t.w=a.srcElement?a.srcElement:a.target);if(3<Math.abs(t.d-t.Gb)||3<Math.abs(t.e-t.Hb))t.va=-1,t.sa=0}}window.onmousemove=function(a){t.Qa&&void 0!=t.w&&null!=t.w&&void 0!=t.w.onmousemove&&null!=t.w.onmousemove&&(t.ob=!0,t.w.onmousemove(a),t.ob=!1)};window.onmouseup=function(a){if(!1===window.Sb&&(window.Sb=!0,t.Qa&&void 0!=t.w.onmouseup&&null!=t.w.onmouseup))t.w.onmouseup(a,!0)};var rb=-1,Na=0,Oa=1,Pa=2,F=3,Qa=4,dc=5,ec=6;function I(a,c,b,d){this.Wb={d:void 0===a?0:a,e:void 0==c?0:c};this.n=void 0===b?Na:b;this.gb=void 0===d?"":d}I.prototype.ta=function(){return this.Wb.d};I.prototype.ua=function(){return this.Wb.e};I.prototype.qb=function(a){this.n=a};var Hc={};function T(a,c,b){this.n=void 0===a?0:a;this.Xb=void 0===c?null:c;this.Ub=void 0===b?0:b}T.prototype.v=function(){return this.Xb};T.prototype.qb=function(a){this.n=a};T.prototype.Ta=function(a){this.Xb=a};function Ic(){Y=X=0}function s(a,c,b,d){this.pa=a;this.ja=c;this.ia=b;this.sb="undefined"===typeof d?255:d}s.prototype={};function Q(a){return"rgba("+a.pa+","+a.ja+","+a.ia+","+a.sb/255+")"}function S(a){var c=new Ic;c.d=a&255;c.e=a>>8&255;return c}function Jc(a){for(var c=[],b=0,d=a.length;b<d;b++)c.push(a[b]);return c}function Ua(a){if("string"!=typeof a)return!1;for(var c=0;c<a.length;c++){var b=a.charCodeAt(c);if(48>b||57<b)return!1}return!0}function Va(a,c){return a>c?1:c>a?-1:0};var D=0,y=1,B=2,jb=0,ib=2,Yb=460,Wb=Yb,Zb=17.51/23.61,Xb=Zb;function Kc(a,c,b,d){this.qc=c;this.u=b;this.Z=a;this.t=d;this.s=new Lc;this.k=null;this.Tb=[];this.Q=new Mc(this);this.oc=0;this.h=this.Q;this.Ja=this.Fa=0;this.la=y;this.Ga=this.wb=0;this.cb=2}n=Kc.prototype;n.Sa=function(a){var c=new Nc(this);if(void 0!==a&&""!==a){c.i=[];c.a=0;c.ma=0;c.tb=[];c.U=!0;for(var b=c.Ha=0,d=a.length,f=[],e=!1;b<d;){(e||32<a.charCodeAt(b))&&f.push(a.charAt(b));if(3<=f.length&&"["==f[f.length-1]){var g=f[f.length-3]+f[f.length-2];if("C"==f[f.length-2]&&"UC"!=g||"AN"==g||"BR"==g||"BT"==g||"CP"==g||"DT"==g||"EV"==g||"GN"==g||"GC"==g||"ON"==g||"OT"==g||"PB"==g||"PC"==g||"PW"==g||"RE"==g||"RO"==g||"RU"==g||"SO"==g||"TM"==g||"US"==g||"WR"==g||"WT"==g)e=!0}else e&&1<=f.length&&"]"==f[f.length-1]&&(2>f.length||"\\"!=f[f.length-2])&&(e=!1);b++}c.i=f;c.Ha=c.i.length;Oc(c)||alert("Error occurs, while read SGF")}C(this,this.Q);this.Q.Oa()};n.wa=function(){this.Tb=[];this.Q=new Mc(this);Pc(this)};function Ba(a,c){for(var b=a.h;null!=b.J&&0<c;)b=b.J,c--;C(a,b)}function Ea(a,c){if(1===c)fb(a)&&Ka(a);else{for(var b=0;b<c;b++)fb(a);C(a,a.h)}}n.Oa=function(){for(var a=this.h;!Qc(a);){var c=a.J;if(null===c&&a!==this.Q)return;a=c}a.Oa();C(this,a)};n.pb=function(a){this.la=a;this.h.pb(a)};n.ga=function(a,c,b){this.h.ga(a,c,b)};function Ja(a,c){var b=new Mc(a),d=b.J=a.h;d.o.push(b);d.A=d.o.length-1;a.h=b;a.Ga++;!0===c&&a.Z.jc()}n.Ka=function(a,c){this.h.Ka(a,c)};n.La=function(a){this.h.La(a)};n.B=function(a,c){this.h.B(a,c)};n.X=function(a){this.h.B(513,a)};n.ra=function(a,c){this.h.ra(a,c)};n.ib=function(a,c){this.h.fb.ub||(this.h.fb.ub=!0);for(var b=0,d=c.length;b<d;b++)this.h.ib(c[b],a)};n.hb=function(a){this.h.hb(a)};n.jb=function(a){this.h.jb(a)};n.Pa=function(){return this.h.Pa()};function Ka(a){if(a.k){if(1===a.k.V){var c=a.k;c.V=0;Da(c)}a.k.t={};a.Ua()}for(var c=0,b=a.h.H.length;c<b;c++){var d=a.h.H[c],f=d.v(),e=d.Ub;switch(d.n){case 1:d=S(f);Rc(a,d.d,d.e,y,!1);break;case 2:d=S(f);Rc(a,d.d,d.e,B,!1);break;case 257:for(var g=0;g<e;g++)d=S(f[g]),Sc(a,d.d,d.e,y,-1);break;case 258:for(g=0;g<e;g++)d=S(f[g]),Sc(a,d.d,d.e,B,-1);break;case 259:for(g=0;g<e;g++)d=S(f[g]),Sc(a,d.d,d.e,D,-1);break;case 260:a.la=f;break;case 529:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.B(new I(d.d,d.e,Pa,""));break;case 530:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.B(new I(d.d,d.e,Qa,""));break;case 531:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.B(new I(d.d,d.e,Oa,""));break;case 532:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.B(new I(d.d,d.e,Na,""));break;case 533:a.k&&(d=S(f.gc),a.k.B(new I(d.d,d.e,F,f.Text)));break;case 513:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.X(d.d,d.e);break;case 769:a.Z&&a.Z.Ec(Math.floor(f));break;case 770:a.Z&&a.Z.Gc(Math.floor(f))}}a.k&&(a.h.fb.ub&&(c=a.k,c.V=1,Da(c)),a.h.Pa()&&(b=a.h.$,c=b.ta(),b=b.ua(),0!=c&&0!=b&&bc(a.k,c,b)),Ta(a.k));a.pc&&a.pc.O(a.h.zb)}function Rc(a,c,b,d,f){if(0!=c||0!=b){a.u&&!0!==f&&a.u.Cc();Sc(a,c,b,d,a.wb+1,f);var e=null;if(null!==(e=Bc(a.s,c,b,d,!1))&&0<e.q()){c=e.q();for(b=0;b<c;b++){var g=S(e.v(b));Sc(a,g.d,g.e,D,-1)}a.u&&!0!==f&&a.u.fc(e);y===d?a.Fa+=c:a.Ja+=c}else if(null!==(e=Cc(a.s,c,b,d))&&0<e.q()){c=e.q();for(b=0;b<c;b++)g=S(e.v(b)),Sc(a,g.d,g.e,D,-1);a.u&&!0!==f&&a.u.fc(g_nGroupSize);y===d?a.Ja+=c:a.Fa+=c}else a.s.fa.wa()}a.la=y===d?B:y;a.wb++}function fb(a){if(0===a.h.o.length||-1===a.h.A)return!1;a.h=eb(a.h,a.h.A);a.Ga++;return!0}n.Ua=function(){this.k&&this.h.Ua(this.cb,this.k)};function C(a,c){for(var b=a.s,d=new Lc(b.I,b.Y),f=b.I*b.Y,e=0;e<f;e++){var g=b.T[e],h=d.T[e];h.Ea=g.Ea;h.Ia=g.Ia}Pc(a);a.s.mb();a.u&&a.u.Ac();a:{b=c.J;for(f=c;null!=b;){e=!1;g=0;for(h=b.o.length;g<h;g++)if(f===eb(b,g)){Dc(b,g);e=!0;break}if(!e){b=!1;break a}f=b;b=b.J}b=!0}if(b){for(a.h=a.Q;a.h!=c&&0<a.h.o.length;){b=a.h.H.length;for(f=0;f<b;f++)switch(h=a.h.H[f],e=h.v(),g=h.Ub,h.n){case 1:h=S(e);Rc(a,h.d,h.e,y,!0);break;case 2:h=S(e);Rc(a,h.d,h.e,B,!0);break;case 257:for(var l=0;l<g;l++)h=S(e[l]),a.s.O(h.d,h.e,y,-1);break;case 258:for(l=0;l<g;l++)h=S(e[l]),a.s.O(h.d,h.e,B,-1);break;case 259:for(l=0;l<g;l++)h=S(e[l]),a.s.O(h.d,h.e,D,-1)}if(!fb(a))break}a.k&&ac(a.k,d);Ka(a);a.u&&a.u.Bc()}}function kb(a,c){c!==a.cb&&(a.cb=c,a.Ua())}function Pc(a){a.h=a.Q;a.Fa=0;a.Ja=0;a.wb=0;a.Ga=0}function Sc(a,c,b,d,f,e){a.s.O(c,b,d,f);a.k&&!0!==e&&La(a.k,c,b,d)};"use strict;";function fc(){this.da=this.ea=0}fc.prototype.wa=function(){this.da=this.ea=0};fc.prototype.O=function(a,c){this.ea=a;this.da=c};function Tc(a,c){this.Ea=void 0===a?D:a;this.Ia=void 0===c?-1:c}Tc.prototype.mb=function(){this.Ea=D;this.Ia=-1};Tc.prototype.Ta=function(a){this.Ea=a};Tc.prototype.v=function(){return this.Ea};Tc.prototype.nb=function(){return this.Ia};function Uc(){this.Aa=[];this.ka=[]}Uc.prototype.q=function(){return this.ka.length};Uc.prototype.v=function(a){return this.ka[a]};function Vc(a,c,b){c=(b<<8)+c;b=0;for(var d=a.ka.length;b<d;b++)if(a.ka[b]==c)return!0;return!1}function Lc(a,c){this.I=void 0===a?19:a;this.Y=void 0===c?19:c;this.T=null;Wc(this);this.fa=new fc}function Wc(a){var c=a.I*a.Y;a.T=Array(c);for(var b=0;b<c;b++)a.T[b]=new Tc}Lc.prototype.mb=function(){for(var a=this.I*this.Y,c=0;c<a;c++)this.T[c].mb()};Lc.prototype.q=function(){return{d:this.I,e:this.Y}};Lc.prototype.O=function(a,c,b,d){a=(c-1)*this.I+(a-1);this.T[a].Ta(b);void 0!==d&&null!==d&&-1!==d&&(this.T[a].Ia=d)};function E(a,c,b){return a.T[(b-1)*a.I+(c-1)].v()}Lc.prototype.nb=function(a,c){return this.T[(c-1)*this.I+(a-1)].nb()};function Cc(a,c,b,d){var f=new Uc;Xc(a,c,b,d,f);return 0<f.q()?f:null}function Bc(a,c,b,d,f){var e;switch(d){case y:e=B;break;case B:e=y;break;default:return null}d=new Uc;!0!==Vc(d,c+1,b)&&Xc(a,c+1,b,e,d);!0!==Vc(d,c-1,b)&&Xc(a,c-1,b,e,d);!0!==Vc(d,c,b+1)&&Xc(a,c,b+1,e,d);!0!==Vc(d,c,b-1)&&Xc(a,c,b-1,e,d);e=d.q();if(1==e){c=(b<<8)+c;b=d.v(0);e=a.fa;if(b===e.ea&&c===e.da&&1==f)return null;a.fa.O(c,b)}else if(1<e)a.fa.wa();else if(0>=e)return null;return d}function Yc(a,c,b,d,f){if(c>a.I||1>c||b>a.Y||1>b)return!1;var e=E(a,c,b);return D===e?!0:d===e?Zc(a,c,b,d,f):!1}function Zc(a,c,b,d,f){var e;a:{e=(b<<8)+c;for(var g=0,h=f.Aa.length;g<h;g++)if(f.Aa[g]==e){e=!0;break a}f.Aa.push(e);e=!1}return!0===e?!1:!0===Yc(a,c+1,b,d,f)||!0===Yc(a,c-1,b,d,f)||!0===Yc(a,c,b+1,d,f)||!0===Yc(a,c,b-1,d,f)?!0:!1}function Xc(a,c,b,d,f){c>a.I||1>c||b>a.Y||1>b||d!==E(a,c,b)||(!0!==Zc(a,c,b,d,f)&&(f.ka=f.ka.concat(f.Aa)),f.Aa=[])};function $c(a,c){this.eb=a;this.n=c}n=$c.prototype;n.ta=function(){return S(this.eb).d};n.ua=function(){return S(this.eb).e};n.v=function(){return this.eb};n.Ta=function(a){this.eb=a};n.qb=function(a){this.n=a};function Mc(a){this.nc=++a.oc;this.o=[];this.A=-1;this.J=null;this.H=[];this.$=new $c(0,D);this.zb="";this.fb=new Ed;a.Tb[this.nc]=this}function eb(a,c){return void 0!==a.o[c]?a.o[c]:a.o[a.A]}function Dc(a,c){a.A=c>=a.o.length?a.o.length-1:c}n=Mc.prototype;n.Pa=function(){return D===this.$.n?!1:!0};n.La=function(a){this.zb+=a};n.ib=function(a,c){this.fb.mc[""+a]=c};n.Oa=function(){for(var a=this;0<a.o.length;)Dc(a,0),a=eb(a,0)};function Qc(a){for(var c=null;null!==(c=a.J);){if(0!=c.A)return!1;a=c}return!0}n.ga=function(a,c,b){a=(c<<8)+a;this.H.push(new T(y===b?1:2,a));D===this.$.n&&(this.$.Ta(a),this.$.qb(b))};n.Ka=function(a,c){var b=new T(y===a?257:B===a?258:259,Jc(c),c.length);this.H.push(b)};n.B=function(a,c){var b=0;switch(a){case Pa:b=529;break;case rb:b=Hc.zc;break;case Oa:b=531;break;case Na:b=532;break;case F:b=Hc.Dc;break;case Qa:b=Hc.d}b=new T(b,Jc(c),c.length);this.H.push(b)};n.ra=function(a,c){this.H.push(new T(533,{Text:a,gc:c}))};n.pb=function(a){this.H.push(new T(260,a))};n.hb=function(a){this.H.push(new T(769,a))};n.jb=function(a){this.H.push(new T(770,a))};n.Ua=function(a,c){c.c.Xa.g.c.getContext("2d").clearRect(0,0,c.b.G,c.b.D);switch(a){case 2:Fd(this,c,-1);break;case 1:var b=this.J;null!==b&&Fd(b,c,this.$.v())}};function Fd(a,c,b){if(c)for(var d=0,f=a.o.length;d<f;d++){var e=eb(a,d).$;if(D!==e.n&&b!==e.v()){var g=S(e.v()),e=c;if(e.b.m){var h=(e.b.F/2-1)/2,l=e.b.m,m=l[g.d-1].d,g=l[g.e-1].e,l=e.c.Xa.g.c.getContext("2d");l.fillStyle=Q(e.rc);l.beginPath();l.arc(m,g,h,0,2*Math.PI,!1);l.fill()}}}};function Nc(a){this.f=a;this.i=[];this.ma=this.a=0;this.tb=[];this.U=!0;this.Ha=0}function Oc(a){a.f.wa();if("("===a.i[0]&&";"===a.i[1])for(a.a++;a.a<a.Ha&&(")"!==a.i[a.a]||0!==a.ma);){var c=a.i[a.a];if(";"===c){1!=a.a?Ja(a.f,!1):a.f.h=a.f.Q;a:{c=a;c.a++;for(var b=c.i[c.a],d=c.i[c.a+1];void 0!==b&&")"!==b&&";"!==b&&"("!==b;){switch(b){case "A":switch(d){case "B":Gd(c,y);break;case "E":Gd(c,D);break;case "W":Gd(c,B);break;case "N":b=c;b.a+=3;V(b);break;case "P":b=c;b.a+=3;V(b);break;default:W(c)}break;case "B":switch(d){case "[":Hd(c,y);break;case "R":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;case "L":b=c;b.a+=3;b.f.hb(Id(b));break;default:W(c)}break;case "C":switch(d){case "[":b=c;b.a+=2;for(d="";"]"!==b.i[b.a]||"\\"===b.i[b.a-1];)"]"==-b.i[b.a+1]&&"\\"===b.i[b.a]?(d+="]",b.a++):d=13==b.i[b.a].charCodeAt(0)?d+"<br>\n":10==b.i[b.a].charCodeAt(0)?d+"<br>\n":133==b.i[b.a].charCodeAt(0)?d+"<br>\n":d+b.i[b.a],b.a++;b.a++;b.f.La(d);break;case "A":b=c;b.a+=3;V(b);break;case "P":b=c;b.a+=3;V(b);break;case "R":Jd(c,Pa);break;default:W(c)}break;case "D":switch(d){case "D":b=c;b.a+=3;V(b);break;default:W(c)}break;case "E":switch(d){case "V":b=c;b.a+=3;V(b);break;default:W(c)}break;case "F":switch(d){case "F":W(c);break;default:W(c)}break;case "G":switch(d){case "N":b=c;b.a+=3;V(b);break;case "C":b=c;b.a+=3;V(b);break;case "M":b=c;b.a+=3;1!==Kd(b)&&(b.U=!1);break;default:W(c)}break;case "H":switch(d){case "A":b=c;b.a+=3;Kd(b);break;default:W(c)}break;case "K":switch(d){case "M":b=c;b.a+=3;Id(b);break;default:W(c)}break;case "L":switch(d){case "B":b=c;for(b.a+=3;;){d=b.i[b.a];b.a++;var f=b.i[b.a];b.a++;d=d.charCodeAt(0)-96;f=f.charCodeAt(0)-96;b.a++;for(var e="";"]"!==b.i[b.a]&&b.a<b.Ha;)e+=b.i[b.a],b.a++;b.f.ra(e,(f<<8)+d);if("]"!==b.i[b.a]){b.U=!1;break}b.a++;if("["!==b.i[b.a])break;b.a++}break;default:W(c)}break;case "M":switch(d){case "A":Jd(c,Qa);break;default:W(c)}break;case "O":switch(d){case "N":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;default:W(c)}break;case "P":switch(d){case "B":b=c;b.a+=3;V(b);break;case "C":b=c;b.a+=3;V(b);break;case "W":b=c;b.a+=3;V(b);break;default:W(c)}break;case "R":switch(d){case "E":b=c;b.a+=3;V(b);break;case "O":b=c;b.a+=3;V(b);break;case "U":b=c;b.a+=3;V(b);break;default:W(c)}break;case "S":switch(d){case "Q":Jd(c,Oa);break;case "T":b=c;b.a+=3;switch(Kd(b)){case 0:kb(b.f,2);break;case 1:kb(b.f,1);break;default:kb(b.f,0)}break;case "Z":d=c;d.a+=3;b=Kd(d);0>=b&&(b=19);d=d.f;f=d.s;e=b;f.I=b;f.Y=e;Wc(f);f.fa.wa();d.k&&(b=d.k,gb(b),hb(b));break;case "O":b=c;b.a+=3;V(b);break;default:W(c)}break;case "T":switch(d){case "R":Jd(c,Na);break;case "M":b=c;b.a+=3;V(b);break;case "B":Ld(c,y);break;case "W":Ld(c,B);break;default:W(c)}break;case "U":switch(d){case "S":b=c;b.a+=3;V(b);break;default:W(c)}break;case "W":switch(d){case "[":Hd(c,B);break;case "R":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;case "L":b=c;b.a+=3;b.f.jb(Id(b));break;default:W(c)}break;default:W(c)}if(!c.U){c=!1;break a}b=c.i[c.a];d=c.i[c.a+1]}c=!0}if(!c)return!1}else if("("===c)a.tb[a.ma]=a.f.h,a.ma++,a.a++;else if(")"===c)a.ma--,a.f.h=a.tb[a.ma],a.a++;else return!1}else return!1;return!0}function V(a,c){void 0===c&&(c="]");for(var b="";void 0!==a.i[a.a]&&c!==a.i[a.a];)b+=a.i[a.a],a.a++;void 0===a.i[a.a]&&(a.U=!1);a.a++;return b}function Id(a){a=parseFloat(V(a,void 0));return isNaN(a)?0:a}function Kd(a){a=parseInt(V(a,void 0));return isNaN(a)?0:a}function W(a){for(;;){for(;void 0!==a.i[a.a]&&"]"!==a.i[a.a]&&a.a<a.Ha;)for(a.a++;"]"===a.i[a.a]&&"\\"===a.i[a.a-1];)a.a++;a.a++;if("["!==a.i[a.a])break}}function Gd(a,c){a.a+=3;var b=[];if("]"!==a.i[a.a]){for(;;){var d=a.i[a.a];a.a++;var f=a.i[a.a];a.a++;b.push((f.charCodeAt(0)-96<<8)+(d.charCodeAt(0)-96));if("]"!==a.i[a.a]){a.U=!1;return}a.a++;if("["!==a.i[a.a])break;a.a++}a.f.Ka(c,b)}}function Hd(a,c){a.a+=2;if("]"==a.i[a.a])a.f.ga(0,0,c);else{var b=a.i[a.a];a.a++;var d=a.i[a.a];a.a++;var f=a.f.s.q();"t"===b&&"t"===d&&19>=f.d&&19>=f.e?a.f.ga(0,0,c):(a.f.ga(b.charCodeAt(0)-96,d.charCodeAt(0)-96,c),"]"!==a.i[a.a]&&(a.U=!1))}a.a++}function Jd(a,c){var b=0;a.a+=3;var d=[];if("]"!==a.i[a.a]){for(;;){var f=a.i[a.a];a.a++;var e=a.i[a.a];a.a++;d[b]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);b++;if("]"!==a.i[a.a]){a.U=!1;return}a.a++;if("["!==a.i[a.a])break;a.a++}a.f.B(c,d)}}function Ld(a,c){var b=0;a.a+=3;var d=[];if("]"!==a.i[a.a]){for(;;){var f=a.i[a.a];a.a++;var e=a.i[a.a];a.a++;d[b]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);b++;if("]"!==a.i[a.a]){a.U=!1;return}a.a++;if("["!==a.i[a.a])break;a.a++}a.f.ib(c,d)}};function Ed(){this.ub=!1;this.mc={}};function Z(){}Z.prototype.ac=function(){return new Kc};Z.prototype.bc=function(a,c){var b=new ca;b.f=a;b.l=a.s;b.f.k=b;b.c.g=Qb(c);var d=b.c.g.c,f=c+"_BoardCanvas",e=c+"_LinesCanvas",g=c+"_ShadowsCanvas",h=c+"_StonesCanvas",l=c+"_VariantsCanvas",m=c+"_MarksCanvas",p=c+"_TargetCanvas",u=c+"_EventDiv";Ob(d,f);Ob(d,e);Ob(d,g);Ob(d,h);Ob(d,l);Ob(d,m);Ob(d,p);var k=document.createElement("div");k.setAttribute("id",u);k.setAttribute("style","position:absolute;padding:0;margin:0;");k.setAttribute("oncontextmenu","return false;");d.appendChild(k);d=b.c.g;Pb(b.c.p,d,f);Pb(b.c.m,d,e);Pb(b.c.S,d,g);Pb(b.c.xa,d,h);Pb(b.c.Xa,d,l);Pb(b.c.M,d,m);Pb(b.c.Va,d,p);Pb(b.c.Event,d,u);k.onmousemove=b.vc;k.onmouseout=b.wc;k.onmousedown=b.uc;k.onkeydown=b.sc;k.onkeyup=b.tc;k.tabIndex=-1;k.style.Ic=!0;k.style.outline=0;b.Wa();b.c.Event.g.c.focus()};Z.prototype.Sa=function(a,c){a.Sa(c)};Z.prototype.Wa=function(a){(a=a.k)&&a.Wa()};window.GoBoardApi=new Z;Z.prototype.Create_GameTree=Z.prototype.ac;Z.prototype.Create_SimpleBoard=Z.prototype.bc;Z.prototype.Load_Sgf=Z.prototype.Sa;Z.prototype.Update_Size=Z.prototype.Wa;}());