/*
 * Copyright (C) 2014  Ilya Kirillov 
 * email: ilya_kirillov@inbox.ru
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3.0 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
*/
(function(){var r;function aa(a){this.m=a;this.w=this.g=null;this.Fd=!0;this.La=0;this.Ib=!1;this.Hd=this.Jb=this.Kb=this.Za=this.$a=0;this.ia=null;this.b={B:0,s:0,ja:0,Ja:0,de:2,u:null,ce:null,t:null,Hc:null,Ad:[],Ce:Array(361),Yb:null,kc:null,Fb:null,Gb:null,se:null,te:null,ne:null,oe:null,qe:null,re:null,he:null,$d:null,ae:null};this.Ma=new x(231,188,95,255);this.Nd=new x(0,0,0,255);this.nf=new x(255,0,0,128);this.pb={Te:new x(232,196,115,255),df:new x(255,255,255,255),Se:new x(0,0,0,255),bf:new x(141,141,141,255),Xe:new x(112,95,54,255),Ye:new x(112,95,54,255)};this.a={d:null,t:{d:null},u:{d:null},Cb:{d:null},Y:{d:null},ic:{d:null},qa:{d:null},Aa:{d:null},Event:{d:null}};this.va={e:-1,f:-1};this.X={};this.uc=-1;var b=this;this.Bc=function(a){ba(a);a=b.Tb(y.e,y.f);a=ca(b,a.e,a.f);da(b,a.e,a.f,!1)};this.Sb=function(a){ba(a);ea(b)};this.Rb=function(a){fa(a);b.a.Event.d.a.focus();var d=b.Tb(y.e,y.f),d=ca(b,d.e,d.f);b.Wd(d.e,d.f,y);a.preventDefault();a.stopPropagation();return!1};this.sf=function(a){ga(a);if(16===ha.bc&&2===b.La)y.Z=!0,b.Qa();else{var d=ha,f=d.bc;if(8===f||46===f){if(d=b.g,f=d.i.C,null!==f)for(var e=0,g=z(f);e<g;e++)if(d.i===f.D(e)){g=f;g.ua.splice(e,1);g.U>=e&&g.U--; -1===g.U&&0<g.ua.length&&(g.U=0);d.i=f;d.J&&d.J.Sa();D(d,f);break}}else if(13===f)d=prompt("Enter here code of ur sgf file",""),b.g.Ab(d);else if(37===f)d.fa&&d.Z?(d=b.g,D(d,d.ma)):d.fa?ia(b.g,5):ia(b.g,1);else if(38===f)d.fa?b.g.Yc():ja(b.g);else if(39===f)if(d.fa&&d.Z){for(d=b.g;ka(d););D(d,d.i)}else d.fa?la(b.g,5):la(b.g,1);else 40===f?ma(b.g):112===f?E(b,0):113===f?E(b,1):114===f?E(b,2):115===f?E(b,3):116===f?E(b,4):117===f?E(b,5):118===f?E(b,6):119===f?E(b,7):120===f?E(b,8):189===f?(d=b.g.rc,d++,d>na&&(d=oa),pa(b.g,d)):192===f&&(d=!0===b.Ib?!1:!0,d!==b.Ib&&(b.Ib=d,qa(b),b.Pa(!0)))}a.preventDefault()};this.tf=function(a){ga(a);16===ha.bc&&2===b.La&&(y.Z=!1,b.Qa())};this.Xd=function(){return setTimeout(function(){b.Vd();b.Td();var a=b.a.t.d.a.width,d=b.a.t.d.a.height,f=b.a.Cb.d.a.getContext("2d"),e=2*Math.floor(Math.floor(b.Kb*a)/2)+1;b.b.ja=e;b.b.Hc=f.createImageData(e,e);b.b.cf=f.createImageData(e,e);b.b.Yb=f.createImageData(e,e);b.b.kc=f.createImageData(e,e);for(var g=b.b.Hc.data,h=b.b.cf.data,m=b.b.Yb.data,l=b.b.kc.data,k=e/2-.5,q=k-.2,v=Math.sqrt(3),p=0;p<e;p++)for(var u=0;u<e;u++){var t=p-k,C=u-k,H=q-Math.sqrt(t*t+C*C),w=4*(p*e+e-u-1);if(0<=H){var F=q*q-t*t-C*C,F=0<F?Math.sqrt(F)*v:0,J=t,Z=C,s=Math.sqrt(6*(J*J+Z*Z+F*F)),s=(2*F-J+Z)/s,F=0;.9<s&&(F=10*(s-.9));J=255;.8>=H&&(H=(.8-H)/.8,J=.7,t-C<q/3&&(J=1),J=parseInt(255*(1-H*J)));t=parseInt(10+10*s+140*F);g[w+0]=t;g[w+1]=t;g[w+2]=t;g[w+3]=J;m[w+0]=t;m[w+1]=t;m[w+2]=t;m[w+3]=parseInt(J/2);t=parseInt(200+10*s+45*F);h[w+0]=t;h[w+1]=t;h[w+2]=t;h[w+3]=J;l[w+0]=t;l[w+1]=t;l[w+2]=t;l[w+3]=parseInt(J/2)}else g[w+0]=0,g[w+1]=0,g[w+2]=0,g[w+3]=0,m[w+0]=0,m[w+1]=0,m[w+2]=0,m[w+3]=0,h[w+0]=0,h[w+1]=0,h[w+2]=0,h[w+3]=0,l[w+0]=0,l[w+1]=0,l[w+2]=0,l[w+3]=0}g=[];m=[];for(w=0;28>w;w++)for(g[w]=f.createImageData(e,e),m[w]=g[w].data,p=0;p<e;p++)for(u=0;u<e;u++)k=4*(p*e+u),m[w][k+0]=h[k+0],m[w][k+1]=h[k+1],m[w][k+2]=h[k+2],m[w][k+3]=h[k+3];m.push(l);m.push(h);h=.9;u=Array(a);for(l=0;l<a;l++)u[l]=(Math.sin(18*l/a)+1)/20+(Math.sin(3*l/a)+1)/10;w=Array(d);for(p=0;p<d;p++)w[p]=.2*Math.cos(5*p/d)+.1*Math.sin(11*p/d);f=Array(a*d);for(p=0;p<d;p++)for(l=0;l<a;l++)h=75*(u[l]+w[p])+.5,h-=Math.floor(h),h=.2>h?1-h/2:.4>h?1-(.4-h)/2:1,f[l+p*a]=h;d=b.b.u;u=(b.b.ja-1)/2;w=m.length;for(k=0;k<w;k++){q=m[k];h=l=0;switch(k){case 0:l=0;h=3;break;case 1:l=0;h=4;break;case 2:l=0;h=5;break;case 3:l=0;h=6;break;case 4:l=1;h=3;break;case 5:l=1;h=4;break;case 6:l=1;h=5;break;case 7:l=1;h=6;break;case 8:l=2;h=3;break;case 9:l=2;h=4;break;case 10:l=2;h=5;break;case 11:l=2;h=6;break;case 12:h=l=3;break;case 13:l=3;h=4;break;case 14:l=3;h=5;break;case 15:l=3;h=6;break;case 16:l=4;h=3;break;case 17:h=l=4;break;case 18:l=4;h=5;break;case 19:l=4;h=6;break;case 20:l=5;h=3;break;case 21:l=5;h=4;break;case 22:h=l=5;break;case 23:l=5;h=6;break;case 24:l=6;h=3;break;case 25:l=6;h=4;break;case 26:l=6;h=5;break;case 27:h=l=6}v=d[l].e-u;s=d[h].f-u;for(p=0;p<e;p++)for(l=0;l<e;l++)h=f[v+l+(s+p)*a],t=4*(l+p*e),q[t+0]*=h,q[t+1]*=h,q[t+2]*=h}b.b.Ad=g;for(a=0;19>a;a++)for(e=0;19>e;e++)b.b.Ce[e+19*a]=Math.floor(Math.random()*(b.b.Ad.length-1));b.Ud();a=b.b.ja;b.b.Fb=ra(b,a,a,.05*a,new x(0,0,0,255));b.b.Gb=ra(b,a,a,.05*a,new x(255,255,255,255));b.b.se=b.V(a,a,.05*a,new x(0,0,0,255));b.b.te=b.V(a,a,.05*a,new x(255,255,255,255));b.b.ne=sa(b,a,a,.05*a,new x(0,0,0,255));b.b.oe=sa(b,a,a,.05*a,new x(255,255,255,255));b.b.qe=ta(b,a,a,new x(0,0,0,255));b.b.re=ta(b,a,a,new x(255,255,255,255));b.b.he=ua(b,a,a,.05*a,new x(255,0,0,255));b.b.$d=ua(b,a,a,.05*a,new x(0,0,0,255));b.b.ae=ua(b,a,a,.05*a,new x(255,255,255,255));b.Pa()},20)};this.qf=function(a){a.preventDefault();return!1};this.rf=function(a){a.preventDefault();if(0<a.dataTransfer.files.length&&FileReader){a=a.dataTransfer.files[0];var d=new FileReader;d.onload=function(a){b.g.Ab(a.target.result)};d.readAsText(a);va(b)}}}r=aa.prototype;r.ga=function(a,b){this.m&&(this.m.G=this);this.g=b;this.w=b.G;this.g.j=this;this.a.d=G(a);var c=this.a.d.a,d=a+"_BoardCanvas",f=a+"_LinesCanvas",e=a+"_ShadowsCanvas",g=a+"_StonesCanvas",h=a+"_VariantsCanvas",m=a+"_MarksCanvas",l=a+"_TargetCanvas",k=a+"_EventDiv";this.aa(c,d);this.aa(c,f);this.aa(c,e);this.aa(c,g);this.aa(c,h);this.aa(c,m);this.aa(c,l);var c=this.Fa(c,k),q=this.a.d;this.P(this.a.t,q,d);this.P(this.a.u,q,f);this.P(this.a.Y,q,e);this.P(this.a.Cb,q,g);this.P(this.a.ic,q,h);this.P(this.a.qa,q,m);this.P(this.a.Aa,q,l);this.P(this.a.Event,q,k);c.onmousemove=this.Bc;c.onmouseout=this.Sb;c.onmousedown=this.Rb;c.onkeydown=this.sf;c.onkeyup=this.tf;c.tabIndex=-1;c.style.ef=!0;c.style.outline=0;c.ondragover=this.qf;c.ondrop=this.rf;return q};function va(a){a.a.Event.d.a.focus()}r.M=function(){var a=this.a.d.a.clientWidth,b=this.a.d.a.clientHeight;a!==b&&(b=a=Math.min(a,b));this.a.d.za(a,b);qa(this);this.Pa()};function wa(a,b,c,d){if(a.b.u){var f=a.a.Cb.d.a.getContext("2d"),e=a.a.Y.d.a.getContext("2d"),g=a.b.ja,h=(g-1)/2,m=a.b.u,l=a.b.Ja,k=m[b-1].e-h,h=m[c-1].f-h;switch(d){case I:f.putImageData(a.b.Hc,k,h);e.putImageData(a.b.Y,k+l,h+l);break;case K:f.putImageData(a.b.Ad[a.b.Ce[b-1+19*(c-1)]],k,h);e.putImageData(a.b.Y,k+l,h+l);break;default:f.clearRect(k,h,g,g),e.clearRect(k+l,h+l,g,g)}b===a.va.e&&c===a.va.f&&(I===d||K===d?ea(a):a.Qa())}}r.ya=function(a,b){var c=(b<<8)+a;delete this.X[""+c];c===this.uc&&(this.X[""+c]=new L(a,b,xa,""))};r.ea=function(a){ya(this,a.ub(),a.vb(),a)};function za(a){Aa(a);a.Fd=!1}r.md=function(){return this.Fd};function E(a,b){if(a.La!==b){a.La=b;a.Qa();if(1===b){var c=a.w;c.Ba=[];for(var d=1;d<=c.T;d++)for(var f=1;f<=c.Q;f++)c.Ba[Ba(c,f,d)]=M;Ca(c,!1);a.g.$b()}a.g.Db()}}r.aa=function(a,b){var c=document.createElement("canvas");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};r.Fa=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};r.P=function(a,b,c){a.d=G(c);a=a.d;N(a.h,0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.I=O|P|Q|R;b.H(a)};r.Tb=function(a,b){var c=Da(this.a.t.d.a);return{e:a-c.e,f:b-c.f}};function qa(a){var b=a.w.S(),c=b.e,d=b.f;if(!0===a.Ib){var b=Ea/(2*Fa+c),c=(Ea-c*b)/2,f=Ga/(2*Ha+d),d=(Ga-d*f)/2;a.$a=(d+f/2)/Ga;a.Za=(c+b/2)/Ea}else b=Ea/(2*Fa+c-1),c=(Ea-(c-1)*b)/2,f=Ga/(2*Ha+d-1),d=(Ga-(d-1)*f)/2,a.$a=d/Ga,a.Za=c/Ea;a.Kb=b/Ea;a.Jb=f/Ga;a.Hd=4/Ea}r.Pa=function(a){var b=this.a.t.d.a.width,c=this.a.t.d.a.height;if(b!=this.b.B||c!=this.b.s||null===this.b.t||null!==this.ia||!0===a){if(null!==this.ia&&clearTimeout(this.ia),this.ia=this.Xd(),0!==b&&0!==c){a=this.a.t.d.a.getContext("2d");a.fillStyle=S(this.pb.Te);a.fillRect(0,0,b,c);var d=this.a.u.d.a.getContext("2d");a=this.Za*b;var f=this.$a*c,e=this.Kb*b,g=this.Jb*c,h=this.w.S();d.clearRect(0,0,b,c);d.strokeStyle=S(this.pb.Ye);for(var m=b-a,l=0;l<h.f;l++){var k=f+l*g;d.beginPath();d.moveTo(a,k);d.lineTo(m,k);d.stroke()}for(var m=c-f,q=0;q<h.e;q++)k=a+q*e,d.beginPath(),d.moveTo(k,f),d.lineTo(k,m),d.stroke();if(h.e===h.f&&(9===h.e||13===h.e||19===h.e)){d.fillStyle=S(this.pb.Xe);l=Math.max(2,this.Hd*b/2);q=[];switch(h.e){case 9:q=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:q=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:q=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var v=0,p=q.length;v<p;v++)m=a+q[v][0]*e,k=f+q[v][1]*e,d.beginPath(),d.arc(m,k,l,0,2*Math.PI,!1),d.fill()}d=this.a.Cb.d.a.getContext("2d");d.clearRect(0,0,b,c);d.strokeStyle=S(this.pb.bf);d.lineWidth=1;v=S(this.pb.Se);p=S(this.pb.df);for(l=1;l<=h.f;l++)for(q=1;q<=h.e;q++){m=this.w.A(q,l);if(I===m)d.fillStyle=v;else if(K===m)d.fillStyle=p;else continue;m=a+(q-1)*e;k=f+(l-1)*g;d.beginPath();d.arc(m,k,e/2,0,2*Math.PI,!1);d.fill();d.stroke()}this.a.Y.d.a.getContext("2d").clearRect(0,0,b,c);this.a.ic.d.a.getContext("2d").clearRect(0,0,b,c);this.a.qa.d.a.getContext("2d").clearRect(0,0,b,c);this.a.Aa.d.a.getContext("2d").clearRect(0,0,b,c)}}else{this.a.t.d.a.getContext("2d").putImageData(this.b.t,0,0);if(!0===this.Ib&&this.b.u){b=this.a.t.d.a.getContext("2d");c=this.b.B;g=this.b.s;a=this.w.S();for(h=0;h<a.e;h++){d=2*this.b.ja/3;f=(d-1)/2;m=this.b.u;e=m[h].e-f;m=this.$a*g/3-f;k=new String;switch(h+1){case 1:k="A";break;case 2:k="B";break;case 3:k="C";break;case 4:k="D";break;case 5:k="E";break;case 6:k="F";break;case 7:k="G";break;case 8:k="H";break;case 9:k="J";break;case 10:k="K";break;case 11:k="L";break;case 12:k="M";break;case 13:k="N";break;case 14:k="O";break;case 15:k="P";break;case 16:k="Q";break;case 17:k="R";break;case 18:k="S";break;case 19:k="T";break;case 20:k="a";break;case 21:k="b";break;case 22:k="c";break;case 23:k="d";break;case 24:k="e";break;case 25:k="f";break;case 26:k="g";break;case 27:k="h";break;case 28:k="j";break;case 29:k="k";break;case 30:k="l";break;case 31:k="m";break;case 32:k="n";break;case 33:k="o";break;case 34:k="p";break;case 35:k="q";break;case 36:k="r";break;case 37:k="s";break;case 38:k="t"}l=2*d/3;q=Ia(k)?"Arial":"Helvetica, Arial, Verdana";q=l+"px "+q;b.fillStyle="rgb(0,0,0)";b.font=q;l=d/2+l/3;d=(d-b.measureText(k).width)/2;b.fillText(k,e+d,m+l);m=g-this.$a*g/3-f;b.fillText(k,e+d,m+l)}for(g=0;g<a.f;g++)d=2*this.b.ja/3,f=(d-1)/2,m=this.b.u,e=this.Za*c/3-f,m=m[g].f-f,k=a.f-g+"",l=2*d/3,q=Ia(k)?"Arial":"Helvetica, Arial, Verdana",q=l+"px "+q,b.fillStyle="rgb(0,0,0)",b.font=q,l=d/2+l/3,d=(d-b.measureText(k).width)/2,b.fillText(k,e+d,m+l),e=c-this.Za*c/3-f,b.fillText(k,e+d,m+l)}Ja(this);Aa(this);Ka(this)}};r.Vd=function(){var a=this.a.t.d.a.width,b=this.a.t.d.a.height,c=this.a.t.d.a.getContext("2d");if(0!==a&&0!==b){for(var c=c.createImageData(a,b),d=.9,f=this.Ma.q,e=this.Ma.o,g=this.Ma.n,h=Array(a),m=0;m<a;m++)h[m]=(Math.tan(300*m/a)+1)/2+(Math.tan(100*m/a)+1)/10;for(var l=Array(b),k=0;k<b;k++)l[k]=.02*Math.tan(k/b);for(var q,v,k=0;k<b;k++)for(m=0;m<a;m++){d=40*(h[m]+l[k])+.5;d-=Math.floor(d);d=.2>d?1-d/2:.4>d?1-(.4-d)/2:1;if(k==b-1||k==b-2&&m<a-2||m>=a-1||m==a-2&&k<b-1)d/=2;0==k||1==k&&1<m||0==m||1==m&&1<k?(q=128+f*d/2,v=128+e*d/2,d=128+g*d/2):(q=f*d,v=e*d,d*=g);var p=4*(m+k*a);c.data[p+0]=q;c.data[p+1]=v;c.data[p+2]=d;c.data[p+3]=255}this.b.t=c;this.b.B=a;this.b.s=b;this.ia=null}};r.Td=function(){var a=this.b.B,b=this.b.s;if(0!==a&&0!==b){for(var c=this.Za*a,d=this.$a*b,b=this.Jb*b,f=this.Kb*a,e=this.w.S(),g=Array(e.e),h=c,m=d,l=0;l<e.e;l++)h=c+l*f,m=d+l*b,g[l]={e:Math.floor(h+.5),f:Math.floor(m+.5)};this.b.u=g;a=Math.max(2,Math.ceil(this.Hd*a/2));c=2*a+1;d=this.b;b=this.Nd;f=document.createElement("canvas").getContext("2d").createImageData(c,c);e=a;g=-1;h=e*e;for(l=0;e>g;){g++;m=Math.sqrt(h-g*g);m=Math.ceil(m)-m;m<=l&&e--;var k=Math.floor(255*(1-m)),q=a+e,v=a+e,p=a+g,u=a+g,t=a-e,C=a-e,l=a-g,H=a-g;La(f,q,u,k,c,b);La(f,p,v,k,c,b);La(f,t,u,k,c,b);La(f,l,v,k,c,b);La(f,q,H,k,c,b);La(f,p,C,k,c,b);La(f,t,H,k,c,b);La(f,l,C,k,c,b);for(var k=q-1,v=v-1,t=t+1,C=C+1,q=f,w=k,F=c,J=b,Z=t;Z<=w;Z++)La(q,Z,u,255,F,J);u=f;q=v;w=c;F=b;for(J=C;J<=q;J++)La(u,p,J,255,w,F);p=f;u=c;for(q=b;t<=k;t++)La(p,t,H,255,u,q);H=f;t=c;for(k=b;C<=v;C++)La(H,l,C,255,t,k);l=m}d.ce=f;this.b.de=a}};function Ja(a,b){if(a.b.u){var c=a.b.B,d=a.b.s,f=a.a.u.d.a.getContext("2d"),e=a.w.S(),g=a.b.u;f.clearRect(0,0,c,d);if(e.e===e.f&&(9===e.e||13===e.e||19===e.e)){var d=a.b.ce,h=a.b.de,m=[];switch(e.e){case 9:m=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:m=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:m=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var l=0,k=m.length;l<k;l++)f.putImageData(d,g[m[l][0]].e-h,g[m[l][1]].f-h)}for(var h=g[0].e,m=g[g.length-1].e,l=g[0].f,k=g[g.length-1].f,q=f.createImageData(1,k-l),v=f.createImageData(m-h,1),p=a.Nd,u=0;u<k-l;u++)d=4*u,q.data[d+0]=p.q,q.data[d+1]=p.o,q.data[d+2]=p.n,q.data[d+3]=p.Bd;for(u=0;u<m-h;u++)d=4*u,v.data[d+0]=p.q,v.data[d+1]=p.o,v.data[d+2]=p.n,v.data[d+3]=p.Bd;for(u=0;u<e.e;u++)f.putImageData(q,g[u].e,g[0].f),f.putImageData(v,g[0].e,g[u].f);if(void 0!==b)for(c=(2*Math.floor(parseInt(a.Jb*c)/2)+1-1)/2,e=g[1].e-g[0].e+2,h=g[1].f-g[0].f+2,d=0;d<b.length;d++)m=b[d].e,l=b[d].f,M===a.w.A(m,l)&&f.clearRect(g[m-1].e-c,g[l-1].f-c,e,h)}}function La(a,b,c,d,f,e){b=4*(b+c*f);a.data[b+0]=e.q;a.data[b+1]=e.o;a.data[b+2]=e.n;a.data[b+3]=d}function Aa(a){var b=a.b.B,c=a.b.s;a.a.Cb.d.a.getContext("2d").clearRect(0,0,b,c);a.a.Y.d.a.getContext("2d").clearRect(0,0,b,c);b=a.w.S();for(c=1;c<=b.f;c++)for(var d=1;d<=b.e;d++)wa(a,d,c,a.w.A(d,c))}r.Ud=function(){var a=this.a.Y.d.a.getContext("2d"),b=this.b.ja;this.b.Y=a.createImageData(b,b);a=this.b.Y.data;this.b.Ja=Math.max(parseInt(.15*b),3);for(var c=(b-5)/2+1,d=0;d<b;d++)for(var f=0;f<b;f++){var e=Math.abs(d-c),g=Math.abs(f-c),e=Math.sqrt(g*g+e*e)/c,e=1>e?.15+.75*(1-e):0,g=4*(b*d+f);a[g+0]=0;a[g+1]=0;a[g+2]=0;a[g+3]=parseInt(255*e)}};r.Qa=function(){da(this,this.va.e,this.va.f,!0)};function da(a,b,c,d){var f=y;if(-1===b||-1===c||0===b||0===c)ea(a);else if(null===a.ia&&null!==a.b.u&&(void 0===d&&(d=!1),b!==a.va.e||c!==a.va.f||!0===d)){a.va.e=b;a.va.f=c;var e=a.b.B,g=a.b.s;d=a.a.Aa.d.a.getContext("2d");d.clearRect(0,0,e,g);var g=(a.b.ja-1)/2,h=a.b.u,e=h[b-1].e-g,g=h[c-1].f-g;b=a.w.A(b,c);switch(a.La){case 0:M===b&&(I===a.g.bb?d.putImageData(a.b.Yb,e,g):d.putImageData(a.b.kc,e,g));break;case 1:I===b?d.putImageData(a.b.Gb,e,g):K===b&&d.putImageData(a.b.Fb,e,g);break;case 2:I===b?d.putImageData(a.b.Gb,e,g):K===b?d.putImageData(a.b.Fb,e,g):f.Z?d.putImageData(a.b.kc,e,g):d.putImageData(a.b.Yb,e,g);break;default:I===b?d.putImageData(a.b.Gb,e,g):d.putImageData(a.b.Fb,e,g)}}}function ea(a){var b=a.b.B,c=a.b.s;a.a.Aa.d.a.getContext("2d").clearRect(0,0,b,c);a.va.e=-1;a.va.f=-1}function ca(a,b,c){var d=a.b.B,f=a.b.s,e=a.Za*d,g=a.$a*f,f=a.Jb*f,d=a.Kb*d,h=0;a=a.w.S();for(h=0;h<a.f-1&&c>g+f*h+f/2;h++);for(c=c=0;c<a.e-1&&b>e+d*c+d/2;c++);return{e:c+1,f:h+1}}function ra(a,b,c,d,f){a=a.a.qa.d.a.getContext("2d");a.clearRect(0,0,b,c);a.strokeStyle=S(f);a.fillStyle=S(f);a.lineWidth=d;a.beginPath();a.moveTo(1*b/4,1*c/4);a.lineTo(3*b/4,3*c/4);a.moveTo(3*b/4,1*c/4);a.lineTo(1*b/4,3*c/4);a.stroke();return a.getImageData(0,0,b,c)}r.V=function(a,b,c,d,f){void 0===f&&(f=1);var e=this.a.qa.d.a.getContext("2d");e.clearRect(0,0,a,b);e.globalAlpha=f;e.strokeStyle=S(d);e.fillStyle=S(d);e.lineWidth=c;var g=a/2;c=3*b/4;d=.1*a;f=Math.sqrt(g*g-(c-g)*(c-g))+g;g=-Math.sqrt(g*g-(c-g)*(c-g))+g;e.beginPath();e.moveTo(a/2,d);e.lineTo(f-d,c);e.lineTo(g+d,c);e.closePath();e.stroke();return e.getImageData(0,0,a,b)};function sa(a,b,c,d,f){a=a.a.qa.d.a.getContext("2d");a.clearRect(0,0,b,c);a.strokeStyle=S(f);a.fillStyle=S(f);a.lineWidth=Math.floor(d+.5);var e=b/2,g=-c/2*Math.sqrt(2)/2+c/2;f=Math.floor(Math.sqrt(e*e-(g-e)*(g-e))+e-d);e=Math.ceil(-Math.sqrt(e*e-(g-e)*(g-e))+e+d);g=Math.ceil(g+d);d=Math.floor(c/2*Math.sqrt(2)/2+c/2-d);a.beginPath();a.moveTo(f,g);a.lineTo(e,g);a.lineTo(e,d);a.lineTo(f,d);a.closePath();a.stroke();return a.getImageData(0,0,b,c)}function ta(a,b,c,d){a=a.a.qa.d.a.getContext("2d").createImageData(b,c);for(var f=0;f<c;f++)for(var e=0;e<b;e++){var g=4*(f*b+e);f>=c/3&&f<=2*c/3&&e>=b/3&&e<=2*b/3?(a.data[g+0]=d.q,a.data[g+1]=d.o,a.data[g+2]=d.n,a.data[g+3]=255):a.data[g+3]=0}return a}function ua(a,b,c,d,f){a=a.a.qa.d.a.getContext("2d");a.clearRect(0,0,b,c);var e=b/2,g=4*d;a.strokeStyle=S(f);a.fillStyle=S(f);a.lineWidth=d;a.beginPath();a.arc(b/2,c/2,e-g,0,2*Math.PI,!1);a.stroke();return a.getImageData(0,0,b,c)}function Ma(a,b,c){a=a.X[""+((c<<8)+b)];return void 0!==a?a:null}function ya(a,b,c,d){xa===d.r?Na(a,b,c):a.X[""+((c<<8)+b)]=d}function Na(a,b,c){if(0>=b||0>=c)a.uc=0;else{var d=(c<<8)+b;void 0===a.X[""+d]&&(a.X[""+d]=new L(b,c,xa,""));a.uc=d}}function Ka(a){a.a.qa.d.a.getContext("2d").clearRect(0,0,a.b.B,a.b.s);var b=[],c;for(c in a.X){var d=a.X[c];Oa(a,d);Pa===d.r&&b.push({e:d.ub(),f:d.vb()})}Ja(a,b)}function Oa(a,b){if(a.b.u){var c=b.ub(),d=b.vb(),f=b.r,e=a.a.qa.d.a.getContext("2d"),g=a.b.ja,h=(g-1)/2,m=a.b.u,l=m[c-1].e-h,h=m[d-1].f-h,c=a.w.A(c,d);switch(f){case Qa:e.putImageData(a.b.qe,l,h);break;case Ra:e.putImageData(a.b.re,l,h);break;case xa:e.putImageData(a.b.he,l,h);break;case Sa:e.putImageData(c===I?a.b.ae:a.b.$d,l,h);break;case Ta:e.putImageData(c===I?a.b.oe:a.b.ne,l,h);break;case Ua:e.putImageData(c===I?a.b.te:a.b.se,l,h);break;case Va:e.putImageData(c===I?a.b.Gb:a.b.Fb,l,h);break;case Pa:f=b.xc,d=2>=f.length?2*g/3:g/2,m=d+"px "+(Ia(f)?"Arial":"Helvetica, Arial, Verdana"),e.fillStyle=c===I?"rgb(255,255,255)":"rgb(0,0,0)",e.font=m,e.fillText(f,l+(g-e.measureText(f).width)/2,h+(g/2+d/3))}}}r.Wd=function(a,b,c){switch(this.La){case 0:if(Wa==c.Zd)1<=this.g.Mb&&(ia(this.g,1),Xa(this,a,b));else if(c.Z&&c.fa)this.g.qd(I===this.g.bb?K:I),this.Qa();else if(!0===c.fa){var d=new String;switch(a){case 1:d="A";break;case 2:d="B";break;case 3:d="C";break;case 4:d="D";break;case 5:d="E";break;case 6:d="F";break;case 7:d="G";break;case 8:d="H";break;case 9:d="J";break;case 10:d="K";break;case 11:d="L";break;case 12:d="M";break;case 13:d="N";break;case 14:d="O";break;case 15:d="P";break;case 16:d="Q";break;case 17:d="R";break;case 18:d="S";break;case 19:d="T"}this.g.Vb(d+b)}else if(c.Z){d=this.g;d.$&&d.$.af(!0);var f=d.i;D(d,d.ma);for(c=0;1E3>c&&M===d.G.A(a,b);)la(d,1),c++;M===d.G.A(a,b)&&D(d,f);d.$&&d.$.af(!1)}else Xa(this,a,b);break;case 1:if(!0===c.fa)this.g.Rc(),E(this,0);else{d=this.w;f=d.A(a,b);if(M!==f)if(d.tc.ba(),c=d.Ba[Ba(d,a,b)],I!==c&&K!==c){d.F.ba();Ya(d,a,b,f);for(var e in d.tc.la)c=T(e|0),d.F.ba(),Za(d,c.e,c.f,3-f),$a(d.F,d,3);Ca(d,!0);d.F.ba();Ya(d,a,b,f);$a(d.F,d,3-f)}else d.F.ba(),Ya(d,a,b,f),$a(d.F,d,3),Ca(d,!0);this.g.$b()}break;case 2:!0===this.g.i.hb()&&(ab(this.g,!0,!0),bb(this.g));d=I;M!==this.w.A(a,b)?d=M:c.Z&&(d=K);wa(this,a,b,d);this.w.L(a,b,d,-1);this.g.Ub(d,[(b<<8)+a]);break;case 3:cb(this,Ua,a,b);break;case 4:cb(this,Ta,a,b);break;case 5:cb(this,Sa,a,b);break;case 6:cb(this,Va,a,b);break;case 7:a:{f=Ma(this,a,b);if(null!==f&&Pa===f.r)this.g.ya([(b<<8)+a]),this.ya(a,b);else{f="";c.Z&&(f=prompt("Enter the label that you want to add to board here. For best results, keep your label to one or two letters.",""));if(void 0==f||""===f||null===f){f=[];c=-1;for(d in this.X)if(e=this.X[d],Pa==e.r){e=e.xc;var g=e.charCodeAt(0);1==e.length&&65<=g&&90>=g&&(f[g]=1)}for(d=65;90>=d;d++)if(void 0===f[d]||""==f[d]){c=d;break}f=-1==c?null:String.fromCharCode(c);if(null===f){alert("Sorry, all the standard labels are used up! To add more labels, you will have to shift click on the board and make up ur own labels to add.");break a}}d=new L(a,b,Pa,f);this.g.rb(f,(b<<8)+a);ya(this,a,b,d)}Ka(this)}break;case 8:a:{d=Ma(this,a,b);if(null!==d&&Pa===d.r)this.g.ya([(b<<8)+a]),this.ya(a,b);else{d="";if(c.Z){d=this.w.Xc(a,b);if(-1==d){alert("Sorry, no move has been made at that location, so you can't mark it with the move number!");break a}d=""+d}if(void 0===d||""===d||null===d){d=[];c=0;for(f in this.X)e=this.X[f],Pa===e.r&&Ia(e.xc)&&(d[c]=parseInt(e.xc),c++);if(0>=c)d="1";else{d.sort(db);e=f=0;for(var g=!1,h=0;h<c;h++){if(d[h]>f+1){e=f+1;g=!0;break}f=d[h]}g||(e=f+1);d=""+e}}f=new L(a,b,Pa,d);this.g.rb(d,(b<<8)+a);ya(this,a,b,f)}Ka(this)}}};function cb(a,b,c,d){var f=Ma(a,c,d);if(null!==f&&b===f.r){if(a.g.ya([(d<<8)+c]),a.ya(c,d),a.b.u){b=(a.b.ja-1)/2;var e=a.b.u,f=e[c-1].e-b,e=e[d-1].f-b;a.a.qa.d.a.getContext("2d").clearRect(f,e,2*b,2*b);b=T(a.uc);c===b.e&&d===b.f&&(Na(a,c,d),Oa(a,Ma(a,c,d)))}}else f=new L(c,d,b,""),a.g.ea(b,[(d<<8)+c]),ya(a,c,d,f),Oa(a,f)}function Xa(a,b,c){if(M===a.w.A(b,c)){var d=I===a.g.bb?I:K,f=!1,e=new eb,f=a.w.cb;e.W=f.W;e.ab=f.ab;a.w.L(b,c,d,-1);f=null!==fb(a.w,b,c,d,!0)?!0:null!==gb(a.w,b,c,d)?!1:!0;a.w.L(b,c,M,-1);var g=a.w.cb;g.W=e.W;g.ab=e.ab;if(1==f){a:{for(var e=a.g,f=(c<<8)+b,g=0,h=z(e.i);g<h;g++){var m=e.i.D(g),l=m.Ea,k=l.r;if(f===l.ca()&&d===k&&(I===d||K===d)){hb(e.i,g);e.i=m;e.Mb++;e.J&&ib(e.J);break a}}ab(e,!1,!0);e.i.gb(b,c,d);e.J&&(e.J.Sa(),ib(e.J))}bb(a.g)}}};function jb(a){this.m=a;this.g=null;this.O=this.r=0;this.Gd=!1;this.b={be:null,le:null,ge:null,Yd:null,me:null};this.a={d:null,Zb:{d:null}};this.Je=new x(217,217,217,255);this.mf=new x(0,0,0,255);this.Ld=new x(54,101,179,255);this.Md=new x(255,255,255,255);this.kf=new x(140,140,140,255);this.T=this.Q=0;var b=this;this.Rb=function(){b.Ac();3!==b.O&&(b.O=1,kb(b),b.Wd())};this.zf=function(){3!==b.O&&(b.O=2,kb(b))};this.wf=function(){3!==b.O&&(1!==b.O&&(b.O=2),kb(b))};this.Sb=function(){3!==b.O&&(b.O=b.Gd?4:0,kb(b))};this.Ac=function(){if(b.g){var a=b.g;a.j&&va(a.j)}}}r=jb.prototype;r.ga=function(a,b,c){this.g=b;this.r=c;if(this.m)switch(this.r){case 1:this.m.k.Fc.push(this);break;case 2:this.m.k.Gc.push(this);break;case 3:this.m.k.Ha.push(this);break;case 4:this.m.k.Ia.push(this);break;case 5:this.m.k.Wc.push(this);break;case 6:this.m.k.Vc.push(this);break;case 7:this.m.k.Ua.push(this);break;case 8:this.m.k.Va.push(this);break;case 9:this.m.k.Kc.push(this);break;case 10:this.m.k.Mc.push(this);break;case 11:this.m.k.Jc.push(this);break;case 12:this.m.k.Pc.push(this);break;case 13:this.m.k.Nc.push(this);break;case 14:this.m.k.Ic.push(this);break;case 15:this.m.k.Qc.push(this);break;case 16:this.m.k.Oc.push(this);break;case 17:this.m.k.Lc.push(this)}this.a.d=G(a);b=this.a.d.a;b.setAttribute("title",lb(this));c=document.createElement("canvas");c.setAttribute("id",a+"_canvas");c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");b.appendChild(c);this.a.Zb.d=G(a+"_canvas");a=this.a.Zb.d;N(a.h,0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.I=O|P|Q|R;this.a.d.H(a);b.onmousedown=this.Rb;b.onmouseup=this.zf;b.onmouseover=this.wf;b.onmouseout=this.Sb;b.onfocus=this.Ac;b.tabIndex=-1;this.M()};r.M=function(){this.Q=this.a.d.a.clientWidth;this.T=this.a.d.a.clientHeight;this.a.d.za(this.Q,this.T);this.Pa()};function mb(a,b){!0===b&&3===a.O?(a.O=0,kb(a)):!1===b&&3!==a.O&&(a.O=3,kb(a))}function nb(a,b){a.Gd!==b&&(a.Gd=b,!0===b&&0===a.O?(a.O=4,kb(a)):!1===b&&4===a.O&&(a.O=0,kb(a)))}r.Pa=function(){var a=this.T,b=this.Q;0!==b&&0!==a&&(this.b.Yd=ob(this,this.Ld,this.Md,b,a),this.b.ge=ob(this,this.Ld,this.Md,b,a),this.b.le=ob(this,this.Je,this.mf,b,a),this.b.be=ob(this,this.Je,this.kf,b,a),this.b.me=ob(this,this.Ld,this.Md,b,a),kb(this))};function ob(a,b,c,d,f){var e=a.a.Zb.d.a.getContext("2d");e.fillStyle=S(b);e.fillStyle=S(b);e.fillRect(0,0,d,f);e.fillStyle=S(c);e.strokeStyle=S(c);c=Math.min(d,f);var g=(d-c)/2,h=(f-c)/2;switch(a.r){case 1:a.V(c,g,h,e,-1);g=Math.ceil(g+c/10+.5);h=Math.ceil(h+c/5+.5);b=Math.floor(c/10+.5);a=Math.floor(3*c/5+.5);e.fillRect(g,h,b,a);break;case 2:a.V(c,g-c/10,h,e,-1);g=Math.ceil(g+8*c/10+.5);h=Math.ceil(h+c/5+.5);b=Math.floor(c/10+.5);a=Math.floor(3*c/5+.5);e.fillRect(g,h,b,a);break;case 3:a.V(c,g-c/10,h,e,-1);break;case 4:a.V(c,g-c/10,h,e,1);break;case 5:a.V(c,g+c/10,h,e,1);g=Math.ceil(g+c/10+.5);h=Math.ceil(h+c/5+.5);b=Math.floor(c/10+.5);a=Math.floor(3*c/5+.5);e.fillRect(g,h,b,a);break;case 6:a.V(c,g,h,e,1);g=Math.ceil(g+8*c/10+.5);h=Math.ceil(h+c/5+.5);b=Math.floor(c/10+.5);a=Math.floor(3*c/5+.5);e.fillRect(g,h,b,a);break;case 7:b=Math.ceil(g+.2*c+.5);a=Math.ceil(g+.35*c+.5);var m=Math.ceil(g+.57*c+.5),g=Math.ceil(g+.92*c+.5),l=Math.ceil(h+.2*c+.5),k=Math.ceil(h+.38*c+.5),q=Math.ceil(h+.52*c+.5),v=Math.ceil(h+.6*c+.5),p=Math.ceil(h+.68*c+.5);c=Math.ceil(h+.84*c+.5);e.beginPath();e.moveTo(b,l);e.lineTo(a,l);e.lineTo(a,q);e.lineTo(m,q);e.lineTo(m,k);e.lineTo(g,v);e.lineTo(m,c);e.lineTo(m,p);e.lineTo(b,p);e.closePath();e.fill();break;case 8:b=Math.ceil(g+.2*c+.5);a=Math.ceil(g+.35*c+.5);m=Math.ceil(g+.57*c+.5);g=Math.ceil(g+.92*c+.5);l=Math.ceil(h+.8*c+.5);k=Math.ceil(h+.62*c+.5);q=Math.ceil(h+.48*c+.5);v=Math.ceil(h+.4*c+.5);p=Math.ceil(h+(1-.68)*c+.5);c=Math.ceil(h+(1-.84)*c+.5);e.beginPath();e.moveTo(b,l);e.lineTo(a,l);e.lineTo(a,q);e.lineTo(m,q);e.lineTo(m,k);e.lineTo(g,v);e.lineTo(m,c);e.lineTo(m,p);e.lineTo(b,p);e.closePath();e.fill();break;case 9:m=Math.ceil(g+.5*c-c/10+.5);l=Math.ceil(h+.5*c-c/10+.5);b=Math.ceil(.25*c+.5);e.fillStyle=S(new x(255,255,255));e.strokeStyle=S(new x(0,0,0));e.beginPath();e.arc(m,l,b,0,2*Math.PI,!1);e.fill();e.stroke();e.fillStyle=S(new x(0,0,0));m=Math.ceil(g+.5*c+c/10+.5);l=Math.ceil(h+.5*c+c/10+.5);b=Math.ceil(.25*c+.5);e.beginPath();e.arc(m,l,b,0,2*Math.PI,!1);e.fill();break;case 10:a=e.createImageData(c,c);m=c/5|0;l=4*c/5|0;for(k=0;k<c;k++)for(q=0;q<c;q++)v=4*(k*c+q),k>=m&&k<=l&&q>=m&&q<=l?c-k>=q||k===m||k===l||q===m||q===l?(a.data[v+0]=0,a.data[v+1]=0,a.data[v+2]=0):(a.data[v+0]=255,a.data[v+1]=255,a.data[v+2]=255):(a.data[v+0]=b.q,a.data[v+1]=b.o,a.data[v+2]=b.n),a.data[v+3]=255;e.putImageData(a,g,h);break;case 11:m=Math.ceil(g+.75*c+.5);l=Math.ceil(h+.125*c+.5);b=Math.ceil(.25*c+.5);a=Math.ceil(.02*c+.5);e.fillRect(m,l,b,a);m=Math.ceil(g+.875*c+.5);l=Math.ceil(h+.5);b=Math.ceil(.02*c+.5);a=Math.ceil(.25*c+.5);e.fillRect(m,l,b,a);m=Math.ceil(g+.5);l=Math.ceil(h+.875*c+.5);b=Math.ceil(.25*c+.5);a=Math.ceil(.02*c+.5);e.fillRect(m,l,b,a);m=Math.ceil(g+.5*c-c/10+.5);l=Math.ceil(h+.5*c-c/10+.5);b=Math.ceil(.25*c+.5);e.fillStyle=S(new x(255,255,255));e.strokeStyle=S(new x(0,0,0));e.beginPath();e.arc(m,l,b,0,2*Math.PI,!1);e.fill();e.stroke();e.fillStyle=S(new x(0,0,0));m=Math.ceil(g+.5*c+c/10+.5);l=Math.ceil(h+.5*c+c/10+.5);b=Math.ceil(.25*c+.5);e.beginPath();e.arc(m,l,b,0,2*Math.PI,!1);e.fill();break;case 12:l=c/2;a=3*c/4;b=.1*c;k=Math.sqrt(l*l-(a-l)*(a-l))+l;q=-Math.sqrt(l*l-(a-l)*(a-l))+l;e.lineWidth=Math.ceil(.05*c+.5);e.beginPath();e.moveTo(g+c/2,h+2*b);e.lineTo(g+k-b,h+a+b);e.lineTo(g+q+b,h+a+b);e.closePath();e.stroke();break;case 13:l=c/2;b=.05*c;m=-c/2*Math.sqrt(2)/2+c/2;a=c/2*Math.sqrt(2)/2+c/2;k=Math.sqrt(l*l-(m-l)*(m-l))+l;q=-Math.sqrt(l*l-(m-l)*(m-l))+l;l=Math.floor(g+k-b);g=Math.ceil(g+q+b);m=Math.ceil(h+m+b);h=Math.floor(h+a-b);e.lineWidth=Math.ceil(.05*c+.5);e.beginPath();e.moveTo(l,m);e.lineTo(g,m);e.lineTo(g,h);e.lineTo(l,h);e.closePath();e.stroke();break;case 14:a=.05*c;l=c/2;b=4*a;e.lineWidth=Math.ceil(a+.5);e.beginPath();e.arc(g+c/2,h+c/2,l-b,0,2*Math.PI,!1);e.stroke();break;case 15:b=g+.25*c;a=g+.75*c;l=h+.25*c;k=h+.75*c;e.lineWidth=Math.ceil(.05*c+.5);e.beginPath();e.moveTo(b,l);e.lineTo(a,k);e.moveTo(a,l);e.lineTo(b,k);e.stroke();break;case 16:b="A";a=.8*c;m=g+(c-e.measureText(b).width)/2;e.font=a+"px Arial";e.fillText(b,m,h+c/2+a/3);break;case 17:b="1",a=.8*c,m=g+(c-e.measureText(b).width)/2,e.font=a+"px Helvetica, Arial, Verdana",e.fillText(b,m,h+c/2+a/3)}return e.getImageData(0,0,d,f)}r.V=function(a,b,c,d,f){var e=Math.ceil(b+a/5+.5);b=Math.ceil(b+4*a/5+.5);var g=Math.ceil(c+a/5+.5),h=Math.ceil(c+a/2+.5);a=Math.ceil(c+4*a/5+.5);0>f?(d.beginPath(),d.moveTo(e,h),d.lineTo(b,g),d.lineTo(b,a)):(d.beginPath(),d.moveTo(e,g),d.lineTo(b,h),d.lineTo(e,a));d.closePath();d.fill()};function kb(a){var b=a.a.Zb.d.a.getContext("2d"),c=null;switch(a.O){case 2:c=a.b.ge;break;case 1:c=a.b.Yd;break;case 3:c=a.b.be;break;case 4:c=a.b.me;break;default:case 0:c=a.b.le}b.putImageData(c,0,0)}r.Wd=function(){if(this.g)switch(this.r){case 1:var a=this.g;D(a,a.ma);break;case 2:ia(this.g,5);break;case 3:ia(this.g,1);break;case 4:la(this.g,1);break;case 5:la(this.g,5);break;case 6:for(a=this.g;ka(a););D(a,a.i);break;case 7:ma(this.g);break;case 8:ja(this.g);break;case 9:E(this.g.j,0);break;case 10:E(this.g.j,1);break;case 11:E(this.g.j,2);break;case 12:E(this.g.j,3);break;case 13:E(this.g.j,4);break;case 14:E(this.g.j,5);break;case 15:E(this.g.j,6);break;case 16:E(this.g.j,7);break;case 17:E(this.g.j,8)}};function lb(a){switch(a.r){case 1:return"Back to the start";case 2:return"Back 5 moves";case 3:return"Back";case 4:return"Forward";case 5:return"Forward 5 moves";case 6:return"Go to the end";case 7:return"Next variant";case 8:return"Previous variant";case 9:return"Moves (F1)";case 10:return"Count Scores (F2)";case 11:return"Editor (F3)";case 12:return"Triangles (F4)";case 13:return"Squares (F5)";case 14:return"Circles (F6)";case 15:return"X marks (F7)";case 16:return"Text labels (F8)";case 17:return"Numeric labels (F9)"}};function pb(a){this.m=a;this.a={d:null,hc:{d:null}};var b=this;this.Pe=function(){b.g.pd(b.a.hc.d.a.value)}}pb.prototype.ga=function(a,b){this.g=b;this.a.d=G(a);var c=this.a.d.a,d=a+"_TextArea",f=document.createElement("textarea");f.setAttribute("id",d);f.setAttribute("style","position:absolute;padding:0;margin:0;resize:none;outline: none;-moz-appearance: none;");c.appendChild(f);f.onchange=this.Pe;f.onblur=this.Pe;c=this.a.d;this.a.hc.d=G(d);d=this.a.hc.d;N(d.h,0,0,2,2,!0,!0,!0,!0,-1,-1);d.I=O|P|Q|R;c.H(d);this.m&&this.m.Cd.push(this);this.M()};pb.prototype.sd=function(a){this.a.hc.d.a.value=a};pb.prototype.M=function(){this.a.d.za(this.a.d.a.clientWidth,this.a.d.a.clientHeight)};function qb(){this.na=this.ra=this.sa=this.pa=0;this.lc=this.nc=this.oc=this.mc=!1;this.qb=this.Ra=-1}function N(a,b,c,d,f,e,g,h,m,l,k){a.pa=b;a.sa=c;a.ra=d;a.na=f;a.mc=e;a.oc=g;a.nc=h;a.lc=m;a.Ra=l;a.qb=k}var P=1,O=2,R=4,Q=8;function rb(){this.h=new qb;this.I=P|O;this.a=this.cc=this.ke=null;this.Ga=new qb;this.R=[];this.kb=0}rb.prototype.jb=function(a){this.kb=a};rb.prototype.H=function(a){a.cc=this;this.R[this.R.length]=a};rb.prototype.za=function(a,b){if(null==this.cc)this.Ga.pa=0,this.Ga.sa=0,this.Ga.ra=a,this.Ga.na=b,null!==this.a&&sb(this,a,b);else{var c=0,d=0,f=0,e=0,c=this.I&5,d=this.I&10;P==c?(c=this.h.mc?this.h.pa:this.h.pa*a/1E3,f=-1!=this.h.Ra?c+this.h.Ra:this.h.nc?a-this.h.ra:this.h.ra*a/1E3):R==c?(f=this.h.nc?a-this.h.ra:this.h.ra*a/1E3,c=-1!=this.h.Ra?f-this.h.Ra:this.h.mc?this.h.pa:this.h.pa*a/1E3):(P|R)==c?(c=this.h.mc?this.h.pa:this.h.pa*a/1E3,f=this.h.nc?a-this.h.ra:this.h.ra*a/1E3):(c=this.h.pa,f=this.h.ra);O==d?(d=this.h.oc?this.h.sa:this.h.sa*b/1E3,e=-1!=this.h.qb?d+this.h.qb:this.h.lc?b-this.h.na:this.h.na*b/1E3):Q==d?(e=this.h.lc?b-this.h.na:this.h.na*b/1E3,d=-1!=this.h.qb?e-this.h.qb:this.h.oc?this.h.sa:this.h.sa*b/1E3):(O|Q)==d?(d=this.h.oc?this.h.sa:this.h.sa*b/1E3,e=this.h.lc?b-this.h.na:this.h.na*b/1E3):(d=this.h.sa,e=this.h.na);f<c&&(f=c);e<d&&(e=d);-2===this.h.Ra?f=c+(e-d)*g_dKoef_Board_W_to_H:-3===this.h.Ra&&(c=(e-d)*g_dKoef_Board_W_to_H);this.Ga.pa=c;this.Ga.sa=d;this.Ga.ra=f;this.Ga.na=e;this.a.style.left=parseInt(c+.5)+"px";this.a.style.top=parseInt(d+.5)+"px";this.a.style.width=parseInt(f-c+.5)+"px";this.a.style.height=parseInt(e-d+.5)+"px";this.a.width=parseInt(f-c+.5);this.a.height=parseInt(e-d+.5);sb(this,f-c,e-d)}};function sb(a,b,c){var d=a.R.length;if(1===a.kb&&2===d){var f=a.R[0],e=a.R[1],g=b-400>=c?b-c:400;N(f.h,0,0,g,1E3,!1,!1,!0,!1,-1,-1);f.I=P|Q|O;N(e.h,b-g,0,1E3,1E3,!0,!1,!1,!1,-1,-1);e.I=R|Q|O}else 2===a.kb&&1===d&&(f=a.R[0],e=Math.min(b,c),N(f.h,(b-e)/2,(c-e)/2,1E3,1E3,!0,!0,!0,!1,e,e),f.I=P|Q|O);for(f=0;f<d;f++)a.R[f].za(b,c)}function G(a){var b=new rb;b.ke=a;b.a=document.getElementById(a);return b}function tb(){this.a=this.cc=null;this.s=0;this.R=[]}tb.prototype.L=function(a){this.s=a};tb.prototype.H=function(a){a.cc=this;this.R[this.R.length]=a};tb.prototype.za=function(a,b){var c=b-this.s,d=a;d!==c&&(c=d=Math.min(d,c));var f=(b-this.s-c)/2;this.a.style.left=parseInt((a-d)/2+.5)+"px";this.a.style.top=parseInt(f+.5)+"px";this.a.style.width=parseInt(d+.5)+"px";this.a.style.height=parseInt(c+this.s+.5)+"px";this.a.width=parseInt(d+.5);this.a.height=parseInt(c+this.s+.5);for(var f=this.R.length,e=0;e<f;e++)this.R[e].za(d,c+this.s)};function ub(a){if(this.g=a)a.m=this;this.ob=null;this.Ca=[];this.k={Fc:[],Gc:[],Ha:[],Ia:[],Wc:[],Vc:[],Ua:[],Va:[],Kc:[],Mc:[],Jc:[],Pc:[],Nc:[],Ic:[],Qc:[],Oc:[],Lc:[]};this.vc=this.G=null;this.Cd=[];this.Ie=40;setTimeout(function(){b.Oe()},this.Ie);var b=this;this.Oe=function(){this.G&&this.G.md()&&za(this.G);this.vc&&this.vc.md()&&vb(this.vc);setTimeout(function(){b.Oe()},b.Ie)}}r=ub.prototype;r.Uc=function(a){var b=new aa(this);b.ga(a,this.g);va(b);this.Ca.push(b);this.M()};r.Tc=function(a){var b=this.g,c=G(a);wb(c.a,a+"div");var d=a+"div",f=new tb;f.ke=d;f.a=document.getElementById(d);f.L(25);var e=f.a;c.H(f);d=a+"_Board";a+="_Toolbar";wb(e,d);wb(e,a);e=G(d);N(e.h,0,0,1E3,25,!1,!1,!1,!0,-1,-1);e.I=O|P|R;f.H(e);e=new aa(this);e.ga(d,b);va(e);d=G(a);N(d.h,0,0,1E3,0,!1,!1,!1,!0,-1,25);d.I=P|Q|R;f.H(d);f=new xb(this);f.ga(a,b,{R:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]});this.ob=c;this.Ca.push(e);this.Ca.push(f);this.M()};r.Sc=function(a){var b=this.g,c=G(a),d=a+"GoBoard";wb(c.a,d);d=G(d);N(d.h,0,0,1,1,!1,!1,!0,!0,-1,-1);d.I=O|P|R|Q;c.H(d);d.jb(1);var f=a+"_Board",e=a+"_Panel";wb(d.a,f);wb(d.a,e);var g=G(f);a=G(e);d.H(g);d.H(a);wb(g.a,f+"_Centred");d=G(f);g.jb(2);g.H(d);d=new aa(this);d.ga(f,b);va(d);g=e+"_CaT";e+="_Navigator";wb(a.a,g);wb(a.a,e);f=G(g);N(f.h,0,0,1E3,500,!1,!1,!1,!1,-1,-1);f.I=O|P|R|Q;a.H(f);var h=G(e);N(h.h,0,500,1E3,1E3,!1,!1,!1,!1,-1,-1);h.I=O|P|R|Q;a.H(h);a=new yb(this);a.ga(e,b);e=g+"_Comments";g+="_Toolbar";wb(f.a,e);wb(f.a,g);h=G(e);N(h.h,0,0,1E3,25,!1,!1,!1,!0,-1,25);h.I=O|P|R|Q;f.H(h);h=G(g);N(h.h,0,0,1E3,0,!1,!1,!1,!0,-1,25);h.I=P|R|Q;f.H(h);f=new pb(this);f.ga(e,b);e=new xb(this);e.ga(g,b,{R:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]});this.Ca.push(d);this.Ca.push(a);this.Ca.push(f);this.Ca.push(e);this.ob=c;this.M();b.J&&b.J.Sa();b.Db()};r.M=function(){this.ob&&this.ob.za(this.ob.a.clientWidth,this.ob.a.clientHeight);for(var a=0,b=this.Ca.length;a<b;a++)this.Ca[a].M()};function wb(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c)}r.Db=function(a){for(var b=0,c=this.k.Fc.length;b<c;b++)mb(this.k.Fc[b],a.Ha);b=0;for(c=this.k.Gc.length;b<c;b++)mb(this.k.Gc[b],a.Ha);b=0;for(c=this.k.Ha.length;b<c;b++)mb(this.k.Ha[b],a.Ha);b=0;for(c=this.k.Ia.length;b<c;b++)mb(this.k.Ia[b],a.Ia);b=0;for(c=this.k.Wc.length;b<c;b++)mb(this.k.Wc[b],a.Ia);b=0;for(c=this.k.Vc.length;b<c;b++)mb(this.k.Vc[b],a.Ia);b=0;for(c=this.k.Ua.length;b<c;b++)mb(this.k.Ua[b],a.Ua);b=0;for(c=this.k.Va.length;b<c;b++)mb(this.k.Va[b],a.Va);b=0;for(c=this.k.Kc.length;b<c;b++)nb(this.k.Kc[b],0===a.oa);b=0;for(c=this.k.Mc.length;b<c;b++)nb(this.k.Mc[b],1===a.oa);b=0;for(c=this.k.Jc.length;b<c;b++)nb(this.k.Jc[b],2===a.oa);b=0;for(c=this.k.Pc.length;b<c;b++)nb(this.k.Pc[b],3===a.oa);b=0;for(c=this.k.Nc.length;b<c;b++)nb(this.k.Nc[b],4===a.oa);b=0;for(c=this.k.Ic.length;b<c;b++)nb(this.k.Ic[b],5===a.oa);b=0;for(c=this.k.Qc.length;b<c;b++)nb(this.k.Qc[b],6===a.oa);b=0;for(c=this.k.Oc.length;b<c;b++)nb(this.k.Oc[b],7===a.oa);b=0;for(c=this.k.Lc.length;b<c;b++)nb(this.k.Lc[b],8===a.oa)};r.sd=function(a){for(var b=0,c=this.Cd.length;b<c;b++)this.Cd[b].sd(a)};var zb=0,Ab=1,Wa=2,y=new function(){this.Zd=this.f=this.e=0;this.kb=Ab;this.Z=this.fa=this.Wb=!1;this.ha=null;this.zb=-1;this.je=this.ie=this.tb=0;this.ld=this.ac=!1},ha=new function(){this.Z=this.fa=this.Wb=!1;this.ha=null;this.bc=this.Ue=0};function ga(a){ha.Wb=a.altKey;ha.fa=void 0!==a.metaKey?a.ctrlKey||a.metaKey:a.ctrlKey;ha.Z=a.shiftKey;ha.ha=a.srcElement?a.srcElement:a.target;ha.Ue=a.charCode;ha.bc=a.keyCode;ha.Gf=a.which}function ba(a){if(!a.ac||a.ld){if(a.pageX||a.pageY)y.e=a.pageX,y.f=a.pageY;else if(a.clientX||a.clientY)y.e=a.clientX,y.f=a.clientY;y.Wb=a.altKey;y.Z=a.shiftKey;y.fa=a.ctrlKey||a.metaKey;y.kb=Ab;y.ac||(y.ha=a.srcElement?a.srcElement:a.target);if(3<Math.abs(y.e-y.ie)||3<Math.abs(y.f-y.je))y.zb=-1,y.tb=0}}function fa(a){if(a.pageX||a.pageY)y.e=a.pageX,y.f=a.pageY;else if(a.clientX||a.clientY)y.e=a.clientX,y.f=a.clientY;y.ie=y.e;y.je=y.f;y.Wb=a.altKey;y.Z=a.shiftKey;y.fa=a.ctrlKey||a.metaKey;y.kb=zb;y.Zd=a.button;y.ha=a.srcElement?a.srcElement:a.target;a=(new Date).getTime();0==y.tb?(y.tb=1,y.zb=a):500>a-y.zb?(y.zb=a,y.tb++):(y.tb=1,y.zb=a);window.De=!1}window.onmousemove=function(a){y.ac&&void 0!=y.ha&&null!=y.ha&&void 0!=y.ha.onmousemove&&null!=y.ha.onmousemove&&(y.ld=!0,y.ha.onmousemove(a),y.ld=!1)};window.onmouseup=function(a){if(!1===window.De&&(window.De=!0,y.ac&&void 0!=y.ha.onmouseup&&null!=y.ha.onmouseup))y.ha.onmouseup(a,!0)};function Bb(){this.Va=this.Ua=this.Ia=this.Ha=!0;this.oa=0};var xa=-1,Ua=0,Ta=1,Sa=2,Pa=3,Va=4,Qa=5,Ra=6;function L(a,b,c,d){this.Ke={e:void 0===a?0:a,f:void 0==b?0:b};this.r=void 0===c?Ua:c;this.xc=void 0===d?"":d}L.prototype.ub=function(){return this.Ke.e};L.prototype.vb=function(){return this.Ke.f};L.prototype.jb=function(a){this.r=a};function yb(a){this.m=a;this.g=null;this.p=new Cb;this.qc=this.pc=!0;this.a={d:null,t:{d:null},Selection:{d:null},Ta:{d:null},u:{d:null},rd:{d:null},nd:{d:null},We:{d:null},K:null,N:null,wb:null,Wa:null,ec:0,dc:0};this.Ma=new x(231,188,95,255);this.Nd=new x(0,0,0,255);this.ia=null;this.b={B:0,s:0,t:null,sb:null,Eb:null,Xb:null,jc:null,ed:null,fe:null,Zc:null,ee:null,cd:null,td:null,Be:null,xd:null,jd:null,fd:null,gd:null,hd:null,kd:null,$c:null,ad:null,bd:null,dd:null,zd:null,ud:null,vd:null,wd:null,yd:null,ue:null,xe:null,ve:null,ye:null,we:null,ze:null,Aa:null,Ta:null,Y:null,Ja:0};this.v={e:0,f:0};this.mb=!1;this.ff=!0;var b=this;this.Xd=function(){return setTimeout(function(){b.Vd()},20)};this.Rb=function(a){if(!b.mb){if(b.g){var d=b.g;d.j&&va(d.j)}fa(a);a=b.Tb(y.e,y.f);a=b.p.A(a.e,a.f);a.xb()&&b.g&&D(b.g,a)}};this.Bc=function(a){b.mb||(ba(a),a=b.Tb(y.e,y.f),b.Qa(a.e,a.f))};this.Sb=function(){b.mb||b.Qa(-1,-1)};this.Af=function(a){if(b.mb)return!1;var d=0,d=void 0!=a.wheelDelta?0<a.wheelDelta?-45:45:0<a.detail?45:-45;a.preventDefault&&a.preventDefault();var f=20+24*(b.p.p.length+1)-b.a.t.d.a.height;b.v.f-=d;b.v.f=Math.min(0,Math.max(b.v.f,-f));Db(b);b.Bc(a);Eb(b);return!1};this.Ac=function(){if(b.g){var a=b.g;a.j&&va(a.j)}};this.xf=function(){b.a.K.style.opacity=.7;b.a.wb.style.opacity=.3};this.uf=function(){b.a.K.style.opacity=.5;b.a.wb.style.opacity=0};this.yf=function(){b.a.N.style.opacity=.7;b.a.Wa.style.opacity=.3;b.a.Wa.style.display="block"};this.vf=function(){b.a.N.style.opacity=.5;b.a.Wa.style.opacity=0;b.a.Wa.style.display="none"};this.Ne=function(){b.mb=!0};this.Me=function(){b.mb=!1};this.of=function(a){var d=b.b.B;b.v.e=-((a-2)/(d-4-b.a.ec)*(20+24*(Fb(b.p)+1)-d));Db(b)};this.pf=function(a,d){var f=b.b.s;b.v.f=-((d-2)/(f-4-b.a.dc)*(20+24*(b.p.p.length+1)-f));Db(b)}}r=yb.prototype;r.ga=function(a,b){this.m&&(this.m.vc=this);this.g=b;this.g.J=this;this.p.g=b;this.a.d=G(a);var c=this.a.d.a,d=this.a.d,f=a+"_Board",e=a+"_Selection",g=a+"_Current",h=a+"_Lines",m=a+"_Shadows",l=a+"_Nodes",k=a+"_Events";this.aa(c,f);this.aa(c,e);this.aa(c,g);this.aa(c,h);this.aa(c,m);this.aa(c,l);var q=this.Fa(c,k);this.a.wb=this.Fa(c,a+"HorScroll_BG");this.a.K=this.Fa(c,a+"HorScroll");this.a.Wa=this.Fa(c,a+"VerScroll_BG");this.a.N=this.Fa(c,a+"VerScroll");this.a.wb.style.background="rgb(0,0,0)";this.a.wb.style.display="none";this.a.Wa.style.background="rgb(0,0,0)";this.a.Wa.style.display="none";this.a.K.onmouseover=this.xf;this.a.K.onmouseout=this.uf;this.a.N.onmouseover=this.yf;this.a.N.onmouseout=this.vf;c=G(a+"HorScroll_BG");N(c.h,2,0,2,2,!0,!1,!0,!0,-1,12);c.I=P|Q|R;d.H(c);c=G(a+"VerScroll_BG");N(c.h,0,2,2,2,!1,!0,!0,!0,12,-1);c.I=O|Q|R;d.H(c);this.P(this.a.t,d,f);this.P(this.a.Selection,d,e);this.P(this.a.Ta,d,g);this.P(this.a.u,d,h);this.P(this.a.rd,d,m);this.P(this.a.nd,d,l);this.P(this.a.We,d,k);q.onmousedown=this.Rb;q.onmousemove=this.Bc;q.onmouseout=this.Sb;q.onmousewheel=this.Af;q.onfocus=this.Ac;q.tabIndex=-1;q.style.ef=!0;q.style.outline=0;d=this.a.nd.d.a.getContext("2d");this.b.sb=d.createImageData(20,20);this.b.Eb=d.createImageData(20,20);this.b.Xb=d.createImageData(20,20);this.b.jc=d.createImageData(20,20);d=this.b.sb.data;f=this.b.Eb.data;e=this.b.Xb.data;g=this.b.jc.data;h=Math.sqrt(3);for(m=0;20>m;m++)for(l=0;20>l;l++){var c=m-9.5,v=l-9.5,p=9.3-Math.sqrt(c*c+v*v),k=4*(20*m+20-l-1);if(0<=p){var u=9.3*9.3-c*c-v*v,u=0<u?Math.sqrt(u)*h:0,t=c,C=v,q=Math.sqrt(6*(t*t+C*C+u*u)),q=(2*u-t+C)/q,u=0;.9<q&&(u=10*(q-.9));t=255;.8>=p&&(p=(.8-p)/.8,t=.7,3.1>c-v&&(t=1),t=parseInt(255*(1-p*t)));c=parseInt(10+10*q+140*u);d[k+0]=c;d[k+1]=c;d[k+2]=c;d[k+3]=t;e[k+0]=c;e[k+1]=c;e[k+2]=c;e[k+3]=parseInt(.5*t);c=parseInt(200+10*q+45*u);f[k+0]=c;f[k+1]=c;f[k+2]=c;f[k+3]=t;g[k+0]=c;g[k+1]=c;g[k+2]=c;g[k+3]=parseInt(.7*t)}else d[k+0]=0,d[k+1]=0,d[k+2]=0,d[k+3]=0,g[k+0]=0,g[k+1]=0,g[k+2]=0,g[k+3]=0}this.Td();d=this.a.Selection.d.a.getContext("2d");this.b.Aa=d.createImageData(24,24);this.b.Ta=d.createImageData(24,24);f=this.b.Aa.data;e=this.b.Ta.data;for(g=0;24>g;g++)for(h=0;24>h;h++)m=4*(h+24*g),f[m+3]=255,e[m+3]=255,0===h&&23===g||23===h&&0===g?(f[m+0]=135,f[m+1]=125,f[m+2]=135,e[m+0]=216):23===h||23===g?(f[m+0]=89,f[m+1]=89,f[m+2]=89,e[m+0]=178):(0===g||0===h?(f[m+0]=182,f[m+1]=182,f[m+2]=182):(f[m+0]=128,f[m+1]=128,f[m+2]=128),e[m+0]=255),e[m+1]=0,e[m+2]=0;d.putImageData(this.b.Aa,0,0);d.putImageData(this.b.Ta,0,30);this.Ud()};r.M=function(a){var b=this.a.d.a.clientWidth,c=this.a.d.a.clientHeight;this.a.d.za(b,c);this.Pa(b,c,a)};function ib(a){if(!(0>=a.b.B||0>=a.b.s)){var b=a.b.B,c=a.b.s,d=20+24*(Fb(a.p)+1),f=20+24*(a.p.p.length+1);d>b?(a.a.ec=Math.max(50,b*b/d),a.a.K.style.width=Math.max(50,b*b/d)+"px",a.a.K.style.display="block",a.a.K.style.position="absolute",a.a.K.style.top=c-14+"px",a.a.K.style.height="12px",a.a.K.style.background="rgb(0,0,0)",a.a.K.style.opacity=.5,Gb(a.a.K,2,b-a.a.ec-2,c-14,c-14),a.a.K.Qd=a.of,a.a.K.Sd=a.Ne,a.a.K.Rd=a.Me):a.a.K.style.display="none";f>c?(a.a.dc=Math.max(50,c*c/f),a.a.N.style.height=Math.max(50,c*c/f)+"px",a.a.N.style.display="block",a.a.N.style.position="absolute",a.a.N.style.left=b-14+"px",a.a.N.style.width="12px",a.a.N.style.background="rgb(0,0,0)",a.a.N.style.opacity=.5,Gb(a.a.N,b-14,b-14,2,c-a.a.dc-2),a.a.N.Qd=a.pf,a.a.N.Sd=a.Ne,a.a.N.Rd=a.Me):a.a.N.style.display="none";Db(a);Eb(a)}}r.Sa=function(){this.p.Sa()};function Hb(a,b){a.pc=!0;var c=a.b.B,d=a.b.s;if(!(0>=c||0>=d)){var f=a.g.i.da,e=f.e,f=f.f,g=10+a.v.e+24*e,h=10+a.v.f+24*f;if(0!=b&&!0===a.ff&&(10>=g||g>=c-10||10>=h||h>=d-10)){var m=20+24*(a.p.p.length+1)-d,l=20+24*(Fb(a.p)+1)-c;10>=g?a.v.e=24*-e:g>=c-10&&(a.v.e=c-24-10-10-24*e);10>=h?a.v.f=24*-f:h>=d-10&&(a.v.f=d-24-10-10-24*f);a.v.e=Math.min(0,Math.max(a.v.e,-l));a.v.f=Math.min(0,Math.max(a.v.f,-m));Eb(a);Db(a)}}}function vb(a){if(a.pc&&a.g){var b=a.b.B,c=a.b.s;if(!(0>=b||0>=c)){var d=a.g.i.da,f=10+a.v.e+24*d.e,d=10+a.v.f+24*d.f,e=a.a.Ta.d.a.getContext("2d");e.clearRect(0,0,b,c);-24<=f&&f<=b+24&&-24<=d&&d<=c+24&&e.putImageData(a.b.Ta,f,d);a.pc=!1}}if(a.qc&&(b=a.b.B,c=a.b.s,0!==b&&0!==c)){var f=a.a.u.d.a.getContext("2d"),d=a.a.rd.d.a.getContext("2d"),e=a.a.nd.d.a.getContext("2d"),g=a.a.Selection.d.a.getContext("2d");e.clearRect(0,0,b,c);d.clearRect(0,0,b,c);f.clearRect(0,0,b,c);g.clearRect(0,0,b,c);for(var g=10+a.v.e,h=10+a.v.f,m=a.p.p.length,l=0;l<=m-1;l++){var k=h+24*l;if(-24<=k&&k<=c+24)for(var q=a.p.p[l].length-1,v=0;v<=q;v++){var p=g+24*v;if(-24<=p&&p<=b+24){var u=a.p.A(v,l);if(!1===u.xb()){var t=u.ib();switch(u.r){case Ib:t.Ka?f.putImageData(a.b.td,p,k):f.putImageData(a.b.zd,p,k);break;case Jb:t.Ka?1===t.pe?f.putImageData(a.b.ud,p,k):f.putImageData(a.b.vd,p,k):f.putImageData(a.b.wd,p,k);break;case Kb:t.Ka?f.putImageData(a.b.xd,p,k):f.putImageData(a.b.yd,p,k)}}else{var t=u.ib(),C=u.Ea.r,H=""+u.da.od,w=e.measureText(H).width,F=u.Qb;I===C?(t&&d.putImageData(a.b.Y,p+2+a.b.Ja,k+2+a.b.Ja),e.putImageData(t?a.b.sb:a.b.Xb,p+2,k+2),""===F?(e.font="bold 10px sans-serif",e.fillStyle=t?"#CCC":"rgb(192, 192, 192)",e.fillText(H,p+12-w/2,k+12+3)):e.putImageData(t?a.b.ve:a.b.we,p+2,k+2)):K===C?(t&&d.putImageData(a.b.Y,p+2+a.b.Ja,k+2+a.b.Ja),e.putImageData(t?a.b.Eb:a.b.jc,p+2,k+2),""===F?(e.font="bold 10px sans-serif",e.fillStyle=t?"#000":"rgb(56, 56, 56)",e.fillText(H,p+12-w/2,k+12+3)):e.putImageData(t?a.b.ye:a.b.ze,p+2,k+2)):e.putImageData(t?a.b.ue:a.b.xe,p+2,k+2);H=z(u);u=u.U;0===v?0!==H&&(1===H?t?f.putImageData(a.b.ed,p,k):f.putImageData(a.b.jd,p,k):t?0==u?f.putImageData(a.b.fd,p,k):f.putImageData(a.b.gd,p,k):f.putImageData(a.b.hd,p,k)):0===H?t?f.putImageData(a.b.cd,p,k):f.putImageData(a.b.dd,p,k):1===H?t?f.putImageData(a.b.Zc,p,k):f.putImageData(a.b.kd,p,k):t?0===u?f.putImageData(a.b.$c,p,k):f.putImageData(a.b.ad,p,k):f.putImageData(a.b.bd,p,k);I!==C&&K!==C||f.clearRect(p+3,k+3,18,18)}}}}a.qc=!1}}r.md=function(){return this.pc||this.qc?!0:!1};r.aa=function(a,b){var c=document.createElement("canvas");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};r.Fa=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};r.P=function(a,b,c){a.d=G(c);a=a.d;N(a.h,0,0,1E3,1E3,!1,!1,!1,!1,-1,-1);a.I=O|P|Q|R;b.H(a)};r.Pa=function(a,b){var c=this.a.t.d.a.getContext("2d");a!==this.b.B||b!==this.b.s||null===this.b.t||null!==this.ia?(this.b.B=a,this.b.s=b,c.fillStyle=S(this.Ma),c.fillRect(0,0,a,b),null!==this.ia&&clearTimeout(this.ia),this.ia=this.Xd()):c.putImageData(this.b.t,0,0);ib(this)};r.Vd=function(){this.ia=null;var a=this.b.B,b=this.b.s,c=this.a.t.d.a.getContext("2d");if(0!==a&&0!==b){for(var d=c.createImageData(a,b),f=this.Ma.q,e=this.Ma.o,g=this.Ma.n,h=Array(a),m=0;m<a;m++)h[m]=(Math.tan(300*m/a)+1)/2+(Math.tan(100*m/a)+1)/10;for(var l=Array(b),k=0;k<b;k++)l[k]=.02*Math.tan(k/b);var q,v,p;p=.9;for(k=0;k<b;k++)for(m=0;m<a;m++){p=40*(h[m]+l[k])+.5;p-=Math.floor(p);p=.2>p?1-p/2:.4>p?1-(.4-p)/2:1;if(k==b-1||k==b-2&&m<a-2||m>=a-1||m==a-2&&k<b-1)p/=2;0==k||1==k&&1<m||0==m||1==m&&1<k?(q=128+f*p/2,v=128+e*p/2,p=128+g*p/2):(q=f*p,v=e*p,p*=g);var u=4*(m+k*a);d.data[u+0]=q;d.data[u+1]=v;d.data[u+2]=p;d.data[u+3]=255}this.b.t=d;c.putImageData(this.b.t,0,0)}};r.Td=function(){var a=this.a.u.d.a.getContext("2d");this.b.ed=a.createImageData(24,24);this.b.fe=a.createImageData(24,24);this.b.Zc=a.createImageData(24,24);this.b.ee=a.createImageData(24,24);this.b.cd=a.createImageData(24,24);this.b.td=a.createImageData(24,24);this.b.Be=a.createImageData(24,24);this.b.xd=a.createImageData(24,24);this.b.jd=a.createImageData(24,24);this.b.fd=a.createImageData(24,24);this.b.gd=a.createImageData(24,24);this.b.hd=a.createImageData(24,24);this.b.kd=a.createImageData(24,24);this.b.$c=a.createImageData(24,24);this.b.ad=a.createImageData(24,24);this.b.bd=a.createImageData(24,24);this.b.dd=a.createImageData(24,24);this.b.zd=a.createImageData(24,24);this.b.ud=a.createImageData(24,24);this.b.vd=a.createImageData(24,24);this.b.wd=a.createImageData(24,24);this.b.yd=a.createImageData(24,24);for(var a=this.b.ed.data,b=this.b.fe.data,c=this.b.Zc.data,d=this.b.ee.data,f=this.b.cd.data,e=this.b.td.data,g=this.b.Be.data,h=this.b.xd.data,m=this.b.jd.data,l=this.b.fd.data,k=this.b.gd.data,q=this.b.hd.data,v=this.b.kd.data,p=this.b.$c.data,u=this.b.ad.data,t=this.b.bd.data,C=this.b.dd.data,H=this.b.zd.data,w=this.b.ud.data,F=this.b.vd.data,J=this.b.wd.data,Z=this.b.yd.data,s=new x(28,28,28,255),A=0;24>A;A++)for(var B=0;24>B;B++){var n=4*(24*A+B);12<=B&&(11===A||12===A)?(a[n+0]=s.q,a[n+1]=s.n,a[n+2]=s.o,a[n+3]=255,m[n+0]=s.q,m[n+1]=s.n,m[n+2]=s.o,m[n+3]=96):(a[n+3]=0,m[n+3]=0);11<=B&&(11===A||12===A)||12<=A&&(11===B||12===B)?(b[n+0]=s.q,b[n+1]=s.n,b[n+2]=s.o,b[n+3]=255,q[n+0]=s.q,q[n+1]=s.n,q[n+2]=s.o,q[n+3]=96):(b[n+3]=0,q[n+3]=0);11<=B&&(11===A||12===A)?(l[n+0]=s.q,l[n+1]=s.n,l[n+2]=s.o,l[n+3]=255):12<=A&&(11===B||12===B)?(l[n+0]=s.q,l[n+1]=s.n,l[n+2]=s.o,l[n+3]=96):l[n+3]=0;12<=A&&(11===B||12===B)?(k[n+0]=s.q,k[n+1]=s.n,k[n+2]=s.o,k[n+3]=255):11<=B&&(11===A||12===A)?(k[n+0]=s.q,k[n+1]=s.n,k[n+2]=s.o,k[n+3]=96):k[n+3]=0;11===A||12===A?(c[n+0]=s.q,c[n+1]=s.n,c[n+2]=s.o,c[n+3]=255,v[n+0]=s.q,v[n+1]=s.n,v[n+2]=s.o,v[n+3]=96):(c[n+3]=0,v[n+3]=0);11===A||12===A||12<=A&&(11===B||12===B)?(d[n+0]=s.q,d[n+1]=s.n,d[n+2]=s.o,d[n+3]=255,t[n+0]=s.q,t[n+1]=s.n,t[n+2]=s.o,t[n+3]=96):(d[n+3]=0,t[n+3]=0);11===A||12===A?(p[n+0]=s.q,p[n+1]=s.n,p[n+2]=s.o,p[n+3]=255):12<=A&&(11===B||12===B)?(p[n+0]=s.q,p[n+1]=s.n,p[n+2]=s.o,p[n+3]=96):p[n+3]=0;(11===A||12===A)&&12>=B||12<=A&&(11===B||12===B)?(u[n+0]=s.q,u[n+1]=s.n,u[n+2]=s.o,u[n+3]=255):(11===A||12===A)&&12<B?(u[n+0]=s.q,u[n+1]=s.n,u[n+2]=s.o,u[n+3]=96):(d[n+3]=0,t[n+3]=0);11>=B&&(11===A||12===A)?(f[n+0]=s.q,f[n+1]=s.n,f[n+2]=s.o,f[n+3]=255,C[n+0]=s.q,C[n+1]=s.n,C[n+2]=s.o,C[n+3]=96):(f[n+3]=0,C[n+3]=0);11===B||12===B?(e[n+0]=s.q,e[n+1]=s.n,e[n+2]=s.o,e[n+3]=255,H[n+0]=s.q,H[n+1]=s.n,H[n+2]=s.o,H[n+3]=96):(e[n+3]=0,H[n+3]=0);11===B||12===B||12<=B&&(11===A||12===A)?(g[n+0]=s.q,g[n+1]=s.n,g[n+2]=s.o,g[n+3]=255,J[n+0]=s.q,J[n+1]=s.n,J[n+2]=s.o,J[n+3]=96):(g[n+3]=0,J[n+3]=0);(11===B||12===B)&&12>=A||12<=B&&(11===A||12===A)?(w[n+0]=s.q,w[n+1]=s.n,w[n+2]=s.o,w[n+3]=255):(11===B||12===B)&&12<A?(w[n+0]=s.q,w[n+1]=s.n,w[n+2]=s.o,w[n+3]=96):w[n+3]=0;11===B||12===B?(F[n+0]=s.q,F[n+1]=s.n,F[n+2]=s.o,F[n+3]=255):12<B&&(11===A||12===A)?(F[n+0]=s.q,F[n+1]=s.n,F[n+2]=s.o,F[n+3]=96):F[n+3]=0;11>=A&&(11===B||12===B)||11<=B&&(11===A||12===A)?(h[n+0]=s.q,h[n+1]=s.n,h[n+2]=s.o,h[n+3]=255,Z[n+0]=s.q,Z[n+1]=s.n,Z[n+2]=s.o,Z[n+3]=96):(h[n+3]=0,Z[n+3]=0)}this.b.ue=this.V(20,20,20*.07,s,1,null);this.b.xe=this.V(20,20,20*.07,new x(28,28,28,96),1,null);this.b.ve=this.V(20,20,1.2,new x(255,255,255,255),1,this.b.sb);this.b.ye=this.V(20,20,1.2,new x(0,0,0,255),1,this.b.Eb);this.b.we=this.V(20,20,1.2,new x(255,255,255,96),1,this.b.Xb);this.b.ze=this.V(20,20,1.2,new x(0,0,0,96),1,this.b.jc)};r.V=function(a,b,c,d,f,e){void 0===f&&(f=1);var g=this.a.u.d.a.getContext("2d");g.clearRect(0,0,a,b);null!==e&&g.putImageData(e,0,0);g.globalAlpha=f;g.strokeStyle=S(d);g.fillStyle=S(d);g.lineWidth=c;f=a/2;d=3*b/4;var h=.1*a;c=Math.sqrt(f*f-(d-f)*(d-f))+f-h;f=-Math.sqrt(f*f-(d-f)*(d-f))+f+h;null!==e&&(c=Math.floor(c-.5),f=Math.ceil(f+.5),h=Math.ceil(h+.5),d=Math.floor(d-.5));g.beginPath();g.moveTo(a/2,h);g.lineTo(c,d);g.lineTo(f,d);g.closePath();g.stroke();a=g.getImageData(0,0,a,b);g.putImageData(a,0,0);return a};r.Ud=function(){var a=this.a.rd.d.a.getContext("2d");this.b.Y=a.createImageData(20,20);a=this.b.Y.data;this.b.Ja=Math.max(3,3);for(var b=0;20>b;b++)for(var c=0;20>c;c++){var d=Math.abs(b-8.5),f=Math.abs(c-8.5),d=Math.sqrt(f*f+d*d)/8.5,d=1>d?.15+.75*(1-d):0,f=4*(20*b+c);a[f+0]=0;a[f+1]=0;a[f+2]=0;a[f+3]=parseInt(255*d)}};function Db(a){a.qc=!0;Hb(a,!1)}r.Tb=function(a,b){var c=Da(this.a.t.d.a);return{e:(a-c.e-10-this.v.e)/24|0,f:(b-c.f-10-this.v.f)/24|0}};r.Qa=function(a,b){var c=this.b.B,d=this.b.s;if(!(0>=c||0>=d)){var f=this.a.Selection.d.a.getContext("2d");f.clearRect(0,0,c,d);0<=a&&0<=b&&(c=10+this.v.e+24*a,d=10+this.v.f+24*b,this.p.A(a,b).xb()&&f.putImageData(this.b.Aa,c,d))}};function Eb(a){var b=a.b.B,c=a.b.s,c=-a.v.f/(20+24*(a.p.p.length+1)-c)*(c-4-a.a.dc)+2;a.a.K.style.left=-a.v.e/(20+24*(Fb(a.p)+1)-b)*(b-4-a.a.ec)+2+"px";a.a.N.style.top=c+"px"};var Ib=-9,Jb=-8,Kb=-7;function Lb(a,b,c){this.r=a;this.C=b;this.wc=c}Lb.prototype.xb=function(){return!1};Lb.prototype.D=function(){return this.wc};Lb.prototype.ib=function(){if(-10!==this.r)if(Ib===this.r){if(this.C.ib()&&0<z(this.C)&&this.C.D().da.f>=this.wc.da.f)return{Ka:!0}}else if(Jb===this.r){if(!this.C.ib())return{Ka:!1};var a=this.wc.da.f,b=this.C.D().da.f;if(a<b)return{Ka:!0,pe:0};if(a===b)return{Ka:!0,pe:1}}else if(Kb===this.r)return{Ka:this.wc.ib()};return{Ka:!1}};function Cb(){this.p=[];this.g=null;this.W=0}Cb.prototype.ba=function(){this.p=[];this.W=0};Cb.prototype.Sa=function(){this.g&&(this.ba(),Mb(this,this.g.ma,0,0))};function Mb(a,b,c,d){var f,e=1;for(f=b;0<z(f);)e++,f=f.D(0);for(f=e;!Nb(a,c,d,f);)d++;var e=c,g=d,h=b;for(a.L(e,g,b);0<z(h);)e++,h=h.D(0),a.L(e,g,h);for(e=b;0<z(e);)e=e.D(0);c+=f-1;for(f={Ae:d};;){for(var g=d,h=a.W,m=z(e),l=1;l<m;l++){a.W=h;var k=d,q=Mb(a,e.D(l),c+1,d+1);d=q.f;for(k+=1;k<=d;k++)if(k===q.Ae)if(m-1===l){a.L(c,k,new Lb(Kb,e,e.D(l)));break}else a.L(c,k,new Lb(Jb,e,e.D(l)));else k<q.Ae?a.L(c,k,new Lb(Ib,e,e.D(l))):a.L(c,k,new Lb(Ib,e,e.D(l+1)))}a.W=h;if(e===b)break;e.hb()&&a.W--;e=e.C;c--;d=g}f.f=d;return f}Cb.prototype.A=function(a,b){return void 0===this.p[b]||void 0===this.p[b][a]?new Lb(-10,null,null):this.p[b][a]};Cb.prototype.L=function(a,b,c){void 0===this.p[b]&&(this.p[b]=[]);if(c.xb())if(c.hb()){this.W++;var d=this.W;c.da.e=a;c.da.f=b;c.da.od=d}else c.da.e=a,c.da.f=b,c.da.od=-1;this.p[b][a]=c};function Nb(a,b,c,d){for(var f=0;f<d;f++){var e=b+f;if(!1===(void 0===a.p[c]||void 0===a.p[c][e]||-10===a.p[c][e].r?!0:!1))return!1}return!0}function Fb(a){for(var b=0,c=a.p.length,d=0;d<c;d++){var f=a.p[d].length-1;f>b&&(b=f)}return b};function xb(a){this.m=a;this.g=null;this.a={d:null};this.jf=new x(217,217,217,255);this.Dd=[]}xb.prototype.ga=function(a,b,c){this.g=b;this.a.d=G(a);var d=this.a.d.a,f=this.a.d;d.style.backgroundColor=S(this.jf);for(var e=0,g=c.R.length;e<g;e++){var h=c.R[e],m=null;switch(h){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:m=new jb(this.m)}if(null!==m){var l=a+e;this.Fa(d,l);this.P(f,l,e/g,(e+1)/g);m.ga(l,b,h);this.Dd.push(m)}}this.M()};xb.prototype.M=function(){this.a.d.za(this.a.d.a.clientWidth,this.a.d.a.clientHeight);for(var a=0,b=this.Dd.length;a<b;a++)this.Dd[a].M()};xb.prototype.Fa=function(a,b){var c=document.createElement("div");c.setAttribute("id",b);c.setAttribute("style","position:absolute;padding:0;margin:0;");c.setAttribute("oncontextmenu","return false;");a.appendChild(c);return c};xb.prototype.P=function(a,b,c,d){b=G(b);N(b.h,1E3*c,0,1E3*d,1E3,!1,!1,!1,!1,-1,-1);b.I=O|P|Q|R;a.H(b)};function U(){}r=U.prototype;r.Ve=function(){return new Ob};r.Uc=function(a,b){(new ub(a)).Uc(b)};r.Tc=function(a,b){(new ub(a)).Tc(b)};r.Sc=function(a,b){(new ub(a)).Sc(b)};r.Ab=function(a,b){a.Ab(b)};r.M=function(a){a.M()};window.GoBoardApi=new U;U.prototype.Create_GameTree=U.prototype.Ve;U.prototype.Create_SimpleBoard=U.prototype.Uc;U.prototype.Create_BoardWithNavigateButtons=U.prototype.Tc;U.prototype.Create_BoardCommentsButtonsNavigator=U.prototype.Sc;U.prototype.Load_Sgf=U.prototype.Ab;U.prototype.Update_Size=U.prototype.M;var Pb={};function Qb(a,b,c){this.r=void 0===a?0:a;this.Le=void 0===b?null:b;this.He=void 0===c?0:c}Qb.prototype.ca=function(){return this.Le};Qb.prototype.jb=function(a){this.r=a};Qb.prototype.fc=function(a){this.Le=a};function Rb(){Y=X=0}function x(a,b,c,d){this.q=a;this.o=b;this.n=c;this.Bd="undefined"===typeof d?255:d}x.prototype={};function S(a){return"rgba("+a.q+","+a.o+","+a.n+","+a.Bd/255+")"}function T(a){var b=new Rb;b.e=a&255;b.f=a>>8&255;return b}function Sb(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b}function Da(a){if("undefined"!=typeof a.offsetParent){for(var b=0,c=0;a;a=a.offsetParent)b+=a.offsetLeft,c+=a.offsetTop;return{e:b,f:c}}return{e:a.x,f:a.y}}function Ia(a){if("string"!=typeof a)return!1;for(var b=0;b<a.length;b++){var c=a.charCodeAt(b);if(48>c||57<c)return!1}return!0}function db(a,b){return a>b?1:b>a?-1:0}var V=null;function Gb(a,b,c,d,f){a.onmousedown=Tb;a.ta=!0;a.xa=!0;a.root=a;a.ta&&isNaN(parseInt(a.root.style.left))&&(a.root.style.left="0px");a.xa&&isNaN(parseInt(a.root.style.top))&&(a.root.style.top="350px");!a.ta&&isNaN(parseInt(a.root.style.right))&&(a.root.style.right="0px");!a.xa&&isNaN(parseInt(a.root.style.bottom))&&(a.root.style.bottom="0px");a.Na="undefined"!=typeof b?b:null;a.Oa="undefined"!=typeof d?d:null;a.eb="undefined"!=typeof c?c:null;a.fb="undefined"!=typeof f?f:null;a.Qe=null;a.Re=null;a.root.Sd=new Function;a.root.Rd=new Function;a.root.Qd=new Function}function Tb(a){var b=V=this;a=Ub(a);var c=parseInt(b.xa?b.root.style.top:b.root.style.bottom),d=parseInt(b.ta?b.root.style.left:b.root.style.right);b.root.Sd(d,c);b.Ee=a.clientX;b.Fe=a.clientY;b.ta?(null!=b.Na&&(b.yc=a.clientX-d+b.Na),null!=b.eb&&(b.Od=b.yc+b.eb-b.Na)):(null!=b.Na&&(b.Od=-b.Na+a.clientX+d),null!=b.eb&&(b.yc=-b.eb+a.clientX+d));b.xa?(null!=b.Oa&&(b.zc=a.clientY-c+b.Oa),null!=b.fb&&(b.Pd=b.zc+b.fb-b.Oa)):(null!=b.Oa&&(b.Pd=-b.Oa+a.clientY+c),null!=b.fb&&(b.zc=-b.fb+a.clientY+c));document.onmousemove=Vb;document.onmouseup=Wb;return!1}function Vb(a){a=Ub(a);var b=V,c=a.clientY;a=a.clientX;var d=parseInt(b.xa?b.root.style.top:b.root.style.bottom),f=parseInt(b.ta?b.root.style.left:b.root.style.right),e,g;null!=b.Na&&(a=b.ta?Math.max(a,b.yc):Math.min(a,b.Od));null!=b.eb&&(a=b.ta?Math.min(a,b.Od):Math.max(a,b.yc));null!=b.Oa&&(c=b.xa?Math.max(c,b.zc):Math.min(c,b.Pd));null!=b.fb&&(c=b.xa?Math.min(c,b.Pd):Math.max(c,b.zc));e=f+(a-b.Ee)*(b.ta?1:-1);g=d+(c-b.Fe)*(b.xa?1:-1);b.Qe?e=b.Qe(d):b.Re&&(g=b.Re(f));null!=b.Na&&(e=Math.max(e,b.Na));null!=b.eb&&(e=Math.min(e,b.eb));null!=b.Oa&&(g=Math.max(g,b.Oa));null!=b.fb&&(g=Math.min(g,b.fb));V.root.style[b.ta?"left":"right"]=e+"px";V.root.style[b.xa?"top":"bottom"]=g+"px";V.Ee=a;V.Fe=c;V.root.Qd(e,g);return!1}function Wb(){document.onmousemove=null;document.onmouseup=null;V.root.Rd(parseInt(V.root.style[V.ta?"left":"right"]),parseInt(V.root.style[V.xa?"top":"bottom"]));V=null}function Ub(a){"undefined"==typeof a&&(a=window.event);"undefined"==typeof a.layerX&&(a.layerX=a.offsetX);"undefined"==typeof a.layerY&&(a.layerY=a.offsetY);return a};var M=0,I=1,K=2,Xb=2,oa=0,na=2,Ga=460,Ea=Ga,Ha=17.51/23.61,Fa=Ha;function Ob(a,b,c,d){this.$=c;this.m=a;this.X=d;this.lf=new Bb;this.G=new Yb;this.J=this.j=null;this.Ge=[];this.ma=new Zb(this);this.hf=0;this.i=this.ma;this.Pb=this.Lb=0;this.bb=I;this.Mb=this.Jd=0;this.rc=Xb}r=Ob.prototype;r.M=function(){this.m&&this.m.M()};r.Ab=function(a){var b=new $b(this);if(void 0!==a&&""!==a){b.l=[];b.c=0;b.nb=0;b.Ed=[];b.Da=!0;for(var c=b.Nb=0,d=a.length,f=[],e=!1;c<d;){(e||32<a.charCodeAt(c))&&f.push(a.charAt(c));if(3<=f.length&&"["==f[f.length-1]){var g=f[f.length-3]+f[f.length-2];if("C"==f[f.length-2]&&"UC"!=g||"AN"==g||"BR"==g||"BT"==g||"CP"==g||"DT"==g||"EV"==g||"GN"==g||"GC"==g||"ON"==g||"OT"==g||"PB"==g||"PC"==g||"PW"==g||"RE"==g||"RO"==g||"RU"==g||"SO"==g||"TM"==g||"US"==g||"WR"==g||"WT"==g)e=!0}else e&&1<=f.length&&"]"==f[f.length-1]&&(2>f.length||"\\"!=f[f.length-2])&&(e=!1);c++}b.l=f;b.Nb=b.l.length;ac(b)||alert("Error occurs, while read SGF")}this.J&&this.J.Sa();D(this,this.ma)};r.Bb=function(){this.Ge=[];this.ma=new Zb(this);bc(this)};function ia(a,b){for(var c=a.i;null!=c.C&&0<b;)c=c.C,b--;D(a,c)}function la(a,b){if(1===b)ka(a)&&bb(a);else{for(var c=0;c<b;c++)ka(a);D(a,a.i)}}function ja(a){var b=a.i.C;if(null!==b){var c=b.U;0<z(b)&&0<c&&D(a,b.D(c-1))}}function ma(a){var b=a.i.C;if(null!==b){var c=b.U;c<z(b)-1&&D(a,b.D(c+1))}}r.Yc=function(){for(var a=this.i;!cc(a);){var b=a.C;if(null===b&&a!==this.ma)return;a=b}a.Yc();D(this,a)};r.qd=function(a){this.bb=a;this.i.qd(a)};r.gb=function(a,b,c){this.i.gb(a,b,c)};function ab(a,b,c){var d=new Zb(a),f=d.C=a.i;f.ua.push(d);if(!0===c||-1===f.U)f.U=f.ua.length-1;a.i=d;a.Mb++;!0===b&&a.J&&(a.J.Sa(),ib(a.J))}r.Ub=function(a,b){this.i.Ub(a,b)};r.Vb=function(a){this.i.Vb(a)};r.pd=function(a){this.i.pd(a)};r.ea=function(a,b){this.i.ea(a,b)};r.ya=function(a){this.i.ea(513,a)};r.rb=function(a,b){this.i.rb(a,b)};r.Dc=function(a,b){this.i.wa.Ya||(this.i.wa.Ya=!0);for(var c=0,d=b.length;c<d;c++)this.i.Dc(b[c],a)};r.Cc=function(a){this.i.Cc(a)};r.Ec=function(a){this.i.Ec(a)};r.Rc=function(){!0===this.i.wa.Ya&&(this.i.wa.Ya=!1,this.i.Rc());this.j&&(this.j.X={},Ka(this.j))};r.hb=function(){return this.i.hb()};function bb(a){a.j&&(1===a.j.La&&E(a.j,0),a.j.X={},a.gc());for(var b=0,c=a.i.ka.length;b<c;b++){var d=a.i.ka[b],f=d.ca(),e=d.He;switch(d.r){case 1:d=T(f);dc(a,d.e,d.f,I,!1);break;case 2:d=T(f);dc(a,d.e,d.f,K,!1);break;case 257:for(var g=0;g<e;g++)d=T(f[g]),ec(a,d.e,d.f,I,-1);break;case 258:for(g=0;g<e;g++)d=T(f[g]),ec(a,d.e,d.f,K,-1);break;case 259:for(g=0;g<e;g++)d=T(f[g]),ec(a,d.e,d.f,M,-1);break;case 260:a.bb=f;break;case 529:if(a.j)for(g=0;g<e;g++)d=T(f[g]),a.j.ea(new L(d.e,d.f,Sa,""));break;case 530:if(a.j)for(g=0;g<e;g++)d=T(f[g]),a.j.ea(new L(d.e,d.f,Va,""));break;case 531:if(a.j)for(g=0;g<e;g++)d=T(f[g]),a.j.ea(new L(d.e,d.f,Ta,""));break;case 532:if(a.j)for(g=0;g<e;g++)d=T(f[g]),a.j.ea(new L(d.e,d.f,Ua,""));break;case 533:a.j&&(d=T(f.$e),a.j.ea(new L(d.e,d.f,Pa,f.Text)));break;case 513:if(a.j)for(g=0;g<e;g++)d=T(f[g]),a.j.ya(d.e,d.f)}}a.j&&(a.i.wa.Ya&&E(a.j,1),a.i.hb()?(c=a.i.Ea,b=c.ub(),c=c.vb(),Na(a.j,b,c)):Na(a.j,-1,-1),Ka(a.j));a.m&&a.m.sd(a.i.Qb);a.J&&Hb(a.J,!0);a.Db()}function dc(a,b,c,d,f){if(0!=b||0!=c){a.$&&!0!==f&&a.$.Ef();ec(a,b,c,d,a.Jd+1,f);var e=null;if(null!==(e=fb(a.G,b,c,d,!1))&&0<e.S()){b=e.S();for(c=0;c<b;c++){var g=T(e.ca(c));ec(a,g.e,g.f,M,-1)}a.$&&!0!==f&&a.$.Ze(e);I===d?a.Lb+=b:a.Pb+=b}else if(null!==(e=gb(a.G,b,c,d))&&0<e.S()){b=e.S();for(c=0;c<b;c++)g=T(e.ca(c)),ec(a,g.e,g.f,M,-1);a.$&&!0!==f&&a.$.Ze(g_nGroupSize);I===d?a.Pb+=b:a.Lb+=b}else a.G.cb.Bb()}a.bb=I===d?K:I;a.Jd++}function ka(a){if(0===z(a.i)||-1===a.i.U)return!1;a.i=a.i.D(a.i.U);a.Mb++;return!0}r.gc=function(){this.j&&this.i.gc(this.rc,this.j)};r.$b=function(){if(this.j){this.G.$b(this.j);Ka(this.j);this.i.wa.Ya||(this.i.wa.Ya=!0);var a=this.G,b=this.i.wa;b.la={};for(var c=a.S(),d=1;d<=c.f;d++)for(var f=1;f<=c.e;f++){var e=a.Ba[Ba(a,f,d)],g=(d<<8)+f;if(I===e||K===e)b.la[""+g]=e}}};function D(a,b){bc(a);a.G.ba();a.$&&a.$.Cf();var c;a:{c=b.C;for(var d=b;null!=c;){for(var f=!1,e=0,g=z(c);e<g;e++)if(d===c.D(e)){hb(c,e);f=!0;break}if(!f){c=!1;break a}d=c;c=c.C}c=!0}if(c){for(a.i=a.ma;a.i!=b&&0<z(a.i);){c=a.i.ka.length;for(d=0;d<c;d++)switch(g=a.i.ka[d],f=g.ca(),e=g.He,g.r){case 1:g=T(f);dc(a,g.e,g.f,I,!0);break;case 2:g=T(f);dc(a,g.e,g.f,K,!0);break;case 257:for(var h=0;h<e;h++)g=T(f[h]),a.G.L(g.e,g.f,I,-1);break;case 258:for(h=0;h<e;h++)g=T(f[h]),a.G.L(g.e,g.f,K,-1);break;case 259:for(h=0;h<e;h++)g=T(f[h]),a.G.L(g.e,g.f,M,-1)}if(!ka(a))break}a.j&&(a.j.Fd=!0);bb(a);a.J&&ib(a.J);a.$&&a.$.Df()}}function pa(a,b){b!==a.rc&&(a.rc=b,a.gc())}function bc(a){a.i=a.ma;a.Lb=0;a.Pb=0;a.Jd=0;a.Mb=0;a.bb=I}function ec(a,b,c,d,f,e){a.G.L(b,c,d,f);a.j&&!0!==e&&wa(a.j,b,c,d)}r.Db=function(){if(this.m){var a=this.lf,b=this.i.C;a.Ha=null===this.i.C?!1:!0;a.Ia=0>=z(this.i)?!1:!0;if(null!==b){var c=b.U;a.Ua=c<z(b)-1?!0:!1;a.Va=0<c?!0:!1}else a.Ua=!1,a.Va=!1;this.j&&(a.oa=this.j.La);this.m.Db(a)}};"use strict;";function eb(){this.ab=this.W=0}eb.prototype.Bb=function(){this.ab=this.W=0};eb.prototype.L=function(a,b){this.W=a;this.ab=b};function fc(a,b){this.Id=void 0===a?M:a;this.Kd=void 0===b?-1:b}fc.prototype.ba=function(){this.Id=M;this.Kd=-1};fc.prototype.fc=function(a){this.Id=a};fc.prototype.ca=function(){return this.Id};fc.prototype.Xc=function(){return this.Kd};function gc(){this.Hb=[];this.lb=[]}gc.prototype.S=function(){return this.lb.length};gc.prototype.ca=function(a){return this.lb[a]};function hc(a,b,c){b=(c<<8)+b;c=0;for(var d=a.lb.length;c<d;c++)if(a.lb[c]==b)return!0;return!1}function ic(){this.la={}}ic.prototype.ba=function(){this.la={}};ic.prototype.yb=function(a,b){var c=(b<<8)+a;if(void 0!==this.la[c])return!0;this.la[c]=1;return!1};function jc(){this.F={};this.Ob=M}jc.prototype.ba=function(){this.F={};this.Ob=M};jc.prototype.yb=function(a,b){var c=(b<<8)+a;if(void 0!==this.F[c])return!0;this.F[c]=1;return!1};function $a(a,b,c){c=void 0===c?a.Ob:c;for(var d in a.F)a=T(d|0),b.Ba[Ba(b,a.e,a.f)]=c}function Yb(a,b){this.Q=void 0===a?19:a;this.T=void 0===b?19:b;this.Xa=null;kc(this);this.cb=new eb;this.Ba=null;this.F=new jc;this.tc=new ic}r=Yb.prototype;r.ba=function(){for(var a=this.Q*this.T,b=0;b<a;b++)this.Xa[b].ba()};r.S=function(){return{e:this.Q,f:this.T}};r.L=function(a,b,c,d){a=Ba(this,a,b);this.Xa[a].fc(c);void 0!==d&&null!==d&&-1!==d&&(this.Xa[a].Kd=d)};r.A=function(a,b){return this.Xa[Ba(this,a,b)].ca()};r.Xc=function(a,b){return this.Xa[Ba(this,a,b)].Xc()};function gb(a,b,c,d){var f=new gc;lc(a,b,c,d,f);return 0<f.S()?f:null}function fb(a,b,c,d,f){var e;switch(d){case I:e=K;break;case K:e=I;break;default:return null}d=new gc;!0!==hc(d,b+1,c)&&lc(a,b+1,c,e,d);!0!==hc(d,b-1,c)&&lc(a,b-1,c,e,d);!0!==hc(d,b,c+1)&&lc(a,b,c+1,e,d);!0!==hc(d,b,c-1)&&lc(a,b,c-1,e,d);e=d.S();if(1==e){b=(c<<8)+b;c=d.ca(0);e=a.cb;if(c===e.W&&b===e.ab&&1==f)return null;a.cb.L(b,c)}else if(1<e)a.cb.Bb();else if(0>=e)return null;return d}function kc(a){var b=a.Q*a.T;a.Xa=Array(b);for(var c=0;c<b;c++)a.Xa[c]=new fc}function Ba(a,b,c){return(c-1)*a.Q+(b-1)}function mc(a,b,c,d,f){if(b>a.Q||1>b||c>a.T||1>c)return!1;var e=a.A(b,c);return M===e?!0:d===e?nc(a,b,c,d,f):!1}function nc(a,b,c,d,f){var e;a:{e=(c<<8)+b;for(var g=0,h=f.Hb.length;g<h;g++)if(f.Hb[g]==e){e=!0;break a}f.Hb.push(e);e=!1}return!0===e?!1:!0===mc(a,b+1,c,d,f)||!0===mc(a,b-1,c,d,f)||!0===mc(a,b,c+1,d,f)||!0===mc(a,b,c-1,d,f)?!0:!1}function lc(a,b,c,d,f){b>a.Q||1>b||c>a.T||1>c||d!==a.A(b,c)||(!0!==nc(a,b,c,d,f)&&(f.lb=f.lb.concat(f.Hb)),f.Hb=[])}r.$b=function(a){for(var b=0,c=0,d=1;d<=this.T;d++)for(var f=1;f<=this.Q;f++){var e=null,g=this.Ba[Ba(this,f,d)];I===g?(e=new L(f,d,Qa,""),K===this.A(f,d)?b+=2:b++):K===g&&(e=new L(f,d,Ra,""),I===this.A(f,d)?c+=2:c++);null===e?a.ya(f,d):a.ea(e)}return{sb:b,Eb:c}};function oc(a,b,c){if(!(b>a.Q||1>b||c>a.T||1>c)){var d=a.A(b,c);if(M!==a.A(b,c))switch(b=a.F.Ob,b){case M:a.F.Ob=d;break;case I:case K:b!==d&&(a.F.Ob=3)}else!1===a.F.yb(b,c)&&(oc(a,b+1,c),oc(a,b-1,c),oc(a,b,c+1),oc(a,b,c-1))}}function Ya(a,b,c,d){b>a.Q||1>b||c>a.T||1>c||(3-d===a.A(b,c)?d===a.Ba[Ba(a,b,c)]&&a.tc.yb(b,c):!0!==a.F.yb(b,c)&&(Ya(a,b+1,c,d),Ya(a,b-1,c,d),Ya(a,b,c+1,d),Ya(a,b,c-1,d)))}function Za(a,b,c,d){if(!(b>a.Q||1>b||c>a.T||1>c)&&3-d!==a.A(b,c)){if(d===a.A(b,c)){var f=a.tc,e=(c<<8)+b;void 0!==f.la[e]&&delete f.la[e]}!0!==a.F.yb(b,c)&&(Za(a,b+1,c,d),Za(a,b-1,c,d),Za(a,b,c+1,d),Za(a,b,c-1,d))}}function Ca(a,b){for(var c=1;c<=a.T;c++)for(var d=1;d<=a.Q;d++)M===a.A(d,c)&&(M===a.Ba[Ba(a,d,c)]||!0===b&&3===a.Ba[Ba(a,d,c)])&&(a.F.ba(),oc(a,d,c),$a(a.F,a))};function pc(a,b){this.sc=a;this.r=b}r=pc.prototype;r.ub=function(){return T(this.sc).e};r.vb=function(){return T(this.sc).f};r.ca=function(){return this.sc};r.fc=function(a){this.sc=a};r.jb=function(a){this.r=a};function Zb(a){this.gf=++a.hf;this.ua=[];this.U=-1;this.C=null;this.ka=[];this.Ea=new pc(0,M);this.Qb="";this.wa=new qc;this.da={e:-1,f:-1,od:-1};a.Ge[this.gf]=this}r=Zb.prototype;r.xb=function(){return!0};r.D=function(a){return void 0!==this.ua[a]?this.ua[a]:this.ua[this.U]};function hb(a,b){a.U=b>=a.ua.length?a.ua.length-1:b}function z(a){return a.ua.length}r.hb=function(){return M===this.Ea.r?!1:!0};r.Vb=function(a){this.Qb+=a};r.pd=function(a){this.Qb=a};r.Dc=function(a,b){this.wa.la[""+a]=b};r.Rc=function(){this.wa.la={}};r.Yc=function(){for(var a=this;0<z(a);)hb(a,0),a=a.D(0)};function cc(a){for(var b=null;null!==(b=a.C);){if(0!=b.U)return!1;a=b}return!0}r.ib=function(){for(var a=this,b=null;null!=(b=a.C);){if(b.D(b.U)!=a)return!1;a=b}return!0};r.gb=function(a,b,c){a=(b<<8)+a;this.ka.push(new Qb(I===c?1:2,a));M===this.Ea.r&&(this.Ea.fc(a),this.Ea.jb(c))};r.Ub=function(a,b){var c=new Qb(I===a?257:K===a?258:259,Sb(b),b.length);this.ka.push(c)};r.ea=function(a,b){var c=0;switch(a){case Sa:c=529;break;case xa:c=Pb.Bf;break;case Ta:c=531;break;case Ua:c=532;break;case Pa:c=Pb.Ff;break;case Va:c=Pb.e}c=new Qb(c,Sb(b),b.length);this.ka.push(c)};r.rb=function(a,b){this.ka.push(new Qb(533,{Text:a,$e:b}))};r.qd=function(a){this.ka.push(new Qb(260,a))};r.Cc=function(a){this.ka.push(new Qb(769,a))};r.Ec=function(a){this.ka.push(new Qb(770,a))};r.gc=function(a,b){b.a.ic.d.a.getContext("2d").clearRect(0,0,b.b.B,b.b.s);switch(a){case Xb:rc(this,b,-1);break;case 1:var c=this.C;null!==c&&rc(c,b,this.Ea.ca())}};function rc(a,b,c){if(b)for(var d=0,f=z(a);d<f;d++){var e=a.D(d).Ea;if(M!==e.r&&c!==e.ca()){var g=T(e.ca()),e=b;if(e.b.u){var h=(e.b.ja/2-1)/2,m=e.b.u,l=m[g.e-1].e,g=m[g.f-1].f,m=e.a.ic.d.a.getContext("2d");m.fillStyle=S(e.nf);m.beginPath();m.arc(l,g,h,0,2*Math.PI,!1);m.fill()}}}};function $b(a){this.g=a;this.l=[];this.nb=this.c=0;this.Ed=[];this.Da=!0;this.Nb=0}function ac(a){a.g.Bb();if("("===a.l[0]&&";"===a.l[1])for(a.c++;a.c<a.Nb&&(")"!==a.l[a.c]||0!==a.nb);){var b=a.l[a.c];if(";"===b){1!=a.c?ab(a.g,!1,!1):a.g.i=a.g.ma;a:{b=a;b.c++;for(var c=b.l[b.c],d=b.l[b.c+1];void 0!==c&&")"!==c&&";"!==c&&"("!==c;){switch(c){case "A":switch(d){case "B":sc(b,I);break;case "E":sc(b,M);break;case "W":sc(b,K);break;case "N":c=b;c.c+=3;W(c);break;case "P":c=b;c.c+=3;W(c);break;default:$(b)}break;case "B":switch(d){case "[":tc(b,I);break;case "R":c=b;c.c+=3;W(c);break;case "T":c=b;c.c+=3;W(c);break;case "L":c=b;c.c+=3;c.g.Cc(uc(c));break;default:$(b)}break;case "C":switch(d){case "[":c=b;c.c+=2;for(d="";"]"!==c.l[c.c]||"\\"===c.l[c.c-1];)"]"===c.l[c.c+1]&&"\\"===c.l[c.c]?(d+="]",c.c++):d+=c.l[c.c],c.c++;c.c++;c.g.Vb(d);break;case "A":c=b;c.c+=3;W(c);break;case "P":c=b;c.c+=3;W(c);break;case "R":vc(b,Sa);break;default:$(b)}break;case "D":switch(d){case "D":c=b;c.c+=3;W(c);break;default:$(b)}break;case "E":switch(d){case "V":c=b;c.c+=3;W(c);break;default:$(b)}break;case "F":switch(d){case "F":$(b);break;default:$(b)}break;case "G":switch(d){case "N":c=b;c.c+=3;W(c);break;case "C":c=b;c.c+=3;W(c);break;case "M":c=b;c.c+=3;1!==wc(c)&&(c.Da=!1);break;default:$(b)}break;case "H":switch(d){case "A":c=b;c.c+=3;wc(c);break;default:$(b)}break;case "K":switch(d){case "M":c=b;c.c+=3;uc(c);break;default:$(b)}break;case "L":switch(d){case "B":c=b;for(c.c+=3;;){d=c.l[c.c];c.c++;var f=c.l[c.c];c.c++;d=d.charCodeAt(0)-96;f=f.charCodeAt(0)-96;c.c++;for(var e="";"]"!==c.l[c.c]&&c.c<c.Nb;)e+=c.l[c.c],c.c++;c.g.rb(e,(f<<8)+d);if("]"!==c.l[c.c]){c.Da=!1;break}c.c++;if("["!==c.l[c.c])break;c.c++}break;default:$(b)}break;case "M":switch(d){case "A":vc(b,Va);break;default:$(b)}break;case "O":switch(d){case "N":c=b;c.c+=3;W(c);break;case "T":c=b;c.c+=3;W(c);break;default:$(b)}break;case "P":switch(d){case "B":c=b;c.c+=3;W(c);break;case "C":c=b;c.c+=3;W(c);break;case "W":c=b;c.c+=3;W(c);break;default:$(b)}break;case "R":switch(d){case "E":c=b;c.c+=3;W(c);break;case "O":c=b;c.c+=3;W(c);break;case "U":c=b;c.c+=3;W(c);break;default:$(b)}break;case "S":switch(d){case "Q":vc(b,Ta);break;case "T":c=b;c.c+=3;switch(wc(c)){case 0:pa(c.g,Xb);break;case 1:pa(c.g,1);break;default:pa(c.g,0)}break;case "Z":d=b;d.c+=3;c=wc(d);0>=c&&(c=19);d=d.g;f=d.G;e=c;f.Q=c;f.T=e;kc(f);f.cb.Bb();d.j&&(c=d.j,qa(c),c.Pa(!0));break;case "O":c=b;c.c+=3;W(c);break;default:$(b)}break;case "T":switch(d){case "R":vc(b,Ua);break;case "M":c=b;c.c+=3;W(c);break;case "B":xc(b,I);break;case "W":xc(b,K);break;default:$(b)}break;case "U":switch(d){case "S":c=b;c.c+=3;W(c);break;default:$(b)}break;case "W":switch(d){case "[":tc(b,K);break;case "R":c=b;c.c+=3;W(c);break;case "T":c=b;c.c+=3;W(c);break;case "L":c=b;c.c+=3;c.g.Ec(uc(c));break;default:$(b)}break;default:$(b)}if(!b.Da){b=!1;break a}c=b.l[b.c];d=b.l[b.c+1]}b=!0}if(!b)return!1}else if("("===b)a.Ed[a.nb]=a.g.i,a.nb++,a.c++;else if(")"===b)a.nb--,a.g.i=a.Ed[a.nb],a.c++;else return!1}else return!1;return!0}function W(a,b){void 0===b&&(b="]");for(var c="";void 0!==a.l[a.c]&&b!==a.l[a.c];)c+=a.l[a.c],a.c++;void 0===a.l[a.c]&&(a.Da=!1);a.c++;return c}function uc(a){a=parseFloat(W(a,void 0));return isNaN(a)?0:a}function wc(a){a=parseInt(W(a,void 0));return isNaN(a)?0:a}function $(a){for(;;){for(;void 0!==a.l[a.c]&&"]"!==a.l[a.c]&&a.c<a.Nb;)for(a.c++;"]"===a.l[a.c]&&"\\"===a.l[a.c-1];)a.c++;a.c++;if("["!==a.l[a.c])break}}function sc(a,b){a.c+=3;var c=[];if("]"!==a.l[a.c]){for(;;){var d=a.l[a.c];a.c++;var f=a.l[a.c];a.c++;c.push((f.charCodeAt(0)-96<<8)+(d.charCodeAt(0)-96));if("]"!==a.l[a.c]){a.Da=!1;return}a.c++;if("["!==a.l[a.c])break;a.c++}a.g.Ub(b,c)}}function tc(a,b){a.c+=2;if("]"==a.l[a.c])a.g.gb(0,0,b);else{var c=a.l[a.c];a.c++;var d=a.l[a.c];a.c++;var f=a.g.G.S();"t"===c&&"t"===d&&19>=f.e&&19>=f.f?a.g.gb(0,0,b):(a.g.gb(c.charCodeAt(0)-96,d.charCodeAt(0)-96,b),"]"!==a.l[a.c]&&(a.Da=!1))}a.c++}function vc(a,b){var c=0;a.c+=3;var d=[];if("]"!==a.l[a.c]){for(;;){var f=a.l[a.c];a.c++;var e=a.l[a.c];a.c++;d[c]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);c++;if("]"!==a.l[a.c]){a.Da=!1;return}a.c++;if("["!==a.l[a.c])break;a.c++}a.g.ea(b,d)}}function xc(a,b){var c=0;a.c+=3;var d=[];if("]"!==a.l[a.c]){for(;;){var f=a.l[a.c];a.c++;var e=a.l[a.c];a.c++;d[c]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);c++;if("]"!==a.l[a.c]){a.Da=!1;return}a.c++;if("["!==a.l[a.c])break;a.c++}a.g.Dc(b,d)}};function qc(){this.Ya=!1;this.la={}};}());