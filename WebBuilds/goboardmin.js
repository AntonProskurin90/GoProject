/*
 * Copyright (C) 2014  Ilya Kirillov 
 * email: ilya_kirillov@inbox.ru
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3.0 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
*/
(function(){var n;function ca(){this.l=this.g=null;this.Z=0;this.Ka=!1;this.Jb=this.La=this.Ma=this.ha=this.ia=0;this.ua=null;this.c={L:0,o:0,K:0,dc:0,Xb:2,n:null,Wb:null,q:null,wb:null,Eb:[],lc:Array(361),Ya:null,kb:null,Ga:null,Ha:null,ic:null,jc:null,ec:null,fc:null,gc:null,hc:null,Zb:null,Ub:null,Vb:null};this.Lb=new p(231,188,95,255);this.rc=new p(0,0,0,255);this.Pc=new p(255,0,0,128);this.va={vc:new p(232,196,115,255),Gc:new p(255,255,255,255),uc:new p(0,0,0,255),Dc:new p(141,141,141,255),yc:new p(112,95,54,255),zc:new p(112,95,54,255)};this.b={e:null,q:{e:null},n:{e:null},Fa:{e:null},W:{e:null},jb:{e:null},R:{e:null},ib:{e:null},Event:{e:null}};this.U={d:-1,f:-1};this.A={};this.Mb=-1;var a=this;this.Tc=function(c){da(c);c=ma(a);c=na(a,c.d,c.f);oa(a,c.d,c.f,!1)};this.Rb=function(c){da(c);pa(a)};this.Qb=function(c){if(c.pageX||c.pageY)s.d=c.pageX,s.f=c.pageY;else if(c.clientX||c.clientY)s.d=c.clientX,s.f=c.clientY;s.$b=s.d;s.ac=s.f;s.Xa=c.altKey;s.u=c.shiftKey;s.J=c.ctrlKey||c.metaKey;s.kc=ra;s.Tb=c.button;s.D=c.srcElement?c.srcElement:c.target;var b=(new Date).getTime();0==s.Aa?(s.Aa=1,s.Da=b):500>b-s.Da?(s.Da=b,s.Aa++):(s.Aa=1,s.Da=b);window.mc=!1;a.b.Event.e.b.focus();b=ma(a);b=na(a,b.d,b.f);a.Pb(b.d,b.f,s);c.preventDefault();c.stopPropagation();return!1};this.Rc=function(c){sa(c);if(16===x.cb&&2===a.Z)s.u=!0,ta(a);else{var b=x,d=b.cb;if(8===d||46===d){if(b=a.g,d=b.i.O,null!==d)for(var f=0,e=d.p.length;f<e;f++)if(b.i===Ba(d,f)){e=d;e.p.splice(f,1);e.H>=f&&e.H--; -1===e.H&&0<e.p.length&&(e.H=0);b.i=d;y(b,d);break}}else if(13===d)b=prompt("Enter here code of ur sgf file",""),a.g.eb(b);else if(37===d)b.J&&b.u?(b=a.g,y(b,b.N)):b.J?Ca(a.g,5):Ca(a.g,1);else if(38===d)b.J?a.g.$a():(b=a.g,d=b.i.O,null!==d&&(f=d.H,0<d.p.length&&0<f&&y(b,Ba(d,f-1))));else if(39===d)if(b.J&&b.u){for(b=a.g;Da(b););y(b,b.i)}else b.J?Ea(a.g,5):Ea(a.g,1);else 40===d?(b=a.g,d=b.i.O,null!==d&&(f=d.H,f<d.p.length-1&&y(b,Ba(d,f+1)))):192===d?(b=!0===a.Ka?!1:!0,b!==a.Ka&&(a.Ka=b,Fa(a),a.wa(!0))):189===d?(b=a.g.pb,b++,b>Ga&&(b=Ha),Ma(a.g,b)):49===d&&(b=a.Z+1,a.Z=8<b?0:b,ta(a))}c.preventDefault()};this.Sc=function(c){sa(c);16===x.cb&&2===a.Z&&(s.u=!1,ta(a))};this.Wc=function(){return setTimeout(function(){var c=a.b.q.e.b.width,b=a.b.q.e.b.height,d=a.b.q.e.b.getContext("2d");if(0!==c&&0!==b){for(var f=d.createImageData(c,b),e=.9,g=a.Lb.xa,h=a.Lb.pa,l=a.Lb.oa,m=Array(c),k=0;k<c;k++)m[k]=(Math.tan(300*k/c)+1)/2+(Math.tan(100*k/c)+1)/10;for(var q=Array(b),w=0;w<b;w++)q[w]=.02*Math.tan(w/b);for(var F,G,wb,w=0;w<b;w++)for(k=0;k<c;k++){e=40*(m[k]+q[w])+.5;e-=Math.floor(e);e=.2>e?1-e/2:.4>e?1-(.4-e)/2:1;if(w==b-1||w==b-2&&k<c-2||k>=c-1||k==c-2&&w<b-1)e/=2;0==w||1==w&&1<k||0==k||1==k&&1<w?(F=128+g*e/2,G=128+h*e/2,wb=128+l*e/2):(F=g*e,G=h*e,wb=l*e);var Wa=4*(k+w*c);f.data[Wa+0]=F;f.data[Wa+1]=G;f.data[Wa+2]=wb;f.data[Wa+3]=255}a.c.q=f;a.c.L=c;a.c.o=b;a.ua=null}var Xa=a.c.L,xb=a.c.o;if(0!==Xa&&0!==xb){for(var lc=a.ha*Xa,nc=a.ia*xb,ed=a.La*xb,fd=a.Ma*Xa,oc=a.l.r(),pc=Array(oc.d),qc=lc,rc=nc,Ia=0;Ia<oc.d;Ia++)qc=lc+Ia*fd,rc=nc+Ia*ed,pc[Ia]={d:Math.floor(qc+.5),f:Math.floor(rc+.5)};a.c.n=pc;for(var U=Math.max(2,Math.ceil(a.Jb*Xa/2)),J=2*U+1,gd=a.c,R=a.rc,N=document.createElement("canvas").getContext("2d").createImageData(J,J),ea=U,fa=-1,hd=ea*ea,sc=0;ea>fa;){fa++;var tc=Math.sqrt(hd-fa*fa),yb=Math.ceil(tc)-tc;yb<=sc&&ea--;var ga=Math.floor(255*(1-yb)),zb=U+ea,Ab=U+ea,Bb=U+fa,Cb=U+fa,Db=U-ea,Eb=U-ea,Fb=U-fa,Gb=U-fa;A(N,zb,Cb,ga,J,R);A(N,Bb,Ab,ga,J,R);A(N,Db,Cb,ga,J,R);A(N,Fb,Ab,ga,J,R);A(N,zb,Gb,ga,J,R);A(N,Bb,Eb,ga,J,R);A(N,Db,Gb,ga,J,R);A(N,Fb,Eb,ga,J,R);for(var uc=zb-1,vc=Ab-1,wc=Db+1,xc=Eb+1,id=N,jd=uc,kd=Cb,ld=J,md=R,Hb=wc;Hb<=jd;Hb++)A(id,Hb,kd,255,ld,md);for(var nd=N,od=vc,pd=Bb,qd=J,rd=R,Ib=xc;Ib<=od;Ib++)A(nd,pd,Ib,255,qd,rd);for(var sd=N,td=uc,ud=Gb,vd=J,wd=R,Jb=wc;Jb<=td;Jb++)A(sd,Jb,ud,255,vd,wd);for(var xd=N,yd=vc,zd=Fb,Ad=J,Bd=R,Kb=xc;Kb<=yd;Kb++)A(xd,zd,Kb,255,Ad,Bd);sc=yb}gd.Wb=N;a.c.Xb=U}var $=a.b.q.e.b.width,ua=a.b.q.e.b.height,Ja=a.b.Fa.e.b.getContext("2d"),z=2*Math.floor(Math.floor(a.Ma*$)/2)+1;a.c.K=z;a.c.wb=Ja.createImageData(z,z);a.c.Fc=Ja.createImageData(z,z);a.c.Ya=Ja.createImageData(z,z);a.c.kb=Ja.createImageData(z,z);for(var ha=a.c.wb.data,O=a.c.Fc.data,ia=a.c.Ya.data,aa=a.c.kb.data,Lb=z/2-.5,Ya=Lb-.2,Cd=Math.sqrt(3),ja=0;ja<z;ja++)for(var ka=0;ka<z;ka++){var va=ja-Lb,wa=ka-Lb,Ka=Ya-Math.sqrt(va*va+wa*wa),r=4*(ja*z+z-ka-1);if(0<=Ka){var xa=Ya*Ya-va*va-wa*wa,xa=0<xa?Math.sqrt(xa)*Cd:0,Mb=va,Nb=wa,ya=Math.sqrt(6*(Mb*Mb+Nb*Nb+xa*xa)),ya=(2*xa-Mb+Nb)/ya,Ob=0;.9<ya&&(Ob=10*(ya-.9));var La=255;if(.8>=Ka){var Ka=(.8-Ka)/.8,yc=.7;va-wa<Ya/3&&(yc=1);La=parseInt(255*(1-Ka*yc))}var P=parseInt(10+10*ya+140*Ob);ha[r+0]=P;ha[r+1]=P;ha[r+2]=P;ha[r+3]=La;ia[r+0]=P;ia[r+1]=P;ia[r+2]=P;ia[r+3]=parseInt(La/2);P=parseInt(200+10*ya+45*Ob);O[r+0]=P;O[r+1]=P;O[r+2]=P;O[r+3]=La;aa[r+0]=P;aa[r+1]=P;aa[r+2]=P;aa[r+3]=parseInt(La/2)}else ha[r+0]=0,ha[r+1]=0,ha[r+2]=0,ha[r+3]=0,ia[r+0]=0,ia[r+1]=0,ia[r+2]=0,ia[r+3]=0,O[r+0]=0,O[r+1]=0,O[r+2]=0,O[r+3]=0,aa[r+0]=0,aa[r+1]=0,aa[r+2]=0,aa[r+3]=0}for(var Pb=[],ba=[],r=0;28>r;r++)for(Pb[r]=Ja.createImageData(z,z),ba[r]=Pb[r].data,ja=0;ja<z;ja++)for(ka=0;ka<z;ka++){var la=4*(ja*z+ka);ba[r][la+0]=O[la+0];ba[r][la+1]=O[la+1];ba[r][la+2]=O[la+2];ba[r][la+3]=O[la+3]}ba.push(aa);ba.push(O);for(var K=.9,zc=Array($),H=0;H<$;H++)zc[H]=(Math.sin(18*H/$)+1)/20+(Math.sin(3*H/$)+1)/10;for(var Ac=Array(ua),I=0;I<ua;I++)Ac[I]=.2*Math.cos(5*I/ua)+.1*Math.sin(11*I/ua);for(var Bc=Array($*ua),I=0;I<ua;I++)for(H=0;H<$;H++)K=75*(zc[H]+Ac[I])+.5,K-=Math.floor(K),K=.2>K?1-K/2:.4>K?1-(.4-K)/2:1,Bc[H+I*$]=K;for(var Cc=a.c.n,Dc=(a.c.K-1)/2,Dd=ba.length,Za=0;Za<Dd;Za++){var za=ba[Za],u=0,v=0;switch(Za){case 0:u=0;v=3;break;case 1:u=0;v=4;break;case 2:u=0;v=5;break;case 3:u=0;v=6;break;case 4:u=1;v=3;break;case 5:u=1;v=4;break;case 6:u=1;v=5;break;case 7:u=1;v=6;break;case 8:u=2;v=3;break;case 9:u=2;v=4;break;case 10:u=2;v=5;break;case 11:u=2;v=6;break;case 12:v=u=3;break;case 13:u=3;v=4;break;case 14:u=3;v=5;break;case 15:u=3;v=6;break;case 16:u=4;v=3;break;case 17:v=u=4;break;case 18:u=4;v=5;break;case 19:u=4;v=6;break;case 20:u=5;v=3;break;case 21:u=5;v=4;break;case 22:v=u=5;break;case 23:u=5;v=6;break;case 24:u=6;v=3;break;case 25:u=6;v=4;break;case 26:u=6;v=5;break;case 27:v=u=6}for(var Ed=Cc[u].d-Dc,Fd=Cc[v].f-Dc,I=0;I<z;I++)for(H=0;H<z;H++){var K=Bc[Ed+H+(Fd+I)*$],Aa=4*(H+I*z);za[Aa+0]*=K;za[Aa+1]*=K;za[Aa+2]*=K}}a.c.Eb=Pb;for(var Qb=0;19>Qb;Qb++)for(var Rb=0;19>Rb;Rb++)a.c.lc[Rb+19*Qb]=Math.floor(Math.random()*(a.c.Eb.length-1));var Gd=a.b.W.e.b.getContext("2d"),qa=a.c.K;a.c.W=Gd.createImageData(qa,qa);var $a=a.c.W.data;a.c.dc=Math.max(parseInt(.15*qa),3);for(var Sb=(qa-5)/2+1,ab=0;ab<qa;ab++)for(var bb=0;bb<qa;bb++){var Ec=Math.abs(ab-Sb),Fc=Math.abs(bb-Sb),Gc=Math.sqrt(Fc*Fc+Ec*Ec)/Sb,Hd=1>Gc?.15+.75*(1-Gc):0,cb=4*(qa*ab+bb);$a[cb+0]=0;$a[cb+1]=0;$a[cb+2]=0;$a[cb+3]=parseInt(255*Hd)}var t=a.c.K;a.c.Ga=Na(a,t,t,.05*t,new p(0,0,0,255));a.c.Ha=Na(a,t,t,.05*t,new p(255,255,255,255));a.c.ic=a.$(t,t,.05*t,new p(0,0,0,255));a.c.jc=a.$(t,t,.05*t,new p(255,255,255,255));a.c.ec=Oa(a,t,t,.05*t,new p(0,0,0,255));a.c.fc=Oa(a,t,t,.05*t,new p(255,255,255,255));a.c.gc=Pa(a,t,t,new p(0,0,0,255));a.c.hc=Pa(a,t,t,new p(255,255,255,255));a.c.Zb=Qa(a,t,t,.05*t,new p(255,0,0,255));a.c.Ub=Qa(a,t,t,.05*t,new p(0,0,0,255));a.c.Vb=Qa(a,t,t,.05*t,new p(255,255,255,255));a.wa()},20)}}n=ca.prototype;n.na=function(a,c){this.g=c;this.l=c.w;this.g.k=this;this.b.e=Ra(a);var b=this.b.e.b,d=a+"_BoardCanvas",f=a+"_LinesCanvas",e=a+"_ShadowsCanvas",g=a+"_StonesCanvas",h=a+"_VariantsCanvas",l=a+"_MarksCanvas",m=a+"_TargetCanvas",k=a+"_EventDiv";Sa(b,d);Sa(b,f);Sa(b,e);Sa(b,g);Sa(b,h);Sa(b,l);Sa(b,m);var b=this.Ob(b,k),q=this.b.e;this.V(this.b.q,q,d);this.V(this.b.n,q,f);this.V(this.b.W,q,e);this.V(this.b.Fa,q,g);this.V(this.b.jb,q,h);this.V(this.b.R,q,l);this.V(this.b.ib,q,m);this.V(this.b.Event,q,k);b.onmousemove=this.Tc;b.onmouseout=this.Rb;b.onmousedown=this.Qb;b.onkeydown=this.Rc;b.onkeyup=this.Sc;b.tabIndex=-1;b.style.ed=!0;b.style.outline=0;return q};function Ta(a){a.b.Event.e.b.focus()}n.v=function(){var a=this.b.e.b.clientWidth,c=this.b.e.b.clientHeight;a!==c&&(c=a=Math.min(a,c));this.b.e.ca(a,c);Fa(this);this.wa()};function Ua(a,c,b,d){var f=a.b.Fa.e.b.getContext("2d"),e=a.b.W.e.b.getContext("2d"),g=a.c.K,h=(g-1)/2,l=a.c.n,m=a.c.dc,k=l[c-1].d-h,h=l[b-1].f-h;switch(d){case B:f.putImageData(a.c.wb,k,h);e.putImageData(a.c.W,k+m,h+m);break;case C:f.putImageData(a.c.Eb[a.c.lc[c-1+19*(b-1)]],k,h);e.putImageData(a.c.W,k+m,h+m);break;default:f.clearRect(k,h,g,g),e.clearRect(k+m,h+m,g,g)}c===a.U.d&&b===a.U.f&&(B===d||C===d?pa(a):ta(a))}n.ba=function(a,c){var b=(c<<8)+a;delete this.A[""+b];b===this.Mb&&(this.A[""+b]=new D(a,c,Va,""))};n.I=function(a){db(this,a.Ba(),a.Ca(),a)};function Sa(a,c){var b=document.createElement("canvas");b.setAttribute("id",c);b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");a.appendChild(b)}n.Ob=function(a,c){var b=document.createElement("div");b.setAttribute("id",c);b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");a.appendChild(b);return b};n.V=function(a,c,b){a.e=Ra(b);a=a.e;eb(a.h,0,1E3,1E3,!1,-1);a.ga=fb|gb|hb|ib;c.fa(a)};function ma(a){var c,b=s.d,d=s.f;c=a.b.q.e.b;if("undefined"!=typeof c.offsetParent){for(var f=a=0;c;c=c.offsetParent)a+=c.offsetLeft,f+=c.offsetTop;c=f}else a=c.x,c=c.y;return{d:b-a,f:d-c}}function Fa(a){var c=a.l.r(),b=c.d,d=c.f;if(!0===a.Ka){var c=jb/(2*kb+b),b=(jb-b*c)/2,f=lb/(2*mb+d),d=(lb-d*f)/2;a.ia=(d+f/2)/lb;a.ha=(b+c/2)/jb}else c=jb/(2*kb+b-1),b=(jb-(b-1)*c)/2,f=lb/(2*mb+d-1),d=(lb-(d-1)*f)/2,a.ia=d/lb,a.ha=b/jb;a.Ma=c/jb;a.La=f/lb;a.Jb=4/jb}n.wa=function(a){var c=this.b.q.e.b.width,b=this.b.q.e.b.height;if(c!=this.c.L||b!=this.c.o||null===this.c.q||null!==this.ua||!0===a){if(null!==this.ua&&clearTimeout(this.ua),this.ua=this.Wc(),0!==c&&0!==b){a=this.b.q.e.b.getContext("2d");a.fillStyle=E(this.va.vc);a.fillRect(0,0,c,b);var d=this.b.n.e.b.getContext("2d");a=this.ha*c;var f=this.ia*b,e=this.Ma*c,g=this.La*b,h=this.l.r();d.clearRect(0,0,c,b);d.strokeStyle=E(this.va.zc);for(var l=c-a,m=0;m<h.f;m++){var k=f+m*g;d.beginPath();d.moveTo(a,k);d.lineTo(l,k);d.stroke()}for(var l=b-f,q=0;q<h.d;q++)k=a+q*e,d.beginPath(),d.moveTo(k,f),d.lineTo(k,l),d.stroke();if(h.d===h.f&&(9===h.d||13===h.d||19===h.d)){d.fillStyle=E(this.va.yc);m=Math.max(2,this.Jb*c/2);q=[];switch(h.d){case 9:q=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:q=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:q=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var w=0,F=q.length;w<F;w++)l=a+q[w][0]*e,k=f+q[w][1]*e,d.beginPath(),d.arc(l,k,m,0,2*Math.PI,!1),d.fill()}d=this.b.Fa.e.b.getContext("2d");d.clearRect(0,0,c,b);d.strokeStyle=E(this.va.Dc);d.lineWidth=1;w=E(this.va.uc);F=E(this.va.Gc);for(m=1;m<=h.f;m++)for(q=1;q<=h.d;q++){l=L(this.l,q,m);if(B===l)d.fillStyle=w;else if(C===l)d.fillStyle=F;else continue;l=a+(q-1)*e;k=f+(m-1)*g;d.beginPath();d.arc(l,k,e/2,0,2*Math.PI,!1);d.fill();d.stroke()}this.b.W.e.b.getContext("2d").clearRect(0,0,c,b);this.b.jb.e.b.getContext("2d").clearRect(0,0,c,b);this.b.R.e.b.getContext("2d").clearRect(0,0,c,b);this.b.ib.e.b.getContext("2d").clearRect(0,0,c,b)}}else{this.b.q.e.b.getContext("2d").putImageData(this.c.q,0,0);if(!0===this.Ka&&this.c.n){c=this.b.q.e.b.getContext("2d");b=this.c.L;g=this.c.o;a=this.l.r();for(h=0;h<a.d;h++){d=2*this.c.K/3;f=(d-1)/2;l=this.c.n;e=l[h].d-f;l=this.ia*g/3-f;k=new String;switch(h+1){case 1:k="A";break;case 2:k="B";break;case 3:k="C";break;case 4:k="D";break;case 5:k="E";break;case 6:k="F";break;case 7:k="G";break;case 8:k="H";break;case 9:k="J";break;case 10:k="K";break;case 11:k="L";break;case 12:k="M";break;case 13:k="N";break;case 14:k="O";break;case 15:k="P";break;case 16:k="Q";break;case 17:k="R";break;case 18:k="S";break;case 19:k="T";break;case 20:k="a";break;case 21:k="b";break;case 22:k="c";break;case 23:k="d";break;case 24:k="e";break;case 25:k="f";break;case 26:k="g";break;case 27:k="h";break;case 28:k="j";break;case 29:k="k";break;case 30:k="l";break;case 31:k="m";break;case 32:k="n";break;case 33:k="o";break;case 34:k="p";break;case 35:k="q";break;case 36:k="r";break;case 37:k="s";break;case 38:k="t"}m=2*d/3;q=nb(k)?"Arial":"Helvetica, Arial, Verdana";q=m+"px "+q;c.fillStyle="rgb(0,0,0)";c.font=q;m=d/2+m/3;d=(d-c.measureText(k).width)/2;c.fillText(k,e+d,l+m);l=g-this.ia*g/3-f;c.fillText(k,e+d,l+m)}for(g=0;g<a.f;g++)d=2*this.c.K/3,f=(d-1)/2,l=this.c.n,e=this.ha*b/3-f,l=l[g].f-f,k=a.f-g+"",m=2*d/3,q=nb(k)?"Arial":"Helvetica, Arial, Verdana",q=m+"px "+q,c.fillStyle="rgb(0,0,0)",c.font=q,m=d/2+m/3,d=(d-c.measureText(k).width)/2,c.fillText(k,e+d,l+m),e=b-this.ha*b/3-f,c.fillText(k,e+d,l+m)}ob(this);pb(this);qb(this)}};function ob(a,c){if(a.c.n){var b=a.c.L,d=a.c.o,f=a.b.n.e.b.getContext("2d"),e=a.l.r(),g=a.c.n;f.clearRect(0,0,b,d);if(e.d===e.f&&(9===e.d||13===e.d||19===e.d)){var d=a.c.Wb,h=a.c.Xb,l=[];switch(e.d){case 9:l=[[2,2],[2,6],[4,4],[6,2],[6,6]];break;case 13:l=[[3,3],[3,6],[3,9],[6,3],[6,6],[6,9],[9,3],[9,6],[9,9]];break;case 19:l=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]}for(var m=0,k=l.length;m<k;m++)f.putImageData(d,g[l[m][0]].d-h,g[l[m][1]].f-h)}for(var h=g[0].d,l=g[g.length-1].d,m=g[0].f,k=g[g.length-1].f,q=f.createImageData(1,k-m),w=f.createImageData(l-h,1),F=a.rc,G=0;G<k-m;G++)d=4*G,q.data[d+0]=F.xa,q.data[d+1]=F.pa,q.data[d+2]=F.oa,q.data[d+3]=F.Fb;for(G=0;G<l-h;G++)d=4*G,w.data[d+0]=F.xa,w.data[d+1]=F.pa,w.data[d+2]=F.oa,w.data[d+3]=F.Fb;for(G=0;G<e.d;G++)f.putImageData(q,g[G].d,g[0].f),f.putImageData(w,g[0].d,g[G].f);if(void 0!==c)for(b=(2*Math.floor(parseInt(a.La*b)/2)+1-1)/2,e=g[1].d-g[0].d+2,h=g[1].f-g[0].f+2,d=0;d<c.length;d++)l=c[d].d,m=c[d].f,M===L(a.l,l,m)&&f.clearRect(g[l-1].d-b,g[m-1].f-b,e,h)}}function A(a,c,b,d,f,e){c=4*(c+b*f);a.data[c+0]=e.xa;a.data[c+1]=e.pa;a.data[c+2]=e.oa;a.data[c+3]=d}function pb(a,c){if(void 0===c){var b=a.c.L,d=a.c.o;a.b.Fa.e.b.getContext("2d").clearRect(0,0,b,d);a.b.W.e.b.getContext("2d").clearRect(0,0,b,d);b=a.l.r();for(d=1;d<=b.f;d++)for(var f=1;f<=b.d;f++)Ua(a,f,d,L(a.l,f,d))}else for(b=a.l.r(),d=1;d<=b.f;d++)for(f=1;f<=b.d;f++)L(a.l,f,d)!==L(c,f,d)&&Ua(a,f,d,L(a.l,f,d))}function ta(a){oa(a,a.U.d,a.U.f,!0)}function oa(a,c,b,d){var f=s;if(-1!==c&&-1!==b&&null===a.ua&&null!==a.c.n&&(void 0===d&&(d=!1),c!==a.U.d||b!==a.U.f||!0===d)){a.U.d=c;a.U.f=b;var e=a.c.L,g=a.c.o;d=a.b.ib.e.b.getContext("2d");d.clearRect(0,0,e,g);var g=(a.c.K-1)/2,h=a.c.n,e=h[c-1].d-g,g=h[b-1].f-g;c=L(a.l,c,b);switch(a.Z){case 0:M===c&&(B===a.g.ra?d.putImageData(a.c.Ya,e,g):d.putImageData(a.c.kb,e,g));break;case 1:B===c?d.putImageData(a.c.Ha,e,g):C===c&&d.putImageData(a.c.Ga,e,g);break;case 2:B===c?d.putImageData(a.c.Ha,e,g):C===c?d.putImageData(a.c.Ga,e,g):f.u?d.putImageData(a.c.kb,e,g):d.putImageData(a.c.Ya,e,g);break;default:B===c?d.putImageData(a.c.Ha,e,g):d.putImageData(a.c.Ga,e,g)}}}function pa(a){var c=a.c.L,b=a.c.o;a.b.ib.e.b.getContext("2d").clearRect(0,0,c,b);a.U.d=-1;a.U.f=-1}function na(a,c,b){var d=a.c.L,f=a.c.o,e=a.ha*d,g=a.ia*f,f=a.La*f,d=a.Ma*d,h=0;a=a.l.r();for(h=0;h<a.f-1&&b>g+f*h+f/2;h++);for(b=b=0;b<a.d-1&&c>e+d*b+d/2;b++);return{d:b+1,f:h+1}}function Na(a,c,b,d,f){a=a.b.R.e.b.getContext("2d");a.clearRect(0,0,c,b);a.strokeStyle=E(f);a.fillStyle=E(f);a.lineWidth=d;a.beginPath();a.moveTo(1*c/4,1*b/4);a.lineTo(3*c/4,3*b/4);a.moveTo(3*c/4,1*b/4);a.lineTo(1*c/4,3*b/4);a.stroke();return a.getImageData(0,0,c,b)}n.$=function(a,c,b,d,f){void 0===f&&(f=1);var e=this.b.R.e.b.getContext("2d");e.clearRect(0,0,a,c);e.globalAlpha=f;e.strokeStyle=E(d);e.fillStyle=E(d);e.lineWidth=b;var g=a/2;b=3*c/4;d=.1*a;f=Math.sqrt(g*g-(b-g)*(b-g))+g;g=-Math.sqrt(g*g-(b-g)*(b-g))+g;e.beginPath();e.moveTo(a/2,d);e.lineTo(f-d,b);e.lineTo(g+d,b);e.closePath();e.stroke();return e.getImageData(0,0,a,c)};function Oa(a,c,b,d,f){a=a.b.R.e.b.getContext("2d");a.clearRect(0,0,c,b);a.strokeStyle=E(f);a.fillStyle=E(f);a.lineWidth=d;var e=c/2,g=-b/2*Math.sqrt(2)/2+b/2;f=Math.floor(Math.sqrt(e*e-(g-e)*(g-e))+e-d);e=Math.ceil(-Math.sqrt(e*e-(g-e)*(g-e))+e+d);g=Math.ceil(g+d);d=Math.floor(b/2*Math.sqrt(2)/2+b/2-d);a.beginPath();a.moveTo(f,g);a.lineTo(e,g);a.lineTo(e,d);a.lineTo(f,d);a.closePath();a.stroke();return a.getImageData(0,0,c,b)}function Pa(a,c,b,d){a=a.b.R.e.b.getContext("2d").createImageData(c,b);for(var f=0;f<b;f++)for(var e=0;e<c;e++){var g=4*(f*c+e);f>=b/3&&f<=2*b/3&&e>=c/3&&e<=2*c/3?(a.data[g+0]=d.xa,a.data[g+1]=d.pa,a.data[g+2]=d.oa,a.data[g+3]=255):a.data[g+3]=0}return a}function Qa(a,c,b,d,f){a=a.b.R.e.b.getContext("2d");a.clearRect(0,0,c,b);var e=c/2,g=4*d;a.strokeStyle=E(f);a.fillStyle=E(f);a.lineWidth=d;a.beginPath();a.arc(c/2,b/2,e-g,0,2*Math.PI,!1);a.stroke();return a.getImageData(0,0,c,b)}function rb(a,c,b){a=a.A[""+((b<<8)+c)];return void 0!==a?a:null}function db(a,c,b,d){Va===d.m?sb(a,c,b):a.A[""+((b<<8)+c)]=d}function sb(a,c,b){var d=(b<<8)+c;void 0===a.A[""+d]&&(a.A[""+d]=new D(c,b,Va,""));a.Mb=d}function qb(a){a.b.R.e.b.getContext("2d").clearRect(0,0,a.c.L,a.c.o);var c=[],b;for(b in a.A){var d=a.A[b];tb(a,d);Q===d.m&&c.push({d:d.Ba(),f:d.Ca()})}ob(a,c)}function tb(a,c){if(a.c.n){var b=c.Ba(),d=c.Ca(),f=c.m,e=a.b.R.e.b.getContext("2d"),g=a.c.K,h=(g-1)/2,l=a.c.n,m=l[b-1].d-h,h=l[d-1].f-h,b=L(a.l,b,d);switch(f){case ub:e.putImageData(a.c.gc,m,h);break;case vb:e.putImageData(a.c.hc,m,h);break;case Va:e.putImageData(a.c.Zb,m,h);break;case Tb:e.putImageData(b===B?a.c.Vb:a.c.Ub,m,h);break;case Ub:e.putImageData(b===B?a.c.fc:a.c.ec,m,h);break;case Vb:e.putImageData(b===B?a.c.jc:a.c.ic,m,h);break;case Wb:e.putImageData(b===B?a.c.Ha:a.c.Ga,m,h);break;case Q:f=c.sb,d=2>=f.length?2*g/3:g/2,l=d+"px "+(nb(f)?"Arial":"Helvetica, Arial, Verdana"),e.fillStyle=b===B?"rgb(255,255,255)":"rgb(0,0,0)",e.font=l,e.fillText(f,m+(g-e.measureText(f).width)/2,h+(g/2+d/3))}}}n.Pb=function(a,c,b){switch(this.Z){case 0:if(Xb==b.Tb)1<=this.g.Pa&&(Ca(this.g,1),Yb(this,a,c));else if(b.u&&b.J)this.g.Cb(B===this.g.ra?C:B),ta(this);else if(!0===b.J){var d=new String;switch(a){case 1:d="A";break;case 2:d="B";break;case 3:d="C";break;case 4:d="D";break;case 5:d="E";break;case 6:d="F";break;case 7:d="G";break;case 8:d="H";break;case 9:d="J";break;case 10:d="K";break;case 11:d="L";break;case 12:d="M";break;case 13:d="N";break;case 14:d="O";break;case 15:d="P";break;case 16:d="Q";break;case 17:d="R";break;case 18:d="S";break;case 19:d="T"}this.g.Wa(d+c)}else if(b.u){d=this.g;d.B&&d.B.Cc(!0);var f=d.i;y(d,d.N);for(b=0;1E3>b&&M===L(d.w,a,c);)Ea(d,1),b++;M===L(d.w,a,c)&&y(d,f);d.B&&d.B.Cc(!1)}else Yb(this,a,c);break;case 2:!0===this.g.i.ab()&&(Zb(this.g),$b(this.g));d=B;M!==L(this.l,a,c)?d=M:b.u&&(d=C);Ua(this,a,c,d);this.l.F(a,c,d,-1);this.g.Va(d,[(c<<8)+a]);break;case 3:ac(this,Vb,a,c);break;case 4:ac(this,Ub,a,c);break;case 5:ac(this,Tb,a,c);break;case 6:ac(this,Wb,a,c);break;case 7:a:{f=rb(this,a,c);if(null!==f&&Q===f.m)this.g.ba([(c<<8)+a]),this.ba(a,c);else{f="";b.u&&(f=prompt("Enter the label that you want to add to board here. For best results, keep your label to one or two letters.",""));if(void 0==f||""===f||null===f){f=[];b=-1;for(d in this.A){var e=this.A[d];if(Q==e.m){var e=e.sb,g=e.charCodeAt(0);1==e.length&&65<=g&&90>=g&&(f[g]=1)}}for(d=65;90>=d;d++)if(void 0===f[d]||""==f[d]){b=d;break}f=-1==b?null:String.fromCharCode(b);if(null===f){alert("Sorry, all the standard labels are used up! To add more labels, you will have to shift click on the board and make up ur own labels to add.");break a}}d=new D(a,c,Q,f);this.g.za(f,(c<<8)+a);db(this,a,c,d)}qb(this)}break;case 8:a:{d=rb(this,a,c);if(null!==d&&Q===d.m)this.g.ba([(c<<8)+a]),this.ba(a,c);else{d="";if(b.u){d=this.l.Ab(a,c);if(-1==d){alert("Sorry, no move has been made at that location, so you can't mark it with the move number!");break a}d=""+d}if(void 0===d||""===d||null===d){d=[];b=0;for(f in this.A)e=this.A[f],Q===e.m&&nb(e.sb)&&(d[b]=parseInt(e.sb),b++);if(0>=b)d="1";else{d.sort(bc);for(var e=f=0,g=!1,h=0;h<b;h++){if(d[h]>f+1){e=f+1;g=!0;break}f=d[h]}g||(e=f+1);d=""+e}}f=new D(a,c,Q,d);this.g.za(d,(c<<8)+a);db(this,a,c,f)}qb(this)}}};function ac(a,c,b,d){var f=rb(a,b,d);if(null!==f&&c===f.m){if(a.g.ba([(d<<8)+b]),a.ba(b,d),a.c.n){c=(a.c.K-1)/2;var e=a.c.n,f=e[b-1].d-c,e=e[d-1].f-c;a.b.R.e.b.getContext("2d").clearRect(f,e,2*c,2*c);c=S(a.Mb);b===c.d&&d===c.f&&(sb(a,b,d),tb(a,rb(a,b,d)))}}else f=new D(b,d,c,""),a.g.I(c,[(d<<8)+b]),db(a,b,d,f),tb(a,f)}function Yb(a,c,b){if(M===L(a.l,c,b)){var d=B===a.g.ra?B:C,f=!1,e=new cc,f=a.l.la;e.ka=f.ka;e.ja=f.ja;a.l.F(c,b,d,-1);f=null!==dc(a.l,c,b,d,!0)?!0:null!==ec(a.l,c,b,d)?!1:!0;a.l.F(c,b,M,-1);var g=a.l.la;g.ka=e.ka;g.ja=e.ja;if(1==f){a:{for(var e=a.g,f=(b<<8)+c,g=0,h=e.i.p.length;g<h;g++){var l=Ba(e.i,g),m=l.da,k=m.m;if(f===m.C()&&d===k&&(B===d||C===d)){fc(e.i,g);e.i=l;e.Pa++;break a}}Zb(e,!1);e.i.ma(c,b,d);e.dd&&(e.Mc.Xc(),e.Ua.Ec())}$b(a.g)}}};function gc(){this.g=null;this.sa=this.m=0;this.c={cc:null,Yb:null,Sb:null};this.b={e:null,Za:{e:null}};this.Nc=new p(217,217,217,255);this.Oc=new p(0,0,0,255);this.pc=new p(54,101,179,255);this.qc=new p(255,255,255,255);this.G=this.s=0;var a=this;this.Qb=function(){a.sa=1;hc(a);a.Pb()};this.Vc=function(){a.sa=2;hc(a)};this.Uc=function(){1!==a.sa&&(a.sa=2);hc(a)};this.Rb=function(){a.sa=0;hc(a)};this.Qc=function(){if(a.g){var c=a.g;c.k&&Ta(c.k)}}}n=gc.prototype;n.na=function(a,c,b){this.g=c;this.m=b;this.b.e=Ra(a);c=this.b.e.b;b=document.createElement("canvas");b.setAttribute("id",a+"_canvas");b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");c.appendChild(b);this.b.Za.e=Ra(a+"_canvas");a=this.b.Za.e;eb(a.h,0,1E3,1E3,!1,-1);a.ga=fb|gb|hb|ib;this.b.e.fa(a);c.onmousedown=this.Qb;c.onmouseup=this.Vc;c.onmouseover=this.Uc;c.onmouseout=this.Rb;c.onfocus=this.Qc;c.tabIndex=-1;this.v()};n.v=function(){this.s=this.b.e.b.clientWidth;this.G=this.b.e.b.clientHeight;this.b.e.ca(this.s,this.G);this.wa()};n.wa=function(){var a=this.G,c=this.s;0!==c&&0!==a&&(this.c.Sb=ic(this,this.pc,this.qc,c,a),this.c.Yb=ic(this,this.pc,this.qc,c,a),this.c.cc=ic(this,this.Nc,this.Oc,c,a))};function ic(a,c,b,d,f){var e=a.b.Za.e.b.getContext("2d");e.fillStyle=E(c);e.fillRect(0,0,d,f);e.fillStyle=E(b);c=Math.min(d,f);var g=(d-c)/2;b=(f-c)/2;switch(a.m){case 1:a.$(c,g,b,e,-1);a=Math.ceil(g+c/10+.5);b=Math.ceil(b+c/5+.5);g=Math.floor(c/10+.5);c=Math.floor(3*c/5+.5);e.fillRect(a,b,g,c);break;case 2:a.$(c,g-c/10,b,e,-1);a=Math.ceil(g+8*c/10+.5);b=Math.ceil(b+c/5+.5);g=Math.floor(c/10+.5);c=Math.floor(3*c/5+.5);e.fillRect(a,b,g,c);break;case 3:a.$(c,g-c/10,b,e,-1);break;case 4:a.$(c,g-c/10,b,e,1);break;case 5:a.$(c,g+c/10,b,e,1);a=Math.ceil(g+c/10+.5);b=Math.ceil(b+c/5+.5);g=Math.floor(c/10+.5);c=Math.floor(3*c/5+.5);e.fillRect(a,b,g,c);break;case 6:a.$(c,g,b,e,1),a=Math.ceil(g+8*c/10+.5),b=Math.ceil(b+c/5+.5),g=Math.floor(c/10+.5),c=Math.floor(3*c/5+.5),e.fillRect(a,b,g,c)}return e.getImageData(0,0,d,f)}n.$=function(a,c,b,d,f){var e=Math.ceil(c+a/5+.5);c=Math.ceil(c+4*a/5+.5);var g=Math.ceil(b+a/5+.5),h=Math.ceil(b+a/2+.5);a=Math.ceil(b+4*a/5+.5);0>f?(d.beginPath(),d.moveTo(e,h),d.lineTo(c,g),d.lineTo(c,a)):(d.beginPath(),d.moveTo(e,g),d.lineTo(c,h),d.lineTo(e,a));d.closePath();d.fill()};function hc(a){var c=a.b.Za.e.b.getContext("2d"),b=null;switch(a.sa){case 2:b=a.c.Yb;break;case 1:b=a.c.Sb;break;default:case 0:b=a.c.cc}c.putImageData(b,0,0)}n.Pb=function(){if(this.g)switch(this.m){case 1:var a=this.g;y(a,a.N);break;case 2:Ca(this.g,5);break;case 3:Ca(this.g,1);break;case 4:Ea(this.g,1);break;case 5:Ea(this.g,5);break;case 6:for(a=this.g;Da(a););y(a,a.i)}};function jc(){this.P=this.S=this.T=this.Q=0;this.lb=this.nb=this.ob=this.mb=!1;this.ya=this.ea=-1}function eb(a,c,b,d,f,e){a.Q=c;a.T=0;a.S=b;a.P=d;a.mb=!1;a.ob=!1;a.nb=!1;a.lb=f;a.ea=-1;a.ya=e}var gb=1,fb=2,ib=4,hb=8;function kc(){this.h=new jc;this.ga=gb|fb;this.b=this.fb=this.bc=null;this.aa=new jc;this.t=[]}kc.prototype.fa=function(a){a.fb=this;this.t[this.t.length]=a};kc.prototype.ca=function(a,c){if(null==this.fb){if(this.aa.Q=0,this.aa.T=0,this.aa.S=a,this.aa.P=c,null!=this.b)for(var b=this.t.length,d=0;d<b;d++)this.t[d].ca(a,c)}else{var f=0,e=0,g=0,h=0,f=this.ga&5,b=this.ga&10;gb==f?(f=this.h.mb?this.h.Q:this.h.Q*a/1E3,g=-1!=this.h.ea?f+this.h.ea:this.h.nb?a-this.h.S:this.h.S*a/1E3):ib==f?(g=this.h.nb?a-this.h.S:this.h.S*a/1E3,f=-1!=this.h.ea?g-this.h.ea:this.h.mb?this.h.Q:this.h.Q*a/1E3):(gb|ib)==f?(f=this.h.mb?this.h.Q:this.h.Q*a/1E3,g=this.h.nb?a-this.h.S:this.h.S*a/1E3):(f=this.h.Q,g=this.h.S);fb==b?(e=this.h.ob?this.h.T:this.h.T*c/1E3,h=-1!=this.h.ya?e+this.h.ya:this.h.lb?c-this.h.P:this.h.P*c/1E3):hb==b?(h=this.h.lb?c-this.h.P:this.h.P*c/1E3,e=-1!=this.h.ya?h-this.h.ya:this.h.ob?this.h.T:this.h.T*c/1E3):(fb|hb)==b?(e=this.h.ob?this.h.T:this.h.T*c/1E3,h=this.h.lb?c-this.h.P:this.h.P*c/1E3):(e=this.h.T,h=this.h.P);g<f&&(g=f);h<e&&(h=e);-2===this.h.ea?g=f+(h-e)*g_dKoef_Board_W_to_H:-3===this.h.ea&&(f=(h-e)*g_dKoef_Board_W_to_H);this.aa.Q=f;this.aa.T=e;this.aa.S=g;this.aa.P=h;this.b.style.left=parseInt(f+.5)+"px";this.b.style.top=parseInt(e+.5)+"px";this.b.style.width=parseInt(g-f+.5)+"px";this.b.style.height=parseInt(h-e+.5)+"px";this.b.width=parseInt(g-f+.5);this.b.height=parseInt(h-e+.5);b=this.t.length;for(d=0;d<b;d++)this.t[d].ca(g-f,h-e)}};function Ra(a){var c=new kc;c.bc=a;c.b=document.getElementById(a);return c}function Hc(){this.b=this.fb=null;this.o=0;this.t=[]}Hc.prototype.F=function(a){this.o=a};Hc.prototype.fa=function(a){a.fb=this;this.t[this.t.length]=a};Hc.prototype.ca=function(a,c){var b=c-this.o,d=a;d!==b&&(b=d=Math.min(d,b));var f=(c-this.o-b)/2;this.b.style.left=parseInt((a-d)/2+.5)+"px";this.b.style.top=parseInt(f+.5)+"px";this.b.style.width=parseInt(d+.5)+"px";this.b.style.height=parseInt(b+this.o+.5)+"px";this.b.width=parseInt(d+.5);this.b.height=parseInt(b+this.o+.5);for(var f=this.t.length,e=0;e<f;e++)this.t[e].ca(d,b+this.o)};var ra=0,Ic=1,Xb=2,s=new function(){this.Tb=this.f=this.d=0;this.kc=Ic;this.u=this.J=this.Xa=!1;this.D=null;this.Da=-1;this.ac=this.$b=this.Aa=0;this.Bb=this.bb=!1},x=new function(){this.u=this.J=this.Xa=!1;this.D=null;this.cb=this.wc=0};function sa(a){x.Xa=a.altKey;x.J=void 0!==a.metaKey?a.ctrlKey||a.metaKey:a.ctrlKey;x.u=a.shiftKey;x.D=a.srcElement?a.srcElement:a.target;x.wc=a.charCode;x.cb=a.keyCode;x.cd=a.which}function da(a){if(!a.bb||a.Bb){if(a.pageX||a.pageY)s.d=a.pageX,s.f=a.pageY;else if(a.clientX||a.clientY)s.d=a.clientX,s.f=a.clientY;s.Xa=a.altKey;s.u=a.shiftKey;s.J=a.ctrlKey||a.metaKey;s.kc=Ic;s.bb||(s.D=a.srcElement?a.srcElement:a.target);if(3<Math.abs(s.d-s.$b)||3<Math.abs(s.f-s.ac))s.Da=-1,s.Aa=0}}window.onmousemove=function(a){s.bb&&void 0!=s.D&&null!=s.D&&void 0!=s.D.onmousemove&&null!=s.D.onmousemove&&(s.Bb=!0,s.D.onmousemove(a),s.Bb=!1)};window.onmouseup=function(a){if(!1===window.mc&&(window.mc=!0,s.bb&&void 0!=s.D.onmouseup&&null!=s.D.onmouseup))s.D.onmouseup(a,!0)};var Va=-1,Vb=0,Ub=1,Tb=2,Q=3,Wb=4,ub=5,vb=6;function D(a,c,b,d){this.sc={d:void 0===a?0:a,f:void 0==c?0:c};this.m=void 0===b?Vb:b;this.sb=void 0===d?"":d}D.prototype.Ba=function(){return this.sc.d};D.prototype.Ca=function(){return this.sc.f};D.prototype.Db=function(a){this.m=a};function Jc(){this.g=null;this.b={e:null};this.Kc=new p(217,217,217,255);this.Gb=[]}Jc.prototype.na=function(a,c,b){this.g=c;this.b.e=Ra(a);var d=this.b.e.b,f=this.b.e;d.style.backgroundColor=E(this.Kc);for(var e=0,g=b.t.length;e<g;e++){var h=b.t[e],l=null;switch(h){case 1:case 2:case 3:case 4:case 5:case 6:l=new gc}if(null!==l){var m=a+e;this.Ob(d,m);this.V(f,m,e/g,(e+1)/g);l.na(m,c,h);this.Gb.push(l)}}this.v()};Jc.prototype.v=function(){this.b.e.ca(this.b.e.b.clientWidth,this.b.e.b.clientHeight);for(var a=0,c=this.Gb.length;a<c;a++)this.Gb[a].v()};Jc.prototype.Ob=function(a,c){var b=document.createElement("div");b.setAttribute("id",c);b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");a.appendChild(b);return b};Jc.prototype.V=function(a,c,b,d){c=Ra(c);eb(c.h,1E3*b,1E3*d,1E3,!1,-1);c.ga=fb|gb|hb|ib;a.fa(c)};function Kc(a){if(this.g=a)a.Ua=this;this.Ta=null;this.Ja=[]}Kc.prototype.zb=function(a){var c=new ca;c.na(a,this.g);Ta(c);this.Ja.push(c);this.v()};Kc.prototype.yb=function(a){var c=this.g,b=Ra(a);Lc(b.b,a+"div");var d=a+"div",f=new Hc;f.bc=d;f.b=document.getElementById(d);f.F(25);var e=f.b;b.fa(f);d=a+"_Board";a+="_Toolbar";Lc(e,d);Lc(e,a);e=Ra(d);eb(e.h,0,1E3,25,!0,-1);e.ga=fb|gb|ib;f.fa(e);e=new ca;e.na(d,c);Ta(e);d=Ra(a);eb(d.h,0,1E3,0,!0,25);d.ga=gb|hb|ib;f.fa(d);f=new Jc;f.na(a,c,{t:[1,3,4,6]});this.Ta=b;this.Ja.push(e);this.Ja.push(f);this.v()};Kc.prototype.v=function(){this.Ta&&this.Ta.ca(this.Ta.b.clientWidth,this.Ta.b.clientHeight);for(var a=0,c=this.Ja.length;a<c;a++)this.Ja[a].v()};function Lc(a,c){var b=document.createElement("div");b.setAttribute("id",c);b.setAttribute("style","position:absolute;padding:0;margin:0;");b.setAttribute("oncontextmenu","return false;");a.appendChild(b)};var Mc={};function T(a,c,b){this.m=void 0===a?0:a;this.tc=void 0===c?null:c;this.oc=void 0===b?0:b}T.prototype.C=function(){return this.tc};T.prototype.Db=function(a){this.m=a};T.prototype.gb=function(a){this.tc=a};function Nc(){Y=X=0}function p(a,c,b,d){this.xa=a;this.pa=c;this.oa=b;this.Fb="undefined"===typeof d?255:d}p.prototype={};function E(a){return"rgba("+a.xa+","+a.pa+","+a.oa+","+a.Fb/255+")"}function S(a){var c=new Nc;c.d=a&255;c.f=a>>8&255;return c}function Oc(a){for(var c=[],b=0,d=a.length;b<d;b++)c.push(a[b]);return c}function nb(a){if("string"!=typeof a)return!1;for(var c=0;c<a.length;c++){var b=a.charCodeAt(c);if(48>b||57<b)return!1}return!0}function bc(a,c){return a>c?1:c>a?-1:0};var M=0,B=1,C=2,Ha=0,Ga=2,lb=460,jb=lb,mb=17.51/23.61,kb=mb;function Pc(a,c,b,d){this.Mc=c;this.B=b;this.Ua=a;this.A=d;this.w=new Qc;this.k=null;this.nc=[];this.N=new Rc(this);this.Jc=0;this.i=this.N;this.Sa=this.Oa=0;this.ra=B;this.Pa=this.Kb=0;this.pb=2}n=Pc.prototype;n.v=function(){this.Ua&&this.Ua.v()};n.eb=function(a){var c=new Sc(this);if(void 0!==a&&""!==a){c.j=[];c.a=0;c.ta=0;c.Hb=[];c.Y=!0;for(var b=c.Qa=0,d=a.length,f=[],e=!1;b<d;){(e||32<a.charCodeAt(b))&&f.push(a.charAt(b));if(3<=f.length&&"["==f[f.length-1]){var g=f[f.length-3]+f[f.length-2];if("C"==f[f.length-2]&&"UC"!=g||"AN"==g||"BR"==g||"BT"==g||"CP"==g||"DT"==g||"EV"==g||"GN"==g||"GC"==g||"ON"==g||"OT"==g||"PB"==g||"PC"==g||"PW"==g||"RE"==g||"RO"==g||"RU"==g||"SO"==g||"TM"==g||"US"==g||"WR"==g||"WT"==g)e=!0}else e&&1<=f.length&&"]"==f[f.length-1]&&(2>f.length||"\\"!=f[f.length-2])&&(e=!1);b++}c.j=f;c.Qa=c.j.length;Tc(c)||alert("Error occurs, while read SGF")}y(this,this.N);this.N.$a()};n.Ea=function(){this.nc=[];this.N=new Rc(this);Uc(this)};function Ca(a,c){for(var b=a.i;null!=b.O&&0<c;)b=b.O,c--;y(a,b)}function Ea(a,c){if(1===c)Da(a)&&$b(a);else{for(var b=0;b<c;b++)Da(a);y(a,a.i)}}n.$a=function(){for(var a=this.i;!Vc(a);){var c=a.O;if(null===c&&a!==this.N)return;a=c}a.$a();y(this,a)};n.Cb=function(a){this.ra=a;this.i.Cb(a)};n.ma=function(a,c,b){this.i.ma(a,c,b)};function Zb(a,c){var b=new Rc(a),d=b.O=a.i;d.p.push(b);d.H=d.p.length-1;a.i=b;a.Pa++;!0===c&&a.Ua.Ec()}n.Va=function(a,c){this.i.Va(a,c)};n.Wa=function(a){this.i.Wa(a)};n.I=function(a,c){this.i.I(a,c)};n.ba=function(a){this.i.I(513,a)};n.za=function(a,c){this.i.za(a,c)};n.ub=function(a,c){this.i.rb.Ib||(this.i.rb.Ib=!0);for(var b=0,d=c.length;b<d;b++)this.i.ub(c[b],a)};n.tb=function(a){this.i.tb(a)};n.vb=function(a){this.i.vb(a)};n.ab=function(){return this.i.ab()};function $b(a){if(a.k){if(1===a.k.Z){var c=a.k;c.Z=0;ta(c)}a.k.A={};a.hb()}for(var c=0,b=a.i.M.length;c<b;c++){var d=a.i.M[c],f=d.C(),e=d.oc;switch(d.m){case 1:d=S(f);Wc(a,d.d,d.f,B,!1);break;case 2:d=S(f);Wc(a,d.d,d.f,C,!1);break;case 257:for(var g=0;g<e;g++)d=S(f[g]),Xc(a,d.d,d.f,B,-1);break;case 258:for(g=0;g<e;g++)d=S(f[g]),Xc(a,d.d,d.f,C,-1);break;case 259:for(g=0;g<e;g++)d=S(f[g]),Xc(a,d.d,d.f,M,-1);break;case 260:a.ra=f;break;case 529:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.I(new D(d.d,d.f,Tb,""));break;case 530:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.I(new D(d.d,d.f,Wb,""));break;case 531:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.I(new D(d.d,d.f,Ub,""));break;case 532:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.I(new D(d.d,d.f,Vb,""));break;case 533:a.k&&(d=S(f.Bc),a.k.I(new D(d.d,d.f,Q,f.Text)));break;case 513:if(a.k)for(g=0;g<e;g++)d=S(f[g]),a.k.ba(d.d,d.f)}}a.k&&(a.i.rb.Ib&&(c=a.k,c.Z=1,ta(c)),a.i.ab()&&(b=a.i.da,c=b.Ba(),b=b.Ca(),0!=c&&0!=b&&sb(a.k,c,b)),qb(a.k));a.Lc&&a.Lc.F(a.i.Nb)}function Wc(a,c,b,d,f){if(0!=c||0!=b){a.B&&!0!==f&&a.B.ad();Xc(a,c,b,d,a.Kb+1,f);var e=null;if(null!==(e=dc(a.w,c,b,d,!1))&&0<e.r()){c=e.r();for(b=0;b<c;b++){var g=S(e.C(b));Xc(a,g.d,g.f,M,-1)}a.B&&!0!==f&&a.B.Ac(e);B===d?a.Oa+=c:a.Sa+=c}else if(null!==(e=ec(a.w,c,b,d))&&0<e.r()){c=e.r();for(b=0;b<c;b++)g=S(e.C(b)),Xc(a,g.d,g.f,M,-1);a.B&&!0!==f&&a.B.Ac(g_nGroupSize);B===d?a.Sa+=c:a.Oa+=c}else a.w.la.Ea()}a.ra=B===d?C:B;a.Kb++}function Da(a){if(0===a.i.p.length||-1===a.i.H)return!1;a.i=Ba(a.i,a.i.H);a.Pa++;return!0}n.hb=function(){this.k&&this.i.hb(this.pb,this.k)};function y(a,c){for(var b=a.w,d=new Qc(b.s,b.G),f=b.s*b.G,e=0;e<f;e++){var g=b.X[e],h=d.X[e];h.Na=g.Na;h.Ra=g.Ra}Uc(a);a.w.xb();a.B&&a.B.Zc();a:{b=c.O;for(f=c;null!=b;){e=!1;g=0;for(h=b.p.length;g<h;g++)if(f===Ba(b,g)){fc(b,g);e=!0;break}if(!e){b=!1;break a}f=b;b=b.O}b=!0}if(b){for(a.i=a.N;a.i!=c&&0<a.i.p.length;){b=a.i.M.length;for(f=0;f<b;f++)switch(h=a.i.M[f],e=h.C(),g=h.oc,h.m){case 1:h=S(e);Wc(a,h.d,h.f,B,!0);break;case 2:h=S(e);Wc(a,h.d,h.f,C,!0);break;case 257:for(var l=0;l<g;l++)h=S(e[l]),a.w.F(h.d,h.f,B,-1);break;case 258:for(l=0;l<g;l++)h=S(e[l]),a.w.F(h.d,h.f,C,-1);break;case 259:for(l=0;l<g;l++)h=S(e[l]),a.w.F(h.d,h.f,M,-1)}if(!Da(a))break}a.k&&pb(a.k,d);$b(a);a.B&&a.B.$c()}}function Ma(a,c){c!==a.pb&&(a.pb=c,a.hb())}function Uc(a){a.i=a.N;a.Oa=0;a.Sa=0;a.Kb=0;a.Pa=0}function Xc(a,c,b,d,f,e){a.w.F(c,b,d,f);a.k&&!0!==e&&Ua(a.k,c,b,d)};"use strict;";function cc(){this.ja=this.ka=0}cc.prototype.Ea=function(){this.ja=this.ka=0};cc.prototype.F=function(a,c){this.ka=a;this.ja=c};function Yc(a,c){this.Na=void 0===a?M:a;this.Ra=void 0===c?-1:c}Yc.prototype.xb=function(){this.Na=M;this.Ra=-1};Yc.prototype.gb=function(a){this.Na=a};Yc.prototype.C=function(){return this.Na};Yc.prototype.Ab=function(){return this.Ra};function Zc(){this.Ia=[];this.qa=[]}Zc.prototype.r=function(){return this.qa.length};Zc.prototype.C=function(a){return this.qa[a]};function $c(a,c,b){c=(b<<8)+c;b=0;for(var d=a.qa.length;b<d;b++)if(a.qa[b]==c)return!0;return!1}function Qc(a,c){this.s=void 0===a?19:a;this.G=void 0===c?19:c;this.X=null;ad(this);this.la=new cc}function ad(a){var c=a.s*a.G;a.X=Array(c);for(var b=0;b<c;b++)a.X[b]=new Yc}Qc.prototype.xb=function(){for(var a=this.s*this.G,c=0;c<a;c++)this.X[c].xb()};Qc.prototype.r=function(){return{d:this.s,f:this.G}};Qc.prototype.F=function(a,c,b,d){a=(c-1)*this.s+(a-1);this.X[a].gb(b);void 0!==d&&null!==d&&-1!==d&&(this.X[a].Ra=d)};function L(a,c,b){return a.X[(b-1)*a.s+(c-1)].C()}Qc.prototype.Ab=function(a,c){return this.X[(c-1)*this.s+(a-1)].Ab()};function ec(a,c,b,d){var f=new Zc;bd(a,c,b,d,f);return 0<f.r()?f:null}function dc(a,c,b,d,f){var e;switch(d){case B:e=C;break;case C:e=B;break;default:return null}d=new Zc;!0!==$c(d,c+1,b)&&bd(a,c+1,b,e,d);!0!==$c(d,c-1,b)&&bd(a,c-1,b,e,d);!0!==$c(d,c,b+1)&&bd(a,c,b+1,e,d);!0!==$c(d,c,b-1)&&bd(a,c,b-1,e,d);e=d.r();if(1==e){c=(b<<8)+c;b=d.C(0);e=a.la;if(b===e.ka&&c===e.ja&&1==f)return null;a.la.F(c,b)}else if(1<e)a.la.Ea();else if(0>=e)return null;return d}function cd(a,c,b,d,f){if(c>a.s||1>c||b>a.G||1>b)return!1;var e=L(a,c,b);return M===e?!0:d===e?dd(a,c,b,d,f):!1}function dd(a,c,b,d,f){var e;a:{e=(b<<8)+c;for(var g=0,h=f.Ia.length;g<h;g++)if(f.Ia[g]==e){e=!0;break a}f.Ia.push(e);e=!1}return!0===e?!1:!0===cd(a,c+1,b,d,f)||!0===cd(a,c-1,b,d,f)||!0===cd(a,c,b+1,d,f)||!0===cd(a,c,b-1,d,f)?!0:!1}function bd(a,c,b,d,f){c>a.s||1>c||b>a.G||1>b||d!==L(a,c,b)||(!0!==dd(a,c,b,d,f)&&(f.qa=f.qa.concat(f.Ia)),f.Ia=[])};function Id(a,c){this.qb=a;this.m=c}n=Id.prototype;n.Ba=function(){return S(this.qb).d};n.Ca=function(){return S(this.qb).f};n.C=function(){return this.qb};n.gb=function(a){this.qb=a};n.Db=function(a){this.m=a};function Rc(a){this.Ic=++a.Jc;this.p=[];this.H=-1;this.O=null;this.M=[];this.da=new Id(0,M);this.Nb="";this.rb=new Jd;a.nc[this.Ic]=this}function Ba(a,c){return void 0!==a.p[c]?a.p[c]:a.p[a.H]}function fc(a,c){a.H=c>=a.p.length?a.p.length-1:c}n=Rc.prototype;n.ab=function(){return M===this.da.m?!1:!0};n.Wa=function(a){this.Nb+=a};n.ub=function(a,c){this.rb.Hc[""+a]=c};n.$a=function(){for(var a=this;0<a.p.length;)fc(a,0),a=Ba(a,0)};function Vc(a){for(var c=null;null!==(c=a.O);){if(0!=c.H)return!1;a=c}return!0}n.ma=function(a,c,b){a=(c<<8)+a;this.M.push(new T(B===b?1:2,a));M===this.da.m&&(this.da.gb(a),this.da.Db(b))};n.Va=function(a,c){var b=new T(B===a?257:C===a?258:259,Oc(c),c.length);this.M.push(b)};n.I=function(a,c){var b=0;switch(a){case Tb:b=529;break;case Va:b=Mc.Yc;break;case Ub:b=531;break;case Vb:b=532;break;case Q:b=Mc.bd;break;case Wb:b=Mc.d}b=new T(b,Oc(c),c.length);this.M.push(b)};n.za=function(a,c){this.M.push(new T(533,{Text:a,Bc:c}))};n.Cb=function(a){this.M.push(new T(260,a))};n.tb=function(a){this.M.push(new T(769,a))};n.vb=function(a){this.M.push(new T(770,a))};n.hb=function(a,c){c.b.jb.e.b.getContext("2d").clearRect(0,0,c.c.L,c.c.o);switch(a){case 2:Kd(this,c,-1);break;case 1:var b=this.O;null!==b&&Kd(b,c,this.da.C())}};function Kd(a,c,b){if(c)for(var d=0,f=a.p.length;d<f;d++){var e=Ba(a,d).da;if(M!==e.m&&b!==e.C()){var g=S(e.C()),e=c;if(e.c.n){var h=(e.c.K/2-1)/2,l=e.c.n,m=l[g.d-1].d,g=l[g.f-1].f,l=e.b.jb.e.b.getContext("2d");l.fillStyle=E(e.Pc);l.beginPath();l.arc(m,g,h,0,2*Math.PI,!1);l.fill()}}}};function Sc(a){this.g=a;this.j=[];this.ta=this.a=0;this.Hb=[];this.Y=!0;this.Qa=0}function Tc(a){a.g.Ea();if("("===a.j[0]&&";"===a.j[1])for(a.a++;a.a<a.Qa&&(")"!==a.j[a.a]||0!==a.ta);){var c=a.j[a.a];if(";"===c){1!=a.a?Zb(a.g,!1):a.g.i=a.g.N;a:{c=a;c.a++;for(var b=c.j[c.a],d=c.j[c.a+1];void 0!==b&&")"!==b&&";"!==b&&"("!==b;){switch(b){case "A":switch(d){case "B":Ld(c,B);break;case "E":Ld(c,M);break;case "W":Ld(c,C);break;case "N":b=c;b.a+=3;V(b);break;case "P":b=c;b.a+=3;V(b);break;default:W(c)}break;case "B":switch(d){case "[":Md(c,B);break;case "R":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;case "L":b=c;b.a+=3;b.g.tb(Nd(b));break;default:W(c)}break;case "C":switch(d){case "[":b=c;b.a+=2;for(d="";"]"!==b.j[b.a]||"\\"===b.j[b.a-1];)"]"==-b.j[b.a+1]&&"\\"===b.j[b.a]?(d+="]",b.a++):d=13==b.j[b.a].charCodeAt(0)?d+"<br>\n":10==b.j[b.a].charCodeAt(0)?d+"<br>\n":133==b.j[b.a].charCodeAt(0)?d+"<br>\n":d+b.j[b.a],b.a++;b.a++;b.g.Wa(d);break;case "A":b=c;b.a+=3;V(b);break;case "P":b=c;b.a+=3;V(b);break;case "R":Od(c,Tb);break;default:W(c)}break;case "D":switch(d){case "D":b=c;b.a+=3;V(b);break;default:W(c)}break;case "E":switch(d){case "V":b=c;b.a+=3;V(b);break;default:W(c)}break;case "F":switch(d){case "F":W(c);break;default:W(c)}break;case "G":switch(d){case "N":b=c;b.a+=3;V(b);break;case "C":b=c;b.a+=3;V(b);break;case "M":b=c;b.a+=3;1!==Pd(b)&&(b.Y=!1);break;default:W(c)}break;case "H":switch(d){case "A":b=c;b.a+=3;Pd(b);break;default:W(c)}break;case "K":switch(d){case "M":b=c;b.a+=3;Nd(b);break;default:W(c)}break;case "L":switch(d){case "B":b=c;for(b.a+=3;;){d=b.j[b.a];b.a++;var f=b.j[b.a];b.a++;d=d.charCodeAt(0)-96;f=f.charCodeAt(0)-96;b.a++;for(var e="";"]"!==b.j[b.a]&&b.a<b.Qa;)e+=b.j[b.a],b.a++;b.g.za(e,(f<<8)+d);if("]"!==b.j[b.a]){b.Y=!1;break}b.a++;if("["!==b.j[b.a])break;b.a++}break;default:W(c)}break;case "M":switch(d){case "A":Od(c,Wb);break;default:W(c)}break;case "O":switch(d){case "N":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;default:W(c)}break;case "P":switch(d){case "B":b=c;b.a+=3;V(b);break;case "C":b=c;b.a+=3;V(b);break;case "W":b=c;b.a+=3;V(b);break;default:W(c)}break;case "R":switch(d){case "E":b=c;b.a+=3;V(b);break;case "O":b=c;b.a+=3;V(b);break;case "U":b=c;b.a+=3;V(b);break;default:W(c)}break;case "S":switch(d){case "Q":Od(c,Ub);break;case "T":b=c;b.a+=3;switch(Pd(b)){case 0:Ma(b.g,2);break;case 1:Ma(b.g,1);break;default:Ma(b.g,0)}break;case "Z":d=c;d.a+=3;b=Pd(d);0>=b&&(b=19);d=d.g;f=d.w;e=b;f.s=b;f.G=e;ad(f);f.la.Ea();d.k&&(b=d.k,Fa(b),b.wa());break;case "O":b=c;b.a+=3;V(b);break;default:W(c)}break;case "T":switch(d){case "R":Od(c,Vb);break;case "M":b=c;b.a+=3;V(b);break;case "B":Qd(c,B);break;case "W":Qd(c,C);break;default:W(c)}break;case "U":switch(d){case "S":b=c;b.a+=3;V(b);break;default:W(c)}break;case "W":switch(d){case "[":Md(c,C);break;case "R":b=c;b.a+=3;V(b);break;case "T":b=c;b.a+=3;V(b);break;case "L":b=c;b.a+=3;b.g.vb(Nd(b));break;default:W(c)}break;default:W(c)}if(!c.Y){c=!1;break a}b=c.j[c.a];d=c.j[c.a+1]}c=!0}if(!c)return!1}else if("("===c)a.Hb[a.ta]=a.g.i,a.ta++,a.a++;else if(")"===c)a.ta--,a.g.i=a.Hb[a.ta],a.a++;else return!1}else return!1;return!0}function V(a,c){void 0===c&&(c="]");for(var b="";void 0!==a.j[a.a]&&c!==a.j[a.a];)b+=a.j[a.a],a.a++;void 0===a.j[a.a]&&(a.Y=!1);a.a++;return b}function Nd(a){a=parseFloat(V(a,void 0));return isNaN(a)?0:a}function Pd(a){a=parseInt(V(a,void 0));return isNaN(a)?0:a}function W(a){for(;;){for(;void 0!==a.j[a.a]&&"]"!==a.j[a.a]&&a.a<a.Qa;)for(a.a++;"]"===a.j[a.a]&&"\\"===a.j[a.a-1];)a.a++;a.a++;if("["!==a.j[a.a])break}}function Ld(a,c){a.a+=3;var b=[];if("]"!==a.j[a.a]){for(;;){var d=a.j[a.a];a.a++;var f=a.j[a.a];a.a++;b.push((f.charCodeAt(0)-96<<8)+(d.charCodeAt(0)-96));if("]"!==a.j[a.a]){a.Y=!1;return}a.a++;if("["!==a.j[a.a])break;a.a++}a.g.Va(c,b)}}function Md(a,c){a.a+=2;if("]"==a.j[a.a])a.g.ma(0,0,c);else{var b=a.j[a.a];a.a++;var d=a.j[a.a];a.a++;var f=a.g.w.r();"t"===b&&"t"===d&&19>=f.d&&19>=f.f?a.g.ma(0,0,c):(a.g.ma(b.charCodeAt(0)-96,d.charCodeAt(0)-96,c),"]"!==a.j[a.a]&&(a.Y=!1))}a.a++}function Od(a,c){var b=0;a.a+=3;var d=[];if("]"!==a.j[a.a]){for(;;){var f=a.j[a.a];a.a++;var e=a.j[a.a];a.a++;d[b]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);b++;if("]"!==a.j[a.a]){a.Y=!1;return}a.a++;if("["!==a.j[a.a])break;a.a++}a.g.I(c,d)}}function Qd(a,c){var b=0;a.a+=3;var d=[];if("]"!==a.j[a.a]){for(;;){var f=a.j[a.a];a.a++;var e=a.j[a.a];a.a++;d[b]=(e.charCodeAt(0)-96<<8)+(f.charCodeAt(0)-96);b++;if("]"!==a.j[a.a]){a.Y=!1;return}a.a++;if("["!==a.j[a.a])break;a.a++}a.g.ub(c,d)}};function Jd(){this.Ib=!1;this.Hc={}};function Z(){}n=Z.prototype;n.xc=function(){return new Pc};n.zb=function(a,c){(new Kc(a)).zb(c)};n.yb=function(a,c){(new Kc(a)).yb(c)};n.eb=function(a,c){a.eb(c)};n.v=function(a){a.v()};window.GoBoardApi=new Z;Z.prototype.Create_GameTree=Z.prototype.xc;Z.prototype.Create_SimpleBoard=Z.prototype.zb;Z.prototype.Create_BoardWithNavigateButtons=Z.prototype.yb;Z.prototype.Load_Sgf=Z.prototype.eb;Z.prototype.Update_Size=Z.prototype.v;}());